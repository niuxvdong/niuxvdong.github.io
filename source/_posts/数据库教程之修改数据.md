---
title: 数据库教程之修改数据
author: Mr.Niu
toc: true
abbrlink: 26278
top_img: 'https://img.niuxvdong.top/thumb-1920-670838.jpg'
cover: 'https://img.niuxvdong.top/thumb-1920-670838.jpg'
categories: 数据库
tags:
  - 修改
  - INSERT
  - UPDATE
  - DELETE
date: 2020-06-09 18:36:02
updated:
---





# 首先来首歌曲来放松一下吧！

{% meting "1403215687" "netease" "song" "theme:#FF4081" "mode:circulation" "mutex:true" "listmaxheight:340px" "preload:auto"  %}





> 关系数据库的基本操作就是增删改查，即`CRUD：Create、Retrieve(检索)、Update、Delete`。其中，对于查询，我们已经详细讲述了`SELECT`语句的详细用法。
>
> 而对于增、删、改，对应的SQL语句分别是：
>
> - INSERT：插入新记录；
> - UPDATE：更新已有记录；
> - DELETE：删除已有记录。



# 一、INSERT

## 1、插入一条记录



> 语法：`INSERT INTO <表名> (字段1, 字段2, ...) VALUES (值1, 值2, ...);`
>
> `id`字段是一个自增主键，它的值可以由数据库自己推算出来。
>
> 如果一个字段有默认值，那么在`INSERT`语句中也可以不出现。
>
> 要注意，字段顺序不必和数据库表的字段顺序一致，但值的顺序必须和字段顺序一致。



```mysql
$ mysql> INSERT INTO students (class_id, name, gender, score) VALUES (2, '大牛', 'M', 80);
Query OK, 1 row affected (0.03 sec)

$ mysql> SELECT * FROM students;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  1 |        1 | 小明   | M      |    90 |
|  2 |        1 | 小红   | F      |    95 |
|  3 |        1 | 小军   | M      |    88 |
|  4 |        1 | 小米   | F      |    73 |
|  5 |        2 | 小白   | F      |    81 |
|  6 |        2 | 小兵   | M      |    55 |
|  7 |        2 | 小林   | M      |    85 |
|  8 |        3 | 小新   | F      |    91 |
|  9 |        3 | 小王   | M      |    89 |
| 10 |        3 | 小丽   | F      |    85 |
| 11 |        5 | 新生   | M      |    88 |
| 12 |        2 | 大牛   | M      |    80 |
+----+----------+--------+--------+-------+
12 rows in set (0.00 sec)
```



## 2、插入多条记录



> 语法：`INSERT INTO <表名> (字段1, 字段2, ...) VALUES (值1, 值2, ...), VALUES (值1, 值2, ...).....;`
>
> 多条语句，逗号隔开！





```mysql
$ mysql> INSERT INTO students (class_id, name, gender, score) VALUES
    ->   (1, '大宝', 'M', 87),
    ->   (2, '二宝', 'M', 81);
Query OK, 2 rows affected (0.01 sec)
Records: 2  Duplicates: 0  Warnings: 0

$ mysql> SELECT * FROM students;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  1 |        1 | 小明   | M      |    90 |
|  2 |        1 | 小红   | F      |    95 |
|  3 |        1 | 小军   | M      |    88 |
|  4 |        1 | 小米   | F      |    73 |
|  5 |        2 | 小白   | F      |    81 |
|  6 |        2 | 小兵   | M      |    55 |
|  7 |        2 | 小林   | M      |    85 |
|  8 |        3 | 小新   | F      |    91 |
|  9 |        3 | 小王   | M      |    89 |
| 10 |        3 | 小丽   | F      |    85 |
| 11 |        5 | 新生   | M      |    88 |
| 12 |        2 | 大牛   | M      |    80 |
| 13 |        1 | 大宝   | M      |    87 |
| 14 |        2 | 二宝   | M      |    81 |
+----+----------+--------+--------+-------+
14 rows in set (0.00 sec)
```







# 二、UPDATE



## 1、更新一条记录



> 语法：`UPDATE <表名> SET 字段1=值1, 字段2=值2, ... WHERE ...;`



```mysql
$ mysql> UPDATE students SET name='大牛', score=66 WHERE id=1;
Query OK, 1 row affected (0.01 sec)
Rows matched: 1  Changed: 1  Warnings: 0

$ mysql> SELECT * FROM students WHERE id=1;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  1 |        1 | 大牛   | M      |    66 |
+----+----------+--------+--------+-------+
1 row in set (0.00 sec)
```





## 2、更新多条记录



> 语法：`UPDATE students SET name='小牛', score=77 WHERE id>=5 AND id<=7;`
>
> `WHERE`条件可与逻辑运算符结合，更新指定条件的记录。
>
> 如果`WHERE`条件没有匹配到任何记录，`UPDATE`语句不会报错，也不会有任何记录被更新。



```mysql
$ mysql> UPDATE students SET score=score+10 WHERE score<80;
Query OK, 3 rows affected (0.01 sec)
Rows matched: 3  Changed: 3  Warnings: 0

$ mysql> SELECT * FROM students;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  1 |        1 | 大牛   | M      |    76 |
|  2 |        1 | 小红   | F      |    95 |
|  3 |        1 | 小军   | M      |    88 |
|  4 |        1 | 小米   | F      |    83 |
|  5 |        2 | 小白   | F      |    81 |
|  6 |        2 | 小兵   | M      |    65 |
|  7 |        2 | 小林   | M      |    85 |
|  8 |        3 | 小新   | F      |    91 |
|  9 |        3 | 小王   | M      |    89 |
| 10 |        3 | 小丽   | F      |    85 |
| 11 |        5 | 新生   | M      |    88 |
| 12 |        2 | 大牛   | M      |    80 |
| 13 |        1 | 大宝   | M      |    87 |
| 14 |        2 | 二宝   | M      |    81 |
+----+----------+--------+--------+-------+
14 rows in set (0.00 sec)
```



## 3、不使用WHERE条件



> 此举动要小心，整个表的所有记录都会被更新。
>
> eg：`UPDATE students SET score=60;`
>
> 效果：整个表的学生分数都变为了60.
>
> **注意**：所以，在执行`UPDATE`语句时要非常小心，最好先用`SELECT`语句来测试`WHERE`条件是否筛选出了期望的记录集，然后再用`UPDATE`更新。





## 4、MySQL提示信息

> 使用MySQL这类真正的关系数据库时，`UPDATE`语句会返回更新的行数以及`WHERE`条件匹配的行数。

```mysql
$ mysql> UPDATE students SET name='大牛', score=66 WHERE id=1;
Query OK, 1 row affected (0.01 sec)
Rows matched: 1  Changed: 1  Warnings: 0
```





# 三、DELETE



## 1、删除记录



> 语法：`DELETE FROM <表名> WHERE ...;`
>
> 同样：可以配合逻辑运算符实现多条删除！
>
> 如果`WHERE`条件没有匹配到任何记录，`DELETE`语句不会报错，也不会有任何记录被删除。



```mysql
$ mysql> DELETE FROM students WHERE id=1;
Query OK, 1 row affected (0.01 sec)

$ mysql> SELECT * FROM students;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  2 |        1 | 小红   | F      |    95 |
|  3 |        1 | 小军   | M      |    88 |
|  4 |        1 | 小米   | F      |    83 |
|  5 |        2 | 小白   | F      |    81 |
|  6 |        2 | 小兵   | M      |    65 |
|  7 |        2 | 小林   | M      |    85 |
|  8 |        3 | 小新   | F      |    91 |
|  9 |        3 | 小王   | M      |    89 |
| 10 |        3 | 小丽   | F      |    85 |
| 11 |        5 | 新生   | M      |    88 |
| 12 |        2 | 大牛   | M      |    80 |
| 13 |        1 | 大宝   | M      |    87 |
| 14 |        2 | 二宝   | M      |    81 |
+----+----------+--------+--------+-------+
13 rows in set (0.00 sec)
```







## 2、不使用WHERE条件



> 此举动要小心，整个表的所有记录都会被删除。
>
> eg：`DELETE FROM students;`
>
> 效果：变成了一张空表。
>
> **注意**：所以，在执行`DELETE`语句时也要非常小心，最好先用`SELECT`语句来测试`WHERE`条件是否筛选出了期望的记录集，然后再用`DELETE`删除。



## 4、MySQL提示信息

> 使用MySQL这类真正的关系数据库时，`DELETE`语句也会返回删除的行数以及`WHERE`条件匹配的行数。

```mysql
$ mysql> DELETE FROM students WHERE id=1;
Query OK, 1 row affected (0.01 sec)
```





# 四、实用SQL语句



## 1、插入或替换



> 如果我们希望插入一条新记录（INSERT），但如果记录已经存在，就先删除原记录，再插入新记录。此时，可以使用`REPLACE`语句。



```mysql
$ mysql> REPLACE INTO students (id, class_id, name, gender, score) VALUES (1, 1, '小明', 'F', 99);
Query OK, 1 row affected (0.01 sec)

$ mysql> SELECT * FROM students;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  1 |        1 | 小明   | F      |    99 |
|  2 |        1 | 小红   | F      |    95 |
|  3 |        1 | 小军   | M      |    88 |
|  4 |        1 | 小米   | F      |    83 |
|  5 |        2 | 小白   | F      |    81 |
|  6 |        2 | 小兵   | M      |    65 |
|  7 |        2 | 小林   | M      |    85 |
|  8 |        3 | 小新   | F      |    91 |
|  9 |        3 | 小王   | M      |    89 |
| 10 |        3 | 小丽   | F      |    85 |
| 11 |        5 | 新生   | M      |    88 |
| 12 |        2 | 大牛   | M      |    80 |
| 13 |        1 | 大宝   | M      |    87 |
| 14 |        2 | 二宝   | M      |    81 |
+----+----------+--------+--------+-------+
14 rows in set (0.00 sec)
```



## 2、插入或更新

> 如果我们希望插入一条新记录（INSERT），但如果记录已经存在，就更新该记录，此时，可以使用`INSERT INTO ... ON DUPLICATE KEY UPDATE ...`语句：

```mysql
$ mysql> INSERT INTO students (id, class_id, name, gender, score) VALUES (1, 1, ' 小明', 'F', 99) ON DUPLICATE KEY UPDATE name='小明', gender='F', score=98;
Query OK, 2 rows affected (0.00 sec)

$ mysql> SELECT * FROM students;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  1 |        1 | 小明   | F      |    98 |
|  2 |        1 | 小红   | F      |    95 |
|  3 |        1 | 小军   | M      |    88 |
|  4 |        1 | 小米   | F      |    83 |
|  5 |        2 | 小白   | F      |    81 |
|  6 |        2 | 小兵   | M      |    65 |
|  7 |        2 | 小林   | M      |    85 |
|  8 |        3 | 小新   | F      |    91 |
|  9 |        3 | 小王   | M      |    89 |
| 10 |        3 | 小丽   | F      |    85 |
| 11 |        5 | 新生   | M      |    88 |
| 12 |        2 | 大牛   | M      |    80 |
| 13 |        1 | 大宝   | M      |    87 |
| 14 |        2 | 二宝   | M      |    81 |
+----+----------+--------+--------+-------+
14 rows in set (0.00 sec)
```



## 3、插入或忽略

> 如果我们希望插入一条新记录（INSERT），但如果记录已经存在，就啥事也不干直接忽略，此时，可以使用`INSERT IGNORE INTO ...`语句。



```mysql
$ mysql> INSERT IGNORE INTO students (id, class_id, name, gender, score) VALUES (1, 1, '小明', 'F', 99);
Query OK, 0 rows affected, 1 warning (0.00 sec)

$ mysql> SELECT * FROM students;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  1 |        1 | 小明   | F      |    98 |
|  2 |        1 | 小红   | F      |    95 |
|  3 |        1 | 小军   | M      |    88 |
|  4 |        1 | 小米   | F      |    83 |
|  5 |        2 | 小白   | F      |    81 |
|  6 |        2 | 小兵   | M      |    65 |
|  7 |        2 | 小林   | M      |    85 |
|  8 |        3 | 小新   | F      |    91 |
|  9 |        3 | 小王   | M      |    89 |
| 10 |        3 | 小丽   | F      |    85 |
| 11 |        5 | 新生   | M      |    88 |
| 12 |        2 | 大牛   | M      |    80 |
| 13 |        1 | 大宝   | M      |    87 |
| 14 |        2 | 二宝   | M      |    81 |
+----+----------+--------+--------+-------+
14 rows in set (0.00 sec)
```



## 4、快照



> 如果想要对一个表进行快照，即复制一份当前表的数据到一个新表，可以结合`CREATE TABLE`和`SELECT`。
>
> 可选的复制复制了一份，和该表结构一致。

```mysql
$ mysql> CREATE TABLE students_of_class1 SELECT * FROM students WHERE class_id=1;
Query OK, 5 rows affected (0.09 sec)
Records: 5  Duplicates: 0  Warnings: 0

$ mysql> SHOW TABLES;
+--------------------+
| Tables_in_test     |
+--------------------+
| classes            |
| students           |
| students_of_class1 |
+--------------------+
3 rows in set (0.01 sec)

$ mysql> SELECT * FROM students_of_class1;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  1 |        1 | 小明   | F      |    98 |
|  2 |        1 | 小红   | F      |    95 |
|  3 |        1 | 小军   | M      |    88 |
|  4 |        1 | 小米   | F      |    83 |
| 13 |        1 | 大宝   | M      |    87 |
+----+----------+--------+--------+-------+
5 rows in set (0.00 sec)
```





## 5、写入查询结果集



> 如果查询结果集需要写入到表中，可以结合`INSERT`和`SELECT`，将`SELECT`语句的结果集直接插入到指定表中。



1. 先创建满足需求的表



```mysql
$ mysql> CREATE TABLE result (
    ->     id BIGINT NOT NULL AUTO_INCREMENT,
    ->     class_id BIGINT NOT NULL,
    ->     average DOUBLE NOT NULL,
    ->     PRIMARY KEY (id)
    -> );
Query OK, 0 rows affected (0.03 sec)
```



2. 使用`INSERT INTO ... SELECT ... FROM...`	



```mysql
$ mysql> INSERT INTO result (class_id, average) SELECT class_id, AVG(score) FROM students GROUP BY class_id;
Query OK, 4 rows affected (0.01 sec)
Records: 4  Duplicates: 0  Warnings: 0

$ mysql> SELECT * FROM result;
+----+----------+--------------+
| id | class_id | average      |
+----+----------+--------------+
|  1 |        1 |         90.2 |
|  2 |        2 |         78.4 |
|  3 |        3 | 88.333333333 |
|  4 |        5 |           88 |
+----+----------+--------------+
4 rows in set (0.00 sec)
```



## 6、强制使用指定索引



> 在查询的时候，数据库系统会自动分析查询语句，并选择一个最合适的索引。但是很多时候，数据库系统的查询优化器并不一定总是能使用最优索引。如果我们知道如何选择索引，可以使用`FORCE INDEX`强制查询使用指定的索引。
>
> 指定索引前提是索引（`idx_class_id`）必须存在！



```mysql
$ SELECT * FROM students FORCE INDEX (idx_class_id) WHERE class_id = 1 ORDER BY id DESC;
```

















