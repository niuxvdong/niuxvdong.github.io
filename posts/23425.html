<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>高性能、轻量级开源分布式RPC服务框架Dubbo使用介绍 | 小牛博客</title><meta name="keywords" content="Dubbo"><meta name="author" content="ITNXD"><meta name="copyright" content="ITNXD"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="¶一、分布式介绍 ¶1、是什么 《分布式系统原理与范型》定义： “分布式系统是若干独立计算机的集合，这些计算机对于用户来说就像单个相关系统” 分布式系统（distributed system）是建立在网络之上的软件系统。 随着互联网的发展，网站应用的规模不断扩大，常规的垂直应用架构已无法应对，分布式服务架构以及流动计算架构势在必行，亟需一个治理系统确保架构有条不紊的演进。 ¶2、发展演变  ¶单一">
<meta property="og:type" content="article">
<meta property="og:title" content="高性能、轻量级开源分布式RPC服务框架Dubbo使用介绍">
<meta property="og:url" content="https://www.itnxd.cn/posts/23425.html">
<meta property="og:site_name" content="小牛博客">
<meta property="og:description" content="¶一、分布式介绍 ¶1、是什么 《分布式系统原理与范型》定义： “分布式系统是若干独立计算机的集合，这些计算机对于用户来说就像单个相关系统” 分布式系统（distributed system）是建立在网络之上的软件系统。 随着互联网的发展，网站应用的规模不断扩大，常规的垂直应用架构已无法应对，分布式服务架构以及流动计算架构势在必行，亟需一个治理系统确保架构有条不紊的演进。 ¶2、发展演变  ¶单一">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/27c3919bb7046bc5ece2657118592e38.png">
<meta property="article:published_time" content="2021-10-01T07:48:41.000Z">
<meta property="article:modified_time" content="2022-10-22T10:00:22.407Z">
<meta property="article:author" content="ITNXD">
<meta property="article:tag" content="Dubbo">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/27c3919bb7046bc5ece2657118592e38.png"><link rel="shortcut icon" href="https://gitcode.net/qq_43590403/images/-/raw/master/img/favicon.ico"><link rel="canonical" href="https://www.itnxd.cn/posts/23425"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="H9LW1qdxrkJ55YbkfWulMvpaexxx3Rk0Yo6dVANeNHc"/><meta name="baidu-site-verification" content="code-YglH3DObCb"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8d3bd59bf6303bd5f44677445d369df5";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":300,"languages":{"author":"作者: ITNXD","link":"链接: ","source":"来源: 小牛博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '高性能、轻量级开源分布式RPC服务框架Dubbo使用介绍',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-22 18:00:22'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link rel="stylesheet" href="/css/my.css"><style type="text/css">#toggle-sidebar {bottom: 80px}</style><link rel="stylesheet" href="//at.alicdn.com/t/font_1828588_zrw9f0qqie.css"><link rel="stylesheet" href="/self/atom-one-light.css"><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="小牛博客" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/02/06/e373babbf340391956b673128a84185d.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">261</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">214</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/27c3919bb7046bc5ece2657118592e38.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">小牛博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">高性能、轻量级开源分布式RPC服务框架Dubbo使用介绍</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-10-01T07:48:41.000Z" title="发表于 2021-10-01 15:48:41">2021-10-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-10-22T10:00:22.407Z" title="更新于 2022-10-22 18:00:22">2022-10-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E5%BE%AE%E6%9C%8D%E5%8A%A1/">分布式微服务</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>34分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="高性能、轻量级开源分布式RPC服务框架Dubbo使用介绍"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="一、分布式介绍"><a class="header-anchor" href="#一、分布式介绍">¶</a>一、分布式介绍</h1>
<h2 id="1、是什么"><a class="header-anchor" href="#1、是什么">¶</a>1、是什么</h2>
<p>《分布式系统原理与范型》定义：</p>
<p>“分布式系统是若干独立计算机的集合，这些计算机对于用户来说就像单个相关系统”</p>
<p>分布式系统（distributed system）是建立在网络之上的软件系统。</p>
<p>随着互联网的发展，网站应用的规模不断扩大，常规的垂直应用架构已无法应对，分布式服务架构以及流动计算架构势在必行，亟需<strong>一个治理系统</strong>确保架构有条不紊的演进。</p>
<h2 id="2、发展演变"><a class="header-anchor" href="#2、发展演变">¶</a>2、发展演变</h2>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/9cf66d6f9eb3a58be35ed04ba5c20516.png" alt=""></p>
<h3 id="单一应用架构"><a class="header-anchor" href="#单一应用架构">¶</a>单一应用架构</h3>
<p>当网站流量很小时，只需一个应用，将所有功能都部署在一起，以减少部署节点和成本。此时，用于简化增删改查工作量的数据访问框架(ORM)是关键。</p>
<p>适用于小型网站，小型管理系统，将所有功能都部署到一个功能里，简单易用。</p>
<p><strong>缺点：</strong></p>
<ol>
<li>性能扩展比较难</li>
<li>协同开发问题</li>
<li>不利于升级维护</li>
</ol>
<h3 id="垂直应用架构"><a class="header-anchor" href="#垂直应用架构">¶</a>垂直应用架构</h3>
<p>当访问量逐渐增大，单一应用增加机器带来的加速度越来越小，将应用拆成互不相干的几个应用，以提升效率。此时，用于加速前端页面开发的Web框架(MVC)是关键。</p>
<p>通过切分业务来实现各个模块独立部署，降低了维护和部署的难度，团队各司其职更易管理，性能扩展也更方便，更有针对性。</p>
<p><strong>缺点：</strong></p>
<p><strong>公用模块无法重复利用</strong>，开发性的浪费！</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/2e41b325de0bffc9f43b79b820f32411.png" alt=""></p>
<h3 id="分布式服务架构"><a class="header-anchor" href="#分布式服务架构">¶</a>分布式服务架构</h3>
<p>当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来，作为独立的服务，逐渐形成稳定的服务中心，使前端应用能更快速的响应多变的市场需求。此时，用于提高业务复用及整合的<strong>分布式服务框架</strong>，**(RPC)**是关键。</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/477e7332ef6d05c918eae571ce416533.png" alt=""></p>
<h3 id="流动计算架构"><a class="header-anchor" href="#流动计算架构">¶</a>流动计算架构</h3>
<p>当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个调度中心基于访问压力实时管理集群容量，提高集群利用率。此时，用于<strong>提高机器利用率的资源调度和治理中心(SOA)[ Service Oriented Architecture]是关键</strong>。</p>
<p>可以使用注册中心来完成！</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/abf1ae30833fe724cebf60b675f81500.png" alt=""></p>
<h1 id="二、Dubbo介绍"><a class="header-anchor" href="#二、Dubbo介绍">¶</a>二、Dubbo介绍</h1>
<h2 id="1、简介"><a class="header-anchor" href="#1、简介">¶</a>1、简介</h2>
<p>Apache Dubbo (incubating) 是一款高性能、轻量级的开源Java <strong>RPC框架</strong>，它提供了三大核心能力：面向接口的远程方法调用，智能容错和负载均衡，以及服务自动注册和发现。</p>
<p>官网：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://dubbo.apache.org/zh/">https://dubbo.apache.org/zh/</a></p>
<h2 id="2、RPC介绍"><a class="header-anchor" href="#2、RPC介绍">¶</a>2、RPC介绍</h2>
<p>RPC【Remote Procedure Call】是指<strong>远程过程调用</strong>，是一种进程间通信方式，他是一种技术的<strong>思想</strong>，而不是规范。它允许程序调用另一个地址空间（通常是共享网络的<strong>另一台机器上</strong>）的过程或函数，而不用程序员显式编码这个远程调用的细节。即程序员无论是调用本地的还是远程的函数，本质上编写的调用代码基本相同。</p>
<p><strong>RPC两个核心模块：通讯，序列化。</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/e046cca905bc0abdc037faa9c6204a9d.png" alt=""></p>
<p><strong>流程图：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/5d4835568c61d1c6506ae95e4a6fd648.png" alt=""></p>
<h2 id="3、Dubbo基本概念"><a class="header-anchor" href="#3、Dubbo基本概念">¶</a>3、Dubbo基本概念</h2>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/2b385232f32c4e1cbe7785eefdbbc3a8.png" alt=""></p>
<p><strong>服务提供者（Provider）</strong>：暴露服务的服务提供方，服务提供者在启动时，向注册中心注册自己提供的服务。</p>
<p><strong>服务消费者（Consumer）</strong>：调用远程服务的服务消费方，服务消费者在启动时，向注册中心订阅自己所需的服务，服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</p>
<p><strong>注册中心（Registry）</strong>：注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者</p>
<p><strong>监控中心（Monitor）</strong>：服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心</p>
<p><strong>调用关系说明：</strong></p>
<ol>
<li>服务容器负责启动，加载，运行服务提供者。</li>
<li>服务提供者在启动时，向注册中心注册自己提供的服务。</li>
<li>服务消费者在启动时，向注册中心订阅自己所需的服务。</li>
<li>注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于<strong>长连接</strong>推送变更数据给消费者。</li>
<li>服务消费者，从提供者地址列表中，基于<strong>软负载均衡</strong>算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</li>
<li>服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到<strong>监控中心</strong>。</li>
</ol>
<h1 id="三、Dubbo环境搭建"><a class="header-anchor" href="#三、Dubbo环境搭建">¶</a>三、Dubbo环境搭建</h1>
<h2 id="1、Zookeeper安装"><a class="header-anchor" href="#1、Zookeeper安装">¶</a>1、Zookeeper安装</h2>
<p>安装详细查看之前ZK教程：<a href="https://www.itnxd.cn/posts/34316.html#%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85">https://www.itnxd.cn/posts/34316.html#%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85</a></p>
<h2 id="2、Dubbo-Admin安装"><a class="header-anchor" href="#2、Dubbo-Admin安装">¶</a>2、Dubbo-Admin安装</h2>
<blockquote>
<p>不重要，安不安装都行！</p>
</blockquote>
<p><strong>安装参考教程：</strong></p>
<ul>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://segmentfault.com/a/1190000039369793">https://segmentfault.com/a/1190000039369793</a></li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/weixin_49343190/article/details/112789302">https://blog.csdn.net/weixin_49343190/article/details/112789302</a></li>
</ul>
<p><strong>命令改一下：</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">mvn clean package -Dmaven.test.skip=true<br><span class="hljs-meta">#</span><span class="bash"> 改为，原命令报错</span><br>mvn clean package '-Dmaven.test.skip=true'<br></code></pre></td></tr></tbody></table></figure>
<p><strong>注意：</strong></p>
<p>使用Github最新版安装时mvn打包时建议挂全局代理，否则可能会有问题！</p>
<h2 id="3、Dubbo-HelloWorld"><a class="header-anchor" href="#3、Dubbo-HelloWorld">¶</a>3、Dubbo-HelloWorld</h2>
<h3 id="功能需求"><a class="header-anchor" href="#功能需求">¶</a>功能需求</h3>
<p>某个电商系统，订单服务需要调用用户服务获取某个用户的所有地址：</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/13e436f0be954c235d1de2975ad8e16b.png" alt=""></p>
<p>订单服务web模块在A服务器，用户服务模块在B服务器，A可以<strong>远程调用</strong>B的功能！</p>
<h3 id="创建模块"><a class="header-anchor" href="#创建模块">¶</a>创建模块</h3>
<p><strong>公共接口层：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/706513245a68205c19a594c9aef946b1.png" alt=""></p>
<p>pom.xml：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itnxd.gmall<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>gmall-interface<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>服务消费者层：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/7db4e3d4b1beb063d254eb7aaf2fdc2c.png" alt=""></p>
<p>pom.xml：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--引用公共接口层--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itnxd.gmall<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>gmall-interface<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 引入dubbo --&gt;</span><br><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/dubbo --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dubbo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 注册中心使用的是zookeeper，引入操作zookeeper的客户端端 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.curator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>curator-framework<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>OrderServiceImpl.java：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OrderService</span> </span>{<br><br>   <span class="hljs-meta">@Autowired</span><br>   UserService userService;<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;UserAddress&gt; <span class="hljs-title">initOrder</span><span class="hljs-params">(String userId)</span> </span>{<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">"用户id："</span>+userId);<br>      <span class="hljs-comment">//1、查询用户的收货地址</span><br>      List&lt;UserAddress&gt; addressList = userService.getUserAddressList(userId);<br>      <span class="hljs-keyword">for</span> (UserAddress userAddress : addressList) {<br>         System.out.println(userAddress.getUserAddress());<br>      }<br>      <span class="hljs-keyword">return</span> addressList;<br>   }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>问题：</strong> UserService的实现在提供者层，我们没有办法直接去调用到！该模块可能在其他服务器！</p>
<p><strong>服务提供者层：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/eb339f8881f52af053bf5b1de90f17be.png" alt=""></p>
<p>pom.xml：</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--引用公共接口层--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itnxd.gmall<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>gmall-interface<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 引入dubbo --&gt;</span><br><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/dubbo --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dubbo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 注册中心使用的是zookeeper，引入操作zookeeper的客户端端 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.curator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>curator-framework<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="创建通道"><a class="header-anchor" href="#创建通道">¶</a>创建通道</h3>
<p>会发现消费者层UserService的实现在提供者层，我们没有办法直接去调用到！该模块可能在其他服务器！</p>
<p>因此就需要一个服务来大同服务器不同地址之间的链接，也就是远程过程调用RPC，我们可以使用Dubbo这个RPC框架实现！</p>
<p><strong>配置提供者provider.xml：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span></span><br><span class="hljs-tag">   <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="hljs-tag">   <span class="hljs-attr">xmlns:dubbo</span>=<span class="hljs-string">"http://code.alibabatech.com/schema/dubbo"</span></span><br><span class="hljs-tag">   <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="hljs-tag"><span class="hljs-string">      http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd</span></span><br><span class="hljs-tag"><span class="hljs-string">      http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd"</span>&gt;</span><br><br>   <span class="hljs-comment">&lt;!-- 1、指定当前服务/应用的名字（同样的服务名字相同，不要和别的服务同名） --&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:application</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"user-service-provider"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:application</span>&gt;</span><br>   <br>   <span class="hljs-comment">&lt;!-- 2、指定注册中心的位置 --&gt;</span><br>   <span class="hljs-comment">&lt;!-- &lt;dubbo:registry address="zookeeper://127.0.0.1:2181"&gt;&lt;/dubbo:registry&gt; --&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:registry</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">"zookeeper"</span> <span class="hljs-attr">address</span>=<span class="hljs-string">"82.156.11.189:2181"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:registry</span>&gt;</span><br>   <br>   <span class="hljs-comment">&lt;!-- 3、指定通信规则（通信协议和通信端口） --&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:protocol</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dubbo"</span> <span class="hljs-attr">port</span>=<span class="hljs-string">"20882"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:protocol</span>&gt;</span><br>   <br>   <span class="hljs-comment">&lt;!-- 4、暴露服务   ref：指向服务的真正的实现对象 --&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:service</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.itnxd.gmall.service.UserService"</span></span><br><span class="hljs-tag">      <span class="hljs-attr">ref</span>=<span class="hljs-string">"userServiceImpl01"</span>&gt;</span><br>      <span class="hljs-comment">&lt;!--&lt;dubbo:method name="getUserAddressList" timeout="1000"&gt;&lt;/dubbo:method&gt;--&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:service</span>&gt;</span><br>    <br>   <span class="hljs-comment">&lt;!-- 服务的实现 --&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userServiceImpl01"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.itnxd.gmall.service.impl.UserServiceImpl"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>配置消费者consumer.xml：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span></span><br><span class="hljs-tag">   <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="hljs-tag">   <span class="hljs-attr">xmlns:dubbo</span>=<span class="hljs-string">"http://dubbo.apache.org/schema/dubbo"</span></span><br><span class="hljs-tag">   <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">"http://www.springframework.org/schema/context"</span></span><br><span class="hljs-tag">   <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="hljs-tag"><span class="hljs-string">      http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd</span></span><br><span class="hljs-tag"><span class="hljs-string">      http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd</span></span><br><span class="hljs-tag"><span class="hljs-string">      http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd"</span>&gt;</span><br><br>   <span class="hljs-comment">&lt;!--当前服务名--&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:application</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"order-service-consumer"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:application</span>&gt;</span><br>   <span class="hljs-comment">&lt;!--声明需要调用的远程服务的接口；生成远程服务代理 (从ZK注册中心获取远程接口UserService的调用地址) --&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:registry</span> <span class="hljs-attr">address</span>=<span class="hljs-string">"zookeeper://82.156.11.189:2181"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:registry</span>&gt;</span><br>   <span class="hljs-comment">&lt;!--引用ZK服务--&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.itnxd.gmall.service.UserService"</span><span class="hljs-attr">id</span>=<span class="hljs-string">"userService"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:reference</span>&gt;</span><br>   <br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>启动提供者进程：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainApplication</span> </span>{<br>   <br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>{<br>      ClassPathXmlApplicationContext ioc = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">"provider.xml"</span>);<br><br>      <span class="hljs-comment">// 提供者开始运行</span><br>      ioc.start();<br>      System.out.println(<span class="hljs-string">"Provider start ..........."</span>);<br><br>      <span class="hljs-comment">// 阻塞中</span><br>      System.in.read();<br>   }<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>启动消费者进程：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainApplication</span> </span>{<br>   <br>   <span class="hljs-meta">@SuppressWarnings("resource")</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>{<br>      ClassPathXmlApplicationContext applicationContext = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">"consumer.xml"</span>);<br>      <br>      OrderService orderService = applicationContext.getBean(OrderService.class);<br><br>      <span class="hljs-comment">// OrderService 该方法调用 UserService（该实现在ZK中已经注册）</span><br>      <span class="hljs-comment">// 因此这里会返回从ZK获取到的地址信息（这就是RPC远程服务调用）</span><br>      System.out.println(<span class="hljs-string">"远程调用开始...."</span>);<br>      orderService.initOrder(<span class="hljs-string">"1"</span>);<br>      System.out.println(<span class="hljs-string">"远程调用完成...."</span>);<br><br>      <span class="hljs-comment">// 阻塞中</span><br>      System.in.read();<br>   }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>**结果：**消费者会获取到提供者暴露到注册中心ZK的服务，获取到订单地址！</p>
<h2 id="4、整合Spring-Boot"><a class="header-anchor" href="#4、整合Spring-Boot">¶</a>4、整合Spring-Boot</h2>
<h3 id="Provider"><a class="header-anchor" href="#Provider">¶</a>Provider</h3>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/4f7e1e400c133a542b2cc54b03381c74.png" alt=""></p>
<p><strong>pom.xml：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itnxd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>Boot-Service-Provider<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>6_Boot-Service-Provider<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>6_Boot-Service-Provider<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--依赖我们的公用接口--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itnxd.gmall<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>gmall-interface<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        以防一堆问题，建议Curator使用4.x</span><br><span class="hljs-comment">        dubbo使用3.0.0及以下</span><br><span class="hljs-comment">    --&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.dubbo/dubbo-spring-boot-starter --&gt;</span><br>    <span class="hljs-comment">&lt;!-- https://github.com/apache/dubbo-spring-boot-project --&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        会自动导入Dubbo3.0.0</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.dubbo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        会自动导入ZK，Curator</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.curator/curator-x-discovery --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.curator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>curator-recipes<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.curator/curator-x-discovery --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.curator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>curator-x-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>application.properties：</strong></p>
<blockquote>
<p>类似xml配置，一个xml标签对应一串点出来的属性！</p>
</blockquote>
<p><strong>注意：建议给ZK地址设置请求参数timeout，且大一点，以防超时无法连接，目前发现连接是很慢的！</strong></p>
<p>参考教程：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://zhuanlan.zhihu.com/p/343204228">https://zhuanlan.zhihu.com/p/343204228</a></p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># ZK服务名</span><br><span class="hljs-meta">dubbo.application.name</span>=<span class="hljs-string">boot-user-service-provider</span><br><span class="hljs-comment"># 新版本dubbo需要配置超时参数，防止zk无法连接</span><br><span class="hljs-meta">dubbo.registry.address</span>=<span class="hljs-string">82.156.11.189:2181?timeout=30000</span><br><span class="hljs-meta">dubbo.registry.protocol</span>=<span class="hljs-string">zookeeper</span><br><br><span class="hljs-comment"># dubbo的通信协议和端口</span><br><span class="hljs-meta">dubbo.protocol.name</span>=<span class="hljs-string">dubbo</span><br><span class="hljs-meta">dubbo.protocol.port</span>=<span class="hljs-string">20880</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>使用@DubboService注解在提供方暴露服务：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@DubboService</span>：新版本为这个</span><br><span class="hljs-comment"> * 旧版本为<span class="hljs-doctag">@Service</span>，当然不是spring的Service注解！</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@DubboService(timeout = 5000)</span> <span class="hljs-comment">// 暴露服务</span><br><span class="hljs-meta">@Service</span> <span class="hljs-comment">// Spring注解，注入IOC容器</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>{<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;UserAddress&gt; <span class="hljs-title">getUserAddressList</span><span class="hljs-params">(String userId)</span> </span>{<br>      System.out.println(<span class="hljs-string">"UserServiceImpl.....old..."</span>);<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      UserAddress address1 = <span class="hljs-keyword">new</span> UserAddress(<span class="hljs-number">1</span>, <span class="hljs-string">"北京市昌平区宏福科技园综合楼3层"</span>, <span class="hljs-string">"1"</span>, <span class="hljs-string">"李老师"</span>, <span class="hljs-string">"010-56253825"</span>, <span class="hljs-string">"Y"</span>);<br>      UserAddress address2 = <span class="hljs-keyword">new</span> UserAddress(<span class="hljs-number">2</span>, <span class="hljs-string">"深圳市宝安区西部硅谷大厦B座3层（深圳分校）"</span>, <span class="hljs-string">"1"</span>, <span class="hljs-string">"王老师"</span>, <span class="hljs-string">"010-56253825"</span>, <span class="hljs-string">"N"</span>);<br><br>      <span class="hljs-keyword">return</span> Arrays.asList(address1,address2);<br>   }<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>使用@EnableDubbo注解开启基于注解的Dubbo功能：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableDubbo</span> <span class="hljs-comment">// 开启基于注解的Dubbo功能！</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> args</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<br>        SpringApplication.run(Application.class, args);<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="Consumer"><a class="header-anchor" href="#Consumer">¶</a>Consumer</h3>
<p>消费者我们使用的是Spring-Boot Web工程！</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/d06221fe083077fb38fb34026da2cb25.png" alt=""></p>
<p><strong>pom.xml：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itnxd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>Boot-Service-Consumer<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>6_Boot-Service-Consumer<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>6_Boot-Service-Consumer<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--依赖公共接口--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itnxd.gmall<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>gmall-interface<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.dubbo/dubbo-spring-boot-starter --&gt;</span><br>    <span class="hljs-comment">&lt;!-- https://github.com/apache/dubbo-spring-boot-project --&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        会自动导入Dubbo3.0.0</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.dubbo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        会自动导入Zk，Curator</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.curator/curator-x-discovery --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.curator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>curator-recipes<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.curator/curator-x-discovery --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.curator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>curator-x-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>application.properties：</strong></p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># Tomcat端口</span><br><span class="hljs-meta">server.port</span>=<span class="hljs-string">8081</span><br><br><span class="hljs-meta">dubbo.application.name</span>=<span class="hljs-string">boot-order-service-consumer</span><br><span class="hljs-comment"># 新版本dubbo需要配置超时参数，防止zk无法连接</span><br><span class="hljs-meta">dubbo.registry.address</span>=<span class="hljs-string">zookeeper://82.156.11.189:2181?timeout=30000</span><br><br><span class="hljs-comment"># dubbo的通信协议和端口</span><br><span class="hljs-meta">dubbo.protocol.name</span>=<span class="hljs-string">dubbo</span><br><span class="hljs-meta">dubbo.protocol.port</span>=<span class="hljs-string">20880</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>OrderController：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderController</span> </span>{<br><br>    <span class="hljs-meta">@Autowired</span><br>    OrderService orderService;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 初始化订单！</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@ResponseBody</span> <span class="hljs-comment">// json方式写到页面</span><br>    <span class="hljs-meta">@RequestMapping("/initOrder")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;UserAddress&gt; <span class="hljs-title">init</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam("uid")</span> String userId)</span></span>{<br>        <span class="hljs-keyword">return</span> orderService.initOrder(userId);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>使用@DubboReference注解在消费者方引用服务：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OrderService</span> </span>{<br><br>   <span class="hljs-comment">//@Autowired</span><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * 不用自动注入了，使用Dubbo中的该注解，远程去ZK获取实现类</span><br><span class="hljs-comment">    * 旧版本为Reference注解，新版为DubboReference，即加了Dubbo前缀！</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@DubboReference</span><br>   UserService userService;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;UserAddress&gt; <span class="hljs-title">initOrder</span><span class="hljs-params">(String userId)</span> </span>{<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">"用户id："</span>+userId);<br>      <span class="hljs-comment">//1、查询用户的收货地址</span><br>      List&lt;UserAddress&gt; addressList = userService.getUserAddressList(userId);<br>      <span class="hljs-keyword">for</span> (UserAddress userAddress : addressList) {<br>         System.out.println(userAddress.getUserAddress());<br>      }<br>      <span class="hljs-keyword">return</span> addressList;<br>   }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>使用@EnableDubbo注解开启基于注解的Dubbo功能：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableDubbo</span> <span class="hljs-comment">// 开启基于注解的Dubbo功能！</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{<br><br>    <span class="hljs-comment">// 启动成功，访问 http://localhost:8081/initOrder?uid=1即可</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<br>        SpringApplication.run(Application.class, args);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="测试"><a class="header-anchor" href="#测试">¶</a>测试</h3>
<p>启动提供者和消费者两个主程序，访问 <a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:8081/initOrder?uid=1">http://localhost:8081/initOrder?uid=1</a> 即可，会将信息以Json字符串形式返回到页面！</p>
<h1 id="四、Dubbo配置"><a class="header-anchor" href="#四、Dubbo配置">¶</a>四、Dubbo配置</h1>
<h2 id="1、配置原则"><a class="header-anchor" href="#1、配置原则">¶</a>1、配置原则</h2>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/1e10b6b761953f7d97e8d9d0f79694a4.png" alt=""></p>
<ol>
<li>JVM 启动 -D 参数优先，这样可以使用户在部署和启动时进行参数重写，比如在启动时需改变协议的端口。</li>
<li>XML 次之，如果在 XML 中有配置，则 dubbo.properties 中的相应配置项无效。</li>
<li>Properties 最后，相当于缺省值，只有 XML 没有配置时，dubbo.properties 的相应配置项才会生效，<strong>通常用于共享公共配置</strong>，比如应用名。</li>
</ol>
<p><strong>生效顺序：</strong> JVM -&gt; XML -&gt; application.properties -&gt; dubbo.properties</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/36b1d283b01062faf0fab779b0d9cc95.png" alt=""></p>
<p><strong>JVM参数设置：</strong> 右键More Run中找！</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/8a52ad7cc1cca298ff6d0974a79d07e4.png" alt=""></p>
<h2 id="2、启动时检查"><a class="header-anchor" href="#2、启动时检查">¶</a>2、启动时检查</h2>
<blockquote>
<p>官方文档：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://dubbo.apache.org/zh/docs/advanced/preflight-check/">https://dubbo.apache.org/zh/docs/advanced/preflight-check/</a></p>
</blockquote>
<p>在启动时检查依赖的服务ZK是否可用，可以关闭不进行检查，用到再进行检查！</p>
<p>注意：要想演示效果，记得将ZK先全部清空！</p>
<p>默认Check值为true！</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--消费者方配置--&gt;</span><br>指定接口不检查：<br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.itnxd.gmall.service.UserService"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userService"</span> <span class="hljs-attr">check</span>=<span class="hljs-string">"false"</span>/&gt;</span><br>全局不检查：<br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:consumer</span> <span class="hljs-attr">check</span>=<span class="hljs-string">"false"</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">"5000"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:consumer</span>&gt;</span><br>注册中心<br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:registry</span> <span class="hljs-attr">check</span>=<span class="hljs-string">"false"</span> /&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p>Spring-Boot配置：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">dubbo.consumer.check=false（全局）<br>@DubboReference(check=false)（单个接口）<br></code></pre></td></tr></tbody></table></figure>
<h2 id="3、超时配置"><a class="header-anchor" href="#3、超时配置">¶</a>3、超时配置</h2>
<p>由于网络或服务端不可靠，会导致调用出现一种不确定的中间状态（超时）。为了避免超时导致客户端资源（线程）挂起耗尽，必须设置超时时间。</p>
<p>默认1000ms！</p>
<p><strong>xml方式：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.itnxd.gmall.service.UserService"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userService"</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">"5000"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"getUserAddressList"</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">"1000"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:method</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:reference</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:service</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.itnxd.gmall.service.UserService"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userService"</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">"5000"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"getUserAddressList"</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">"1000"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:method</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:service</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.itnxd.gmall.service.UserService"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userService"</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">"1000"</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:service</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.itnxd.gmall.service.UserService"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userService"</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">"1000"</span>/&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:consumer</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">"5000"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:consumer</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:provider</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">"5000"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:provider</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>注解形式：</strong></p>
<p>一般使用在提供方DubboService！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DubboService(timeout = 3000)</span><br><span class="hljs-meta">@DubboReference(timeout = 3000)</span><br></code></pre></td></tr></tbody></table></figure>
<h2 id="4、配置覆盖策略"><a class="header-anchor" href="#4、配置覆盖策略">¶</a>4、配置覆盖策略</h2>
<ul>
<li>精确优先 (方法级优先，接口级次之，全局配置再次之)</li>
<li>消费者设置优先 (如果级别一样，则消费方优先，提供方次之)</li>
</ul>
<p><strong>配置原则：</strong> dubbo推荐在Provider上尽量多配置Consumer端属性：</p>
<ul>
<li>作服务的提供者，比服务使用方更清楚服务性能参数，如调用的超时时间，合理的重试次数，等等</li>
<li>在Provider配置后，Consumer不配置则会使用Provider的配置值，即Provider配置可以作为Consumer的缺省值。否则，Consumer会使用Consumer端的全局设置，这对于Provider不可控的，并且往往是不合理的</li>
</ul>
<p><strong>图示：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/c152cf7135ac1d719562b12db364d47d.png" alt=""></p>
<h2 id="5、重试次数"><a class="header-anchor" href="#5、重试次数">¶</a>5、重试次数</h2>
<p>失败自动切换，当出现失败，重试其它服务器，但重试会带来更长延迟。可通过 retries=“x” 来设置重试次数(<strong>不含第一次</strong>)。</p>
<p>幂等操作可以重试，非幂等操作不可以！</p>
<ul>
<li>幂等：例如查询、删除、修改</li>
<li>非幂等：例如增加</li>
</ul>
<p><strong>xml方式：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:service</span> <span class="hljs-attr">retries</span>=<span class="hljs-string">"2"</span> /&gt;</span><br>或<br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">retries</span>=<span class="hljs-string">"2"</span> /&gt;</span><br>或<br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"findFoo"</span> <span class="hljs-attr">retries</span>=<span class="hljs-string">"2"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:reference</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>注解方式：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DubboService(retries = 3)</span><br></code></pre></td></tr></tbody></table></figure>
<h2 id="6、多版本"><a class="header-anchor" href="#6、多版本">¶</a>6、多版本</h2>
<blockquote>
<p>官方文档：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://dubbo.apache.org/zh/docs/advanced/multi-versions/">https://dubbo.apache.org/zh/docs/advanced/multi-versions/</a></p>
</blockquote>
<p>当一个接口实现，出现不兼容升级时，可以用版本号过渡，版本号不同的服务相互间不引用。</p>
<p><strong>可以按照以下的步骤进行版本迁移：</strong></p>
<ul>
<li>在低压力时间段，先升级一半提供者为新版本</li>
<li>再将所有消费者升级为新版本</li>
<li>然后将剩下的一半提供者升级为新版本</li>
</ul>
<p><strong>xml方式：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml">老版本服务提供者配置：<br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:service</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.foo.BarService"</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"1.0.0"</span> /&gt;</span><br><br>新版本服务提供者配置：<br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:service</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.foo.BarService"</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"2.0.0"</span> /&gt;</span><br><br>老版本服务消费者配置：<br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"barService"</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.foo.BarService"</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"1.0.0"</span> /&gt;</span><br><br>新版本服务消费者配置：<br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"barService"</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.foo.BarService"</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"2.0.0"</span> /&gt;</span><br><br>如果不需要区分版本，可以按照以下的方式配置：<br>version：*代表随机调用，填写provider的版本号实现控制版本！<br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"barService"</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.foo.BarService"</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"*"</span> /&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>注解方式：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service(version = "v1.0")</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl1</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>{...}<br><br><span class="hljs-meta">@Reference(version = "v1.0")</span><br><span class="hljs-keyword">private</span> UserService userService;<br></code></pre></td></tr></tbody></table></figure>
<h2 id="7、本地存根"><a class="header-anchor" href="#7、本地存根">¶</a>7、本地存根</h2>
<blockquote>
<p>官方文档：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://dubbo.apache.org/zh/docs/advanced/local-stub/">https://dubbo.apache.org/zh/docs/advanced/local-stub/</a></p>
</blockquote>
<p>类似动态代理，在调用提供方的服务之前先做一点判断！</p>
<p>在接口上增加stub配置，指向该本地存根的全类名！</p>
<p>会先进行本地存根的判断，再判断是否远程调用！</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/25cc2c563aff6da130e20710dbb1df29.png" alt=""></p>
<p><strong>consumer.xml配置：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"com.itnxd.gmall.service.UserService"</span></span><br><span class="hljs-tag">   <span class="hljs-attr">id</span>=<span class="hljs-string">"userService"</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">"5000"</span> <span class="hljs-attr">retries</span>=<span class="hljs-string">"3"</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"*"</span></span><br><span class="hljs-tag">             <span class="hljs-attr">stub</span>=<span class="hljs-string">"com.itnxd.gmall.service.impl.UserServiceStub"</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:reference</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>UserServiceStub.java：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itnxd.gmall.service.impl;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">import</span> org.springframework.util.StringUtils;<br><br><span class="hljs-keyword">import</span> com.itnxd.gmall.bean.UserAddress;<br><span class="hljs-keyword">import</span> com.itnxd.gmall.service.UserService;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceStub</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>{<br>   <br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserService userService;<br>   <br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * 传入的是userService远程的代理对象</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> userService</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserServiceStub</span><span class="hljs-params">(UserService userService)</span> </span>{<br>      <span class="hljs-keyword">super</span>();<br>      <span class="hljs-keyword">this</span>.userService = userService;<br>   }<br><br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * https://dubbo.apache.org/zh/docs/advanced/local-stub/</span><br><span class="hljs-comment">    * 经过一层判断后再进行调用！</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> userId</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;UserAddress&gt; <span class="hljs-title">getUserAddressList</span><span class="hljs-params">(String userId)</span> </span>{<br>      <span class="hljs-comment">// TODO Auto-generated method stub</span><br>      System.out.println(<span class="hljs-string">"UserServiceStub....."</span>);<br>      <span class="hljs-comment">// userId非空串时再进行调用！</span><br>      <span class="hljs-keyword">if</span>(!StringUtils.isEmpty(userId)) {<br>         <span class="hljs-keyword">return</span> userService.getUserAddressList(userId);<br>      }<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>   }<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<h1 id="五、SpringBoot整合三种方式"><a class="header-anchor" href="#五、SpringBoot整合三种方式">¶</a>五、SpringBoot整合三种方式</h1>
<h2 id="1、properties方式"><a class="header-anchor" href="#1、properties方式">¶</a>1、properties方式</h2>
<ul>
<li>导入dubbo-starter</li>
<li>在application.properties中配置属性</li>
<li>使用@DubboService暴露服务，使用@DubboReference引用服务</li>
<li>在Boot启动类上使用@EnableDubbo开启Dubbo注解！</li>
</ul>
<p>老版本也可使用dubbo.scan.base-packages指定包扫描！就不需要配置@EnableDubbo注解了！</p>
<h2 id="2、xml方式"><a class="header-anchor" href="#2、xml方式">¶</a>2、xml方式</h2>
<ul>
<li>保留 xml 配置文件，导入dubbo-starter</li>
<li>使用<code>@ImportResource(locations = "classpath:provider.xml")</code>指定配置位置</li>
</ul>
<h2 id="3、配置类方式"><a class="header-anchor" href="#3、配置类方式">¶</a>3、配置类方式</h2>
<ul>
<li>将每一个组件手动创建到配置类中！</li>
<li>使用@DubboComponentScan或者@EnableDubbo注解指定扫描包（EnableDubbo也实现了@DubboComponentScan）</li>
<li>使用@DubboReference引用服务，使用@DubboService暴露服务（与配置类暴露方法互不影响）。</li>
</ul>
<p><strong>配置类：</strong></p>
<p>xml中的每一个表现都对应一个xxxConfig类用于配置！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itnxd.gmall.config;<br><br><span class="hljs-keyword">import</span> com.itnxd.gmall.service.UserService;<br><span class="hljs-keyword">import</span> org.apache.dubbo.config.*;<br><span class="hljs-keyword">import</span> org.apache.dubbo.rpc.Protocol;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.security.SecurityProperties;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-keyword">import</span> java.util.Arrays;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * xml中的每一个表现都对应一个xxxConfig类用于配置！</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ITNXD</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2021-09-30 17:52</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDubboConfig</span> </span>{<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ApplicationConfig <span class="hljs-title">applicationConfig</span><span class="hljs-params">()</span></span>{<br>        ApplicationConfig applicationConfig = <span class="hljs-keyword">new</span> ApplicationConfig();<br>        applicationConfig.setName(<span class="hljs-string">"boot-user-service-provider"</span>);<br>        <span class="hljs-comment">// ...</span><br>        <span class="hljs-keyword">return</span> applicationConfig;<br>    }<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> RegistryConfig <span class="hljs-title">registryConfig</span><span class="hljs-params">()</span></span>{<br>        RegistryConfig registryConfig = <span class="hljs-keyword">new</span> RegistryConfig();<br>        registryConfig.setProtocol(<span class="hljs-string">"zookeeper"</span>);<br>        registryConfig.setAddress(<span class="hljs-string">"82.156.11.189:2181?timeout=30000"</span>);<br>        <span class="hljs-keyword">return</span> registryConfig;<br>    }<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ProtocolConfig <span class="hljs-title">protocolConfig</span><span class="hljs-params">()</span></span>{<br>        ProtocolConfig protocolConfig = <span class="hljs-keyword">new</span> ProtocolConfig();<br>        protocolConfig.setName(<span class="hljs-string">"dubbo"</span>);<br>        protocolConfig.setPort(<span class="hljs-number">20880</span>);<br>        <span class="hljs-keyword">return</span> protocolConfig;<br>    }<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ServiceConfig&lt;UserService&gt; <span class="hljs-title">serviceServiceConfig</span><span class="hljs-params">(UserService userService)</span></span>{<br>        ServiceConfig&lt;UserService&gt; userServiceServiceConfig = <span class="hljs-keyword">new</span> ServiceConfig&lt;&gt;();<br>        userServiceServiceConfig.setInterface(UserService.class);<br>        <span class="hljs-comment">// 暴露服务</span><br>        userServiceServiceConfig.setRef(userService);<br>        userServiceServiceConfig.setVersion(<span class="hljs-string">"1.0.0"</span>);<br><br>        <span class="hljs-comment">// 配置userService中的method信息！</span><br>        MethodConfig methodConfig = <span class="hljs-keyword">new</span> MethodConfig();<br>        methodConfig.setName(<span class="hljs-string">"getUserAddressList"</span>);<br>        methodConfig.setTimeout(<span class="hljs-number">5000</span>);<br><br>        <span class="hljs-comment">// 将method设置保存到Service中</span><br>        userServiceServiceConfig.setMethods(Arrays.asList(methodConfig));<br>        <span class="hljs-keyword">return</span> userServiceServiceConfig;<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>三种方式：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// @ImportResource(locations = "classpath:provider.xml") 第二种</span><br><span class="hljs-meta">@EnableDubbo</span> <span class="hljs-comment">// 开启基于注解的Dubbo功能！第一种</span><br><span class="hljs-comment">// @EnableDubbo(scanBasePackages = "com.itnxd.gmall") // 第三种</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{<br>    ...<br>}<br></code></pre></td></tr></tbody></table></figure>
<h1 id="六、高可用"><a class="header-anchor" href="#六、高可用">¶</a>六、高可用</h1>
<h2 id="1、Dubbo直连"><a class="header-anchor" href="#1、Dubbo直连">¶</a>1、Dubbo直连</h2>
<p>**现象：**zookeeper注册中心宕机，还可以消费dubbo暴露的服务。</p>
<p><strong>健壮性：</strong></p>
<ol>
<li>监控中心宕掉不影响使用，只是丢失部分采样数据</li>
<li>数据库宕掉后，注册中心仍能通过缓存提供服务列表查询，但不能注册新服务</li>
<li>注册中心对等集群，任意一台宕掉后，将自动切换到另一台</li>
<li><strong>注册中心全部宕掉后，服务提供者和服务消费者仍能通过本地缓存通讯</strong> （ZK挂完了，也有本地缓存）</li>
<li>服务提供者无状态，任意一台宕掉后，不影响使用</li>
<li>服务提供者全部宕掉后，服务消费者应用将无法使用，并无限次重连等待服务提供者恢复</li>
</ol>
<p>**高可用：**通过设计，减少系统不能提供服务的时间；</p>
<p><strong>直连设置：</strong></p>
<p>在@DubboReference注解中指定直连地址即可！</p>
<p>dubbo直连，绕过注册中心ZK！</p>
<p>虽然我无法直连…</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DubboReference(url = "127.0.0.1:20880")</span><br>UserService userService;<br></code></pre></td></tr></tbody></table></figure>
<h2 id="2、负载均衡"><a class="header-anchor" href="#2、负载均衡">¶</a>2、负载均衡</h2>
<blockquote>
<p>官方文档：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://dubbo.apache.org/zh/docs/advanced/loadbalance/">https://dubbo.apache.org/zh/docs/advanced/loadbalance/</a></p>
</blockquote>
<p>在集群负载均衡时，Dubbo 提供了多种均衡策略，<strong>缺省为</strong> <strong>random</strong> <strong>随机调用</strong>。</p>
<p><strong>Random LoadBalance</strong></p>
<p>随机，按权重设置随机概率。</p>
<p>在一个截面上碰撞的概率高，但调用量越大分布越均匀，而且按概率使用权重后也比较均匀，有利于动态调整提供者权重。</p>
<p><strong>RoundRobin LoadBalance</strong></p>
<p>轮循，按公约后的权重设置轮循比率。</p>
<p>存在慢的提供者累积请求的问题，比如：第二台机器很慢，但没挂，当请求调到第二台时就卡在那，久而久之，所有请求都卡在调到第二台上。</p>
<p>示意图：用完一个比例的，则不会再调用！</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/81a51f499c563bd2cfef5806429601b2.png" alt=""></p>
<p><strong>LeastActive LoadBalance</strong></p>
<p>最少活跃调用数，相同活跃数的随机，<strong>活跃数指调用前后计数差</strong>。</p>
<p>使慢的提供者收到更少请求，因为越慢的提供者的调用前后计数差会越大。</p>
<p><strong>ConsistentHash LoadBalance</strong></p>
<p>一致性 Hash，相同参数的请求总是发到同一提供者。</p>
<p>当某一台提供者挂时，原本发往该提供者的请求，基于虚拟节点，平摊到其它提供者，不会引起剧烈变动。</p>
<p>缺省只对第一个参数 Hash，如果要修改，请配置 <code>&lt;dubbo:parameter key="hash.arguments" value="0,1" /&gt;</code></p>
<p>缺省用 160 份虚拟节点，如果要修改，请配置 <code>&lt;dubbo:parameter key="hash.nodes" value="320" /&gt;</code></p>
<p><strong>同一个程序多启动配置，将下方勾选即可：</strong></p>
<p>可以用来模拟多个消费者，模拟多种负载均衡策略！</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/d7a7f94631c9ee598f04b3155a4e2c1b.png" alt=""></p>
<p>负载均衡策略名查看官网：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://dubbo.apache.org/zh/docs/advanced/loadbalance/">https://dubbo.apache.org/zh/docs/advanced/loadbalance/</a></p>
<p><strong>负载均衡配置：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DubboReference(loadbalance = "random")</span><br><span class="hljs-meta">@DubboReference(loadbalance = "roundrobin")</span><br><span class="hljs-meta">@DubboReference(loadbalance = "leastactive")</span><br><span class="hljs-meta">@DubboReference(loadbalance = "consistenthash")</span><br>UserService userService;<br></code></pre></td></tr></tbody></table></figure>
<p><strong>xml中配置：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml">服务端服务级别<br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:service</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"..."</span> <span class="hljs-attr">loadbalance</span>=<span class="hljs-string">"roundrobin"</span> /&gt;</span><br>客户端服务级别<br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"..."</span> <span class="hljs-attr">loadbalance</span>=<span class="hljs-string">"roundrobin"</span> /&gt;</span><br>服务端方法级别<br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:service</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"..."</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"..."</span> <span class="hljs-attr">loadbalance</span>=<span class="hljs-string">"roundrobin"</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:service</span>&gt;</span><br>客户端方法级别<br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">"..."</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"..."</span> <span class="hljs-attr">loadbalance</span>=<span class="hljs-string">"roundrobin"</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:reference</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>注意：</strong></p>
<ul>
<li>可以在dubbo-admin控制台进行快速加权和减权！</li>
<li>也可在@DubboService注解暴露服务时进行指定权重weight属性！</li>
</ul>
<h2 id="3、服务降级"><a class="header-anchor" href="#3、服务降级">¶</a>3、服务降级</h2>
<blockquote>
<p>官方文档：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://dubbo.apache.org/zh/docs/advanced/service-downgrade/">https://dubbo.apache.org/zh/docs/advanced/service-downgrade/</a></p>
</blockquote>
<p>当服务器压力剧增的情况下，根据实际业务情况及流量，对一些服务和页面有策略的不处理或换种简单的方式处理，从而释放服务器资源以保证核心交易正常运作或高效运作。</p>
<p>可以通过服务降级功能临时屏蔽某个出错的非关键服务，并定义降级后的返回策略。</p>
<ul>
<li><code>mock=force:return+null</code>：表示消费方对该服务的方法调用都直接返回 null 值，不发起远程调用。用来屏蔽不重要服务不可用时对调用方的影响。</li>
<li><code>mock=fail:return+null</code>：表示消费方对该服务的方法调用在失败后，再返回 null 值，不抛异常。用来容忍不重要服务不稳定时对调用方的影响。（<strong>例如超时</strong>）</li>
</ul>
<p><strong>xml方式：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:provider</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">"1000"</span> <span class="hljs-attr">mock</span>=<span class="hljs-string">"force : return null"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:provider</span>&gt;</span><br>...<br></code></pre></td></tr></tbody></table></figure>
<p><strong>注解方式：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DubboReference(mock = "force : return null")</span><br></code></pre></td></tr></tbody></table></figure>
<h2 id="4、集群容错"><a class="header-anchor" href="#4、集群容错">¶</a>4、集群容错</h2>
<blockquote>
<p>官方文档：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://dubbo.apache.org/zh/docs/advanced/fault-tolerent-strategy/">https://dubbo.apache.org/zh/docs/advanced/fault-tolerent-strategy/</a></p>
</blockquote>
<p>在集群调用失败时，Dubbo 提供了多种容错方案，<strong>缺省为 failover 重试</strong>。</p>
<p><strong>Failover Cluster（默认）</strong></p>
<p>失败自动切换，当出现失败，重试其它服务器。通常用于读操作，但重试会带来更长延迟。可通过 <code>retries="x"</code> 来设置重试次数(不含第一次)。</p>
<p><strong>Failfast Cluster</strong></p>
<p>快速失败，只发起一次调用，失败立即报错。通常用于非幂等性的写操作，比如新增记录。</p>
<p><strong>Failsafe Cluster</strong></p>
<p>失败安全，出现异常时，直接忽略。通常用于写入审计日志等操作。</p>
<p><strong>Failback Cluster</strong></p>
<p>失败自动恢复，后台记录失败请求，定时重发。通常用于消息通知操作。</p>
<p><strong>Forking Cluster</strong></p>
<p>并行调用多个服务器，只要一个成功即返回。通常用于实时性要求较高的读操作，但需要浪费更多服务资源。可通过 forks=“2” 来设置最大并行数。</p>
<p><strong>Broadcast Cluster</strong></p>
<p>广播调用所有提供者，逐个调用，任意一台报错则报错 [2]。通常用于通知所有提供者更新缓存或日志等本地资源信息。</p>
<p><strong>集群模式配置</strong></p>
<p>按照以下示例在服务提供方和消费方配置集群模式！</p>
<p><strong>xml配置：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:service</span> <span class="hljs-attr">cluster</span>=<span class="hljs-string">"failsafe"</span> /&gt;</span><br>或<br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span> <span class="hljs-attr">cluster</span>=<span class="hljs-string">"failsafe"</span> /&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>注解配置：</strong></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">@Reference(cluster = "failover")<br></code></pre></td></tr></tbody></table></figure>
<h2 id="5、整合hystrix"><a class="header-anchor" href="#5、整合hystrix">¶</a>5、整合hystrix</h2>
<p>Hystrix 旨在通过控制那些访问远程系统、服务和第三方库的节点，从而对延迟和故障提供更强大的容错能力。Hystrix具备拥有回退机制和断路器功能的线程和信号隔离，请求缓存和请求打包，以及监控和配置等功能！</p>
<p>可能是版本问题，换了多个版本都无法运行…</p>
<p><strong>pom.xml：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-netflix-hystrix --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>然后在Application类上增加@EnableHystrix来启用hystrix starter：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableHystrix</span> <span class="hljs-comment">// 开启Hystrix服务容错</span><br><span class="hljs-meta">@EnableDubbo</span> <span class="hljs-comment">// 开启基于注解的Dubbo功能！</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{<br>    ..<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>配置Provider端：</strong></p>
<p>在Dubbo的Provider上增加@HystrixCommand配置，这样子调用就会经过Hystrix代理。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@HystrixCommand</span> <span class="hljs-comment">// 出异常使用Hystrix代理</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;UserAddress&gt; <span class="hljs-title">getUserAddressList</span><span class="hljs-params">(String userId)</span> </span>{<br>    System.out.println(<span class="hljs-string">"UserServiceImpl.....old..."</span>);<br>    <span class="hljs-comment">// TODO Auto-generated method stub</span><br>    UserAddress address1 = <span class="hljs-keyword">new</span> UserAddress(<span class="hljs-number">1</span>, <span class="hljs-string">"北京市昌平区宏福科技园综合楼3层"</span>, <span class="hljs-string">"1"</span>, <span class="hljs-string">"李老师"</span>, <span class="hljs-string">"010-56253825"</span>, <span class="hljs-string">"Y"</span>);<br>    UserAddress address2 = <span class="hljs-keyword">new</span> UserAddress(<span class="hljs-number">2</span>, <span class="hljs-string">"深圳市宝安区西部硅谷大厦B座3层（深圳分校）"</span>, <span class="hljs-string">"1"</span>, <span class="hljs-string">"王老师"</span>, <span class="hljs-string">"010-56253825"</span>, <span class="hljs-string">"N"</span>);<br><br>    <span class="hljs-comment">// 模拟异常</span><br>    <span class="hljs-keyword">if</span>(Math.random() &gt; <span class="hljs-number">0.5</span>){<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException();<br>    }<br>    <span class="hljs-keyword">return</span> Arrays.asList(address1,address2);<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>配置Consumer端：</strong></p>
<p>对于Consumer端，则可以增加一层method调用，并在method上配置@HystrixCommand。当调用出错时，会走到<code>fallbackMethod = "xx"</code>的调用里。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DubboReference(loadbalance = "roundrobin")</span> <span class="hljs-comment">// 设置复制均衡策略</span><br>UserService userService;<br><br><span class="hljs-comment">// 异常后进行回调hello方法</span><br><span class="hljs-meta">@HystrixCommand(fallbackMethod = "hello")</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;UserAddress&gt; <span class="hljs-title">initOrder</span><span class="hljs-params">(String userId)</span> </span>{<br>   <span class="hljs-comment">// TODO Auto-generated method stub</span><br>   System.out.println(<span class="hljs-string">"用户id："</span>+userId);<br>   <span class="hljs-comment">//1、查询用户的收货地址</span><br>   List&lt;UserAddress&gt; addressList = userService.getUserAddressList(userId);<br>   <span class="hljs-keyword">for</span> (UserAddress userAddress : addressList) {<br>      System.out.println(userAddress.getUserAddress());<br>   }<br>   <span class="hljs-keyword">return</span> addressList;<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;UserAddress&gt; <span class="hljs-title">hello</span> <span class="hljs-params">(String userId)</span> </span>{<br>   <span class="hljs-comment">// TODO Auto-generated method stub</span><br>   <span class="hljs-keyword">return</span> Arrays.asList(<span class="hljs-keyword">new</span> UserAddress(<span class="hljs-number">10</span>,<span class="hljs-string">"测试地址"</span>,<span class="hljs-string">"1"</span>, <span class="hljs-string">"hh"</span>, <span class="hljs-string">"hh"</span>, <span class="hljs-string">"hh"</span>));<br>}<br></code></pre></td></tr></tbody></table></figure>
<h1 id="七、Dubbo原理"><a class="header-anchor" href="#七、Dubbo原理">¶</a>七、Dubbo原理</h1>
<h2 id="1、RPC原理"><a class="header-anchor" href="#1、RPC原理">¶</a>1、RPC原理</h2>
<p><strong>原理图示：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/826080cb84a762a7cccc3acd2550358e.png" alt=""></p>
<p><strong>一次完整的RPC调用流程如下：</strong></p>
<ol>
<li><strong>服务消费方（client）调用以本地调用方式调用服务；</strong></li>
<li>client stub接收到调用后负责将方法、参数等组装成能够进行网络传输的消息体；</li>
<li>client stub找到服务地址，并将消息发送到服务端；</li>
<li>server stub收到消息后进行解码；</li>
<li>server stub根据解码结果调用本地的服务；</li>
<li>本地服务执行并将结果返回给server  stub；</li>
<li>server stub将返回结果打包成消息并发送至消费方；</li>
<li>client stub接收到消息，并进行解码；</li>
<li><strong>服务消费方得到最终结果。</strong></li>
</ol>
<p><strong>RPC框架的目标就是要2~8这些步骤都封装起来，这些细节对用户来说是透明的，不可见的。</strong></p>
<h2 id="2、Netty通信原理"><a class="header-anchor" href="#2、Netty通信原理">¶</a>2、Netty通信原理</h2>
<p>Netty是一个<strong>异步</strong>事件驱动的网络应用程序框架， 用于快速开发可维护的高性能协议服务器和客户端。它极大地简化并简化了TCP和UDP套接字服务器等网络编程。</p>
<p><strong>BIO：(Blocking IO)</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/ff1180b37e5b13982db37362a6783034.png" alt=""></p>
<p><strong>NIO (Non-Blocking IO)</strong></p>
<p>Selector 一般称 为<strong>选择器</strong> ，也可以翻译为 <strong>多路复用器，</strong></p>
<p>Connect（连接就绪）、Accept（接受就绪）、Read（读就绪）、Write（写就绪）</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/3977a864002eaf92f4572f16c11ca643.png" alt=""></p>
<p><strong>Netty基本原理：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/b40610f939fa281f94ae7859f2db6ed4.png" alt=""></p>
<h2 id="3、Dubbo原理"><a class="header-anchor" href="#3、Dubbo原理">¶</a>3、Dubbo原理</h2>
<h3 id="dubbo原理-框架设计"><a class="header-anchor" href="#dubbo原理-框架设计">¶</a>dubbo原理 - 框架设计</h3>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/3db0b83e1a318bd1a70eda097351b316.png" alt=""></p>
<ul>
<li>config 配置层：对外配置接口，以 ServiceConfig, ReferenceConfig 为中心，可以直接初始化配置类，也可以通过 spring 解析配置生成配置类</li>
<li>proxy 服务代理层：服务接口透明代理，生成服务的客户端 Stub 和服务器端 Skeleton, 以 ServiceProxy 为中心，扩展接口为 ProxyFactory</li>
<li>registry 注册中心层：封装服务地址的注册与发现，以服务 URL 为中心，扩展接口为 RegistryFactory, Registry, RegistryService</li>
<li>cluster 路由层：封装多个提供者的路由及负载均衡，并桥接注册中心，以 Invoker 为中心，扩展接口为 Cluster, Directory, Router, LoadBalance</li>
<li>monitor 监控层：RPC 调用次数和调用时间监控，以 Statistics 为中心，扩展接口为 MonitorFactory, Monitor, MonitorService</li>
<li>protocol 远程调用层：封装 RPC 调用，以 Invocation, Result 为中心，扩展接口为 Protocol, Invoker, Exporter</li>
<li>exchange 信息交换层：封装请求响应模式，同步转异步，以 Request, Response 为中心，扩展接口为 Exchanger, ExchangeChannel,ExchangeClient, ExchangeServer</li>
<li>transport 网络传输层：抽象 mina 和 netty 为统一接口，以 Message 为中心，扩展接口为 Channel, Transporter, Client, Server, Codec</li>
<li>serialize 数据序列化层：可复用的一些工具，扩展接口为 Serialization, ObjectInput, ObjectOutput, ThreadPool</li>
</ul>
<h3 id="dubbo原理-服务暴露"><a class="header-anchor" href="#dubbo原理-服务暴露">¶</a>dubbo原理 - 服务暴露</h3>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/ad8567c7d1aa9fa5bb1538b7d1231551.png" alt=""></p>
<h3 id="dubbo原理-服务引用"><a class="header-anchor" href="#dubbo原理-服务引用">¶</a>dubbo原理 - 服务引用</h3>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/38c17adb7041fef1b18ca5c3592939a1.png" alt=""></p>
<h3 id="dubbo原理-服务调用"><a class="header-anchor" href="#dubbo原理-服务调用">¶</a>dubbo原理 - 服务调用</h3>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/9f2d8cb36f584ff6551a333251389754.png" alt=""></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined" rel="external nofollow noreferrer">ITNXD</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.itnxd.cn/posts/23425.html">https://www.itnxd.cn/posts/23425.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.itnxd.cn" target="_blank">小牛博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Dubbo/">Dubbo</a></div><div class="post_share"><div class="social-share" data-image="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/01/27c3919bb7046bc5ece2657118592e38.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://gitcode.net/qq_43590403/images/-/raw/master/img/WeChantQR.jpg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="https://gitcode.net/qq_43590403/images/-/raw/master/img/WeChantQR.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://gitcode.net/qq_43590403/images/-/raw/master/img/AliPayQR.jpg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="https://gitcode.net/qq_43590403/images/-/raw/master/img/AliPayQR.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/49375.html"><img class="prev-cover" src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/04/bad5b13b191abdc4a6020f51449722c3.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">高级消息队列、开源消息代理软件、面向消息的中间件 RabbitMQ 介绍</div></div></a></div><div class="next-post pull-right"><a href="/posts/34316.html"><img class="next-cover" src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/09/28/5efed5f7a5d8a6e858152e7c78b31007.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">互联网分布式注册中心Zookeeper介绍</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E4%BB%8B%E7%BB%8D"><span class="toc-text">一、分布式介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">1、是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%8F%91%E5%B1%95%E6%BC%94%E5%8F%98"><span class="toc-text">2、发展演变</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%B8%80%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84"><span class="toc-text">单一应用架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9E%82%E7%9B%B4%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84"><span class="toc-text">垂直应用架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="toc-text">分布式服务架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E5%8A%A8%E8%AE%A1%E7%AE%97%E6%9E%B6%E6%9E%84"><span class="toc-text">流动计算架构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Dubbo%E4%BB%8B%E7%BB%8D"><span class="toc-text">二、Dubbo介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E7%AE%80%E4%BB%8B"><span class="toc-text">1、简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81RPC%E4%BB%8B%E7%BB%8D"><span class="toc-text">2、RPC介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81Dubbo%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-text">3、Dubbo基本概念</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81Dubbo%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">三、Dubbo环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Zookeeper%E5%AE%89%E8%A3%85"><span class="toc-text">1、Zookeeper安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Dubbo-Admin%E5%AE%89%E8%A3%85"><span class="toc-text">2、Dubbo-Admin安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81Dubbo-HelloWorld"><span class="toc-text">3、Dubbo-HelloWorld</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E9%9C%80%E6%B1%82"><span class="toc-text">功能需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%9D%97"><span class="toc-text">创建模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%80%9A%E9%81%93"><span class="toc-text">创建通道</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%95%B4%E5%90%88Spring-Boot"><span class="toc-text">4、整合Spring-Boot</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Provider"><span class="toc-text">Provider</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Consumer"><span class="toc-text">Consumer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Dubbo%E9%85%8D%E7%BD%AE"><span class="toc-text">四、Dubbo配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E9%85%8D%E7%BD%AE%E5%8E%9F%E5%88%99"><span class="toc-text">1、配置原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%90%AF%E5%8A%A8%E6%97%B6%E6%A3%80%E6%9F%A5"><span class="toc-text">2、启动时检查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%B6%85%E6%97%B6%E9%85%8D%E7%BD%AE"><span class="toc-text">3、超时配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E9%85%8D%E7%BD%AE%E8%A6%86%E7%9B%96%E7%AD%96%E7%95%A5"><span class="toc-text">4、配置覆盖策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E9%87%8D%E8%AF%95%E6%AC%A1%E6%95%B0"><span class="toc-text">5、重试次数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E5%A4%9A%E7%89%88%E6%9C%AC"><span class="toc-text">6、多版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E6%9C%AC%E5%9C%B0%E5%AD%98%E6%A0%B9"><span class="toc-text">7、本地存根</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81SpringBoot%E6%95%B4%E5%90%88%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-text">五、SpringBoot整合三种方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81properties%E6%96%B9%E5%BC%8F"><span class="toc-text">1、properties方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81xml%E6%96%B9%E5%BC%8F"><span class="toc-text">2、xml方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E9%85%8D%E7%BD%AE%E7%B1%BB%E6%96%B9%E5%BC%8F"><span class="toc-text">3、配置类方式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-text">六、高可用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Dubbo%E7%9B%B4%E8%BF%9E"><span class="toc-text">1、Dubbo直连</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-text">2、负载均衡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7"><span class="toc-text">3、服务降级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E9%9B%86%E7%BE%A4%E5%AE%B9%E9%94%99"><span class="toc-text">4、集群容错</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E6%95%B4%E5%90%88hystrix"><span class="toc-text">5、整合hystrix</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81Dubbo%E5%8E%9F%E7%90%86"><span class="toc-text">七、Dubbo原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81RPC%E5%8E%9F%E7%90%86"><span class="toc-text">1、RPC原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Netty%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86"><span class="toc-text">2、Netty通信原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81Dubbo%E5%8E%9F%E7%90%86"><span class="toc-text">3、Dubbo原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dubbo%E5%8E%9F%E7%90%86-%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1"><span class="toc-text">dubbo原理 - 框架设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dubbo%E5%8E%9F%E7%90%86-%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2"><span class="toc-text">dubbo原理 - 服务暴露</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dubbo%E5%8E%9F%E7%90%86-%E6%9C%8D%E5%8A%A1%E5%BC%95%E7%94%A8"><span class="toc-text">dubbo原理 - 服务引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dubbo%E5%8E%9F%E7%90%86-%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8"><span class="toc-text">dubbo原理 - 服务调用</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By ITNXD</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">CDN BY <a target="_blank" rel="external nofollow" href="https://www.jsdelivr.com/"><b>jsDelivr</b></a> | HOST BY  <a target="_blank" rel="external nofollow" href="https://vercel.com/"><b>Vercel</b></a> && <a target="_blank" rel="external nofollow" href="https://github.com/"><b>Github</b></a><br><img style="vertical-align:middle" src="https://gitcode.net/qq_43590403/img/-/raw/master/pictures/2022/10/22_19_11_15_202210221911223.png" alt=""> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn/"><b>晋ICP备19005025号-2</b></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      true && mermaid.init()
    })
  }
}</script><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.itnxd.eu.org/',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'https://twikoo.itnxd.eu.org/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.itnxd.eu.org/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><div class="aplayer no-destroy" data-id="1551071404" data-server="tencent" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/6dc9e8f9.js","daovoice")
</script><script>var isChatBtn = true
daovoice('init', {
  app_id: '6dc9e8f9',},{
  launcher: { 
     disableLauncherIcon: isChatBtn // 悬浮 ICON 是否显示
  },
});
daovoice('update');

if (isChatBtn) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      daovoice('show')
    });
  }
  chatBtnFn()
} else {
  if (false) {
    function chatBtnHide () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: true // 悬浮 ICON 是否显示
        },
      });
    }
    function chatBtnShow () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: false // 悬浮 ICON 是否显示
        },
      });
    }
  }
}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>