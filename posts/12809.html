<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head>
<script>(n=>{"use strict";let r,s,e;const l=["cdn.jsdelivr.net","fastly.jsdelivr.net","gcore.jsdelivr.net","cdn.zenless.top","testingcf.jsdelivr.net","test1.jsdelivr.net"],t="//",a=l[0],i=Date.now(),o=2e3,c="jsdelivr-auto-fallback",f="/gh/PipecraftNet/jsdelivr-auto-fallback@main/empty.css?",d=e=>e&&e.includes(t+a),m=e=>e.replace(t+a,t+r),u=window.setTimeout,v=n.querySelectorAll.bind(n),g=()=>{let e,t;for(e of v('link[rel="stylesheet"]'))t=e.href,d(t)&&!t.includes(f)&&(e.href=m(t));for(e of v("script"))if(t=e.src,d(t)){const r=n.createElement("script");r.src=m(t),e.defer=!0,e.src="",e.before(r),e.remove()}for(e of v("img"))t=e.src,d(t)&&(e.src="",e.src=m(t));for(e of v("*[style]"))t=e.getAttribute("style"),d(t)&&e.setAttribute("style",m(t));for(e of v("style"))t=e.innerHTML,d(t)&&(e.innerHTML=m(t))},y=()=>{!e&&s&&r&&(console.warn(a+" is not available. Use "+r),e=!0,u(g,0),u(g,20),setInterval(g,500))},b=(()=>{try{return Object.assign({},JSON.parse(localStorage.getItem(c)||"{}"))}catch{return{}}})();var h=()=>{b.time=i,b.failed=!1,b.fastNode=null;for(const t of l)((e,t)=>{let r;const s=n.createElement("link"),l=e=>{r&&(clearTimeout(r),r=0,e||(s.href="data:text/plain;base64,"),s.remove(),t(e))};r=u(l,o),s.addEventListener("error",()=>l(!1)),s.addEventListener("load",()=>l(!0)),s.rel="stylesheet",s.text="text/css",s.href=e+f+i,n.head.insertAdjacentElement("afterbegin",s)})("https://"+t,e=>{e||t!==a||(s=!0,b.failed=!0),e&&!r&&(r=t),e&&!b.fastNode&&(b.fastNode=t),y()});u(()=>{s&&!r&&(r=l[1],y()),localStorage.setItem(c,JSON.stringify(b))},o+100)};b.time&&i-b.time<36e5&&b.failed&&b.fastNode?(s=!0,r=b.fastNode,y(),u(h,1e3)):h()})(document);</script><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>进一步封装Spring、为简化Spring开发而生的SpringBoot框架 | 小牛博客</title><meta name="keywords" content="SpringBoot"><meta name="author" content="ITNXD"><meta name="copyright" content="ITNXD"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="¶一、SpringBoot概述 ¶1、能做什么  ¶Spring能力  微服务开发 响应式编程（异步非阻塞） 分布式云开发 web开发 无服务开发（FAAS：函数级开发） 事件驱动（使用数据流利用响应式编程） 批处理开发  ¶Spring生态  web开发 数据访问 安全控制 分布式 消息服务 移动开发 批处理 …  ¶Spring5升级 响应式编程：占用少量线程，使用少量资源就可以处理大量的并发">
<meta property="og:type" content="article">
<meta property="og:title" content="进一步封装Spring、为简化Spring开发而生的SpringBoot框架">
<meta property="og:url" content="https://www.itnxd.cn/posts/12809.html">
<meta property="og:site_name" content="小牛博客">
<meta property="og:description" content="¶一、SpringBoot概述 ¶1、能做什么  ¶Spring能力  微服务开发 响应式编程（异步非阻塞） 分布式云开发 web开发 无服务开发（FAAS：函数级开发） 事件驱动（使用数据流利用响应式编程） 批处理开发  ¶Spring生态  web开发 数据访问 安全控制 分布式 消息服务 移动开发 批处理 …  ¶Spring5升级 响应式编程：占用少量线程，使用少量资源就可以处理大量的并发">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/13/f4ee28a291f9feb683183e72ba34bb7a.png">
<meta property="article:published_time" content="2021-10-06T08:14:09.000Z">
<meta property="article:modified_time" content="2022-10-22T10:00:22.407Z">
<meta property="article:author" content="ITNXD">
<meta property="article:tag" content="SpringBoot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/13/f4ee28a291f9feb683183e72ba34bb7a.png"><link rel="shortcut icon" href="https://gitcode.net/qq_43590403/images/-/raw/master/img/favicon.ico"><link rel="canonical" href="https://www.itnxd.cn/posts/12809"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="H9LW1qdxrkJ55YbkfWulMvpaexxx3Rk0Yo6dVANeNHc"/><meta name="baidu-site-verification" content="code-YglH3DObCb"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8d3bd59bf6303bd5f44677445d369df5";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":300,"languages":{"author":"作者: ITNXD","link":"链接: ","source":"来源: 小牛博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
}</script><script defer id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '进一步封装Spring、为简化Spring开发而生的SpringBoot框架',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-22 18:00:22'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link rel="stylesheet" href="/css/my.css"><style type="text/css">#toggle-sidebar {bottom: 80px}</style><link rel="stylesheet" href="//at.alicdn.com/t/font_1828588_zrw9f0qqie.css"><link rel="stylesheet" href="/self/atom-one-light.css"><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="小牛博客" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/02/06/e373babbf340391956b673128a84185d.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">261</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">214</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/13/f4ee28a291f9feb683183e72ba34bb7a.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">小牛博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">进一步封装Spring、为简化Spring开发而生的SpringBoot框架</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-10-06T08:14:09.000Z" title="发表于 2021-10-06 16:14:09">2021-10-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-10-22T10:00:22.407Z" title="更新于 2022-10-22 18:00:22">2022-10-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/">开发框架</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">25.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>110分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="进一步封装Spring、为简化Spring开发而生的SpringBoot框架"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="一、SpringBoot概述"><a class="header-anchor" href="#一、SpringBoot概述">¶</a>一、SpringBoot概述</h1>
<h2 id="1、能做什么"><a class="header-anchor" href="#1、能做什么">¶</a>1、能做什么</h2>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/06/65eb698fde4c6ee99e6cd7cc114f4866.png" alt=""></p>
<h3 id="Spring能力"><a class="header-anchor" href="#Spring能力">¶</a>Spring能力</h3>
<ol>
<li>微服务开发</li>
<li>响应式编程（异步非阻塞）</li>
<li>分布式云开发</li>
<li>web开发</li>
<li>无服务开发（FAAS：函数级开发）</li>
<li>事件驱动（使用数据流利用响应式编程）</li>
<li>批处理开发</li>
</ol>
<h3 id="Spring生态"><a class="header-anchor" href="#Spring生态">¶</a>Spring生态</h3>
<ol>
<li>web开发</li>
<li>数据访问</li>
<li>安全控制</li>
<li>分布式</li>
<li>消息服务</li>
<li>移动开发</li>
<li>批处理</li>
<li>…</li>
</ol>
<h3 id="Spring5升级"><a class="header-anchor" href="#Spring5升级">¶</a>Spring5升级</h3>
<p><strong>响应式编程：占用少量线程，使用少量资源就可以处理大量的并发和需要的业务！</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/06/1e165f8821bebc82c49e38f8951f93e6.png" alt=""></p>
<p><strong>内部源码设计：基于Java8的一些新特性，如：接口默认实现（适配器模式）。重新设计源码架构。</strong></p>
<h2 id="2、为什么用"><a class="header-anchor" href="#2、为什么用">¶</a>2、为什么用</h2>
<blockquote>
<p><strong>能快速创建出生产级别的Spring应用！</strong></p>
</blockquote>
<h3 id="SpringBoot优点"><a class="header-anchor" href="#SpringBoot优点">¶</a>SpringBoot优点</h3>
<blockquote>
<p>SpringBoot是整合Spring技术栈的一站式框架！</p>
<p>SpringBoot是简化Spring技术栈的快速开发脚手架！</p>
</blockquote>
<ol>
<li>创建独立Spring应用</li>
<li>内嵌web服务器</li>
<li>自动starter依赖，简化构建配置</li>
<li>自动配置Spring以及第三方功能</li>
<li>提供生产级别的监控、健康检查及外部化配置</li>
<li>无代码生成、无需编写XML</li>
</ol>
<h3 id="SpringBoot缺点"><a class="header-anchor" href="#SpringBoot缺点">¶</a>SpringBoot缺点</h3>
<ul>
<li>人称版本帝，迭代快，需要时刻关注变化</li>
<li>封装太深，内部原理复杂，不容易精通</li>
</ul>
<h2 id="3、时代背景"><a class="header-anchor" href="#3、时代背景">¶</a>3、时代背景</h2>
<h3 id="微服务"><a class="header-anchor" href="#微服务">¶</a>微服务</h3>
<ol>
<li>微服务是一种架构风格</li>
<li>一个应用拆分为一组小型服务</li>
<li>每个服务运行在自己的进程内，也就是可独立部署和升级</li>
<li>服务之间使用轻量级HTTP交互</li>
<li>服务围绕业务功能拆分</li>
<li>可以由全自动部署机制独立部署</li>
<li>去中心化，服务自治。服务可以使用不同的语言、不同的存储技术</li>
</ol>
<h3 id="分布式"><a class="header-anchor" href="#分布式">¶</a>分布式</h3>
<p><strong>分布式的困难：</strong></p>
<ul>
<li>
<p>远程调用</p>
</li>
<li>
<p>服务发现</p>
</li>
<li>
<p>负载均衡</p>
</li>
<li>
<p>服务容错</p>
</li>
<li>
<p>配置管理</p>
</li>
<li>
<p>服务监控</p>
</li>
<li>
<p>链路追踪</p>
</li>
<li>
<p>日志管理</p>
</li>
<li>
<p>任务调度</p>
</li>
<li>
<p>…</p>
</li>
</ul>
<p><strong>分布式问题解决： SpringBoot + SpringCloud</strong></p>
<h3 id="云原生"><a class="header-anchor" href="#云原生">¶</a>云原生</h3>
<p><strong>原生应用如何上云。 Cloud Native！</strong></p>
<p><strong>上云的困难：</strong></p>
<ul>
<li>
<p>服务自愈</p>
</li>
<li>
<p>弹性伸缩</p>
</li>
<li>
<p>服务隔离</p>
</li>
<li>
<p>自动化部署</p>
</li>
<li>
<p>灰度发布</p>
</li>
<li>
<p>流量治理</p>
</li>
<li>
<p>…</p>
</li>
</ul>
<h2 id="4、SpringBoot特点"><a class="header-anchor" href="#4、SpringBoot特点">¶</a>4、SpringBoot特点</h2>
<h3 id="依赖管理"><a class="header-anchor" href="#依赖管理">¶</a>依赖管理</h3>
<p><strong>父项目做依赖管理：几乎声明了所有开发中常用的依赖的版本号，自动版本仲裁机制</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml">依赖管理！<br><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>他的父项目中声明了所有可能会用到的包的版本信息！<br><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>开发导入starter场景启动器</strong></p>
<ul>
<li>有很多官方 <code>spring-boot-starter-*</code> 配置各种场景，<code>*-spring-boot-starter</code> 为第三方为我们提供的简化开发的场景启动器。</li>
<li>只要引入starter，这个场景的所有常规需要的依赖我们都自动引入</li>
<li>SpringBoot所有支持的场景：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.build-systems.starters">https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.build-systems.starters</a></li>
<li>所有场景启动器最底层的依赖</li>
</ul>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>可以修改默认版本号：</strong></p>
<ul>
<li>查看spring-boot-dependencies里面规定当前依赖的版本用的 key。</li>
<li>在当前项目里面重写配置</li>
</ul>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mysql.version</span>&gt;</span>5.1.43<span class="hljs-tag">&lt;/<span class="hljs-name">mysql.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>无需关注版本号，自动版本仲裁</strong></p>
<ul>
<li>引入依赖默认都可以不写版本</li>
<li>引入非版本仲裁的 jar ，要写版本号。</li>
</ul>
<h3 id="自动配置"><a class="header-anchor" href="#自动配置">¶</a>自动配置</h3>
<ul>
<li>
<p>自动配好Tomcat：引入Tomcat依赖，配置Tomcat</p>
</li>
<li>
<p>自动配好SpringMVC：引入SpringMVC全套组件，自动配好SpringMVC常用组件（功能）</p>
</li>
<li>
<p>自动配好Web常见功能：如：字符编码问题，</p>
</li>
<li>
<p>SpringBoot帮我们配置好了所有web开发的常见场景</p>
</li>
<li>
<p>默认的包结构</p>
<ul>
<li>主程序所在包及其下面的所有子包里面的组件都会被默认扫描进来</li>
<li>无需以前的包扫描配置</li>
<li>改变扫描路径<code>@SpringBootApplication(scanBasePackages="com.itnxd")</code> 或者 <code>@ComponentScan</code> 指定扫描路径</li>
</ul>
</li>
<li>
<p><strong>各种配置拥有默认值</strong></p>
<ul>
<li>默认配置最终都是映射到某个类上</li>
<li>配置文件的值最终会绑定每个类上，这个类会在容器中创建对象</li>
</ul>
</li>
<li>
<p><strong>按需加载所有自动配置项</strong></p>
</li>
<li>
<p><strong>非常多的starter：引入了哪些场景这个场景的自动配置才会开启</strong></p>
</li>
<li>
<p>SpringBoot所有的自动配置功能都在 <strong>spring-boot-autoconfigure 包</strong>里面</p>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 指定包扫描（默认扫描的是主启动类同目录即子目录）</span><br><span class="hljs-meta">@SpringBootApplication(scanBasePackages = "com.itnxd")</span><br><span class="hljs-comment">// 或 </span><br><span class="hljs-meta">@ComponentScan("com.itnxd")</span><br><br><span class="hljs-comment">// 一个@SpringBootApplication等同于下面三个：</span><br><span class="hljs-meta">@SpringBootConfiguration</span><br><span class="hljs-meta">@EnableAutoConfiguration</span><br><span class="hljs-meta">@ComponentScan</span><br></code></pre></td></tr></tbody></table></figure>
<h1 id="二、容器功能"><a class="header-anchor" href="#二、容器功能">¶</a>二、容器功能</h1>
<h2 id="1、组件添加"><a class="header-anchor" href="#1、组件添加">¶</a>1、组件添加</h2>
<h3 id="Configuration"><a class="header-anchor" href="#Configuration">¶</a>@Configuration</h3>
<blockquote>
<p>指明是一个配置类！</p>
</blockquote>
<ol>
<li>配置类里面使用@Bean标注在方法上给容器注册组件，<strong>默认是单实例的</strong></li>
<li>配置类本身也是组件</li>
<li>proxyBeanMethods：代理bean的方法，<code>@Configuration</code>的配置属性
<ol>
<li>Full(<code>proxyBeanMethods = true</code>)：保证每个@Bean方法被调用多少次返回的组件都是单实例的。<strong>去容器中找，慢，单实例，默认</strong></li>
<li>Lite(<code>proxyBeanMethods = false</code>)：每个@Bean方法被调用多少次返回的组件都是新创建的。<strong>新建一个，快，多实例</strong></li>
</ol>
</li>
</ol>
<p><strong>建议：</strong></p>
<p>组件依赖（一个组件依赖另一个组件如user依赖cat）必须使用Full模式默认（防止实例不统一）。其他默认是否Lite模式！</p>
<ul>
<li>配置类组件之间无依赖关系，用Lite模式加速容器启动过程，减少判断</li>
<li>配置类组件之间有依赖关系，方法会被调用得到之前单实例组件，用Full模式</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfig</span> </span>{<br>    ...<br>}<br><br><span class="hljs-comment">// 获取IOC容器进行测试</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorldApplication</span> </span>{<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<br>        <span class="hljs-comment">// 1. 返回我们的IOC容器</span><br>        ConfigurableApplicationContext run = SpringApplication.run(HelloWorldApplication.class, args);<br>        <span class="hljs-comment">// 2. 查看容器内的组件</span><br>        String[] beanDefinitionNames = run.getBeanDefinitionNames();<br>        <span class="hljs-keyword">for</span> (String beanDefinitionName : beanDefinitionNames) {<br>            System.out.println(beanDefinitionName);<br>        }<br><br>        <span class="hljs-comment">// 3. 从容器中获取我们自己的Bean组件</span><br>        User user01 = run.getBean(<span class="hljs-string">"user01"</span>, User.class);<br>        System.out.println(user01);<br>        MyConfig bean = run.getBean(MyConfig.class);<br>        System.out.println(bean);<br><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        如果 @Configuration(proxyBeanMethods = true)</span><br><span class="hljs-comment">            就是代理对象调用代理方法！</span><br><span class="hljs-comment">         SpringBoot总会检查这个组件是否在容器中有。保持组件单实例</span><br><span class="hljs-comment">         */</span><br>        User user = bean.user01();<br>        User user1 = bean.user01();<br>        System.out.println(user == user1); <span class="hljs-comment">// true</span><br><br>        <span class="hljs-comment">// 组件依赖测试</span><br>        User user2 = bean.user01();<br>        System.out.println(user2.getCat() == bean.getCat()); <span class="hljs-comment">// false</span><br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="Import"><a class="header-anchor" href="#Import">¶</a>@Import</h3>
<blockquote>
<p>给容器中自动创建出这些个类型的组件（自动调用无参构造）、默认组件的名字就是全类名！</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Import({User.class, DBHelper.class})</span><br><span class="hljs-meta">@Configuration(proxyBeanMethods = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfig</span> </span>{<br>    ...<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="Bean"><a class="header-anchor" href="#Bean">¶</a>@Bean</h3>
<blockquote>
<p>给容器添加组件！</p>
</blockquote>
<ul>
<li>id：方法名</li>
</ul>
<ul>
<li>组件类型：返回值类型</li>
<li>IOC容器中对象：返回值</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 给容器添加组件！</span><br><span class="hljs-comment"> *  id：方法名</span><br><span class="hljs-comment"> *  组件类型：返回值类型</span><br><span class="hljs-comment"> *  IOC容器中对象：返回值</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">user01</span><span class="hljs-params">()</span></span>{<br>    User zs = <span class="hljs-keyword">new</span> User(<span class="hljs-string">"zs"</span>, <span class="hljs-number">18</span>);<br>    zs.setCat(getCat());<br>    <span class="hljs-keyword">return</span> zs;<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="Conditional"><a class="header-anchor" href="#Conditional">¶</a>@Conditional</h3>
<blockquote>
<p>条件装配：满足Conditional指定的条件，则进行组件注入！</p>
</blockquote>
<p>有如下条件配置注解！</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/06/d130dc527896a28992051955b6a10843.png" alt=""></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ConditionalOnBean(name = "tom")</span><br><span class="hljs-meta">@Configuration(proxyBeanMethods = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfig</span> </span>{<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  <span class="hljs-doctag">@ConditionalOnBean</span></span><br><span class="hljs-comment">     *  有tom这个Bean才会生效！</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     *  可以添加到类和方法上！</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@ConditionalOnBean(name = "tom")</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">user01</span><span class="hljs-params">()</span></span>{<br>        User zs = <span class="hljs-keyword">new</span> User(<span class="hljs-string">"zs"</span>, <span class="hljs-number">18</span>);<br>        zs.setCat(getCat());<br>        <span class="hljs-keyword">return</span> zs;<br>    }<br>    <br>	...<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="2、原生配置文件引入"><a class="header-anchor" href="#2、原生配置文件引入">¶</a>2、原生配置文件引入</h2>
<ul>
<li>@ImportResource：导入旧项目的xml配置文件，任何类上都可以！</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// @ImportResource() ：导入旧项目的xml配置文件，任何类上都可以</span><br><span class="hljs-meta">@ImportResource("classpath:bean.xml")</span><br><span class="hljs-meta">@Configuration(proxyBeanMethods = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfig</span> </span>{<br>    ...<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="3、配置绑定"><a class="header-anchor" href="#3、配置绑定">¶</a>3、配置绑定</h2>
<blockquote>
<p>如何使用Java读取到properties文件中的内容，并且把它封装到JavaBean中，以供随时使用！</p>
</blockquote>
<h3 id="ConfigurationProperties"><a class="header-anchor" href="#ConfigurationProperties">¶</a>@ConfigurationProperties</h3>
<p><strong>我们之前将配置文件绑定到JavaBean可以这样做：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">getProperties</span> </span>{<br>     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> FileNotFoundException, IOException </span>{<br>         Properties pps = <span class="hljs-keyword">new</span> Properties();<br>         pps.load(<span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-string">"a.properties"</span>));<br>         Enumeration enum1 = pps.propertyNames();<span class="hljs-comment">//得到配置文件的名字</span><br>         <span class="hljs-keyword">while</span>(enum1.hasMoreElements()) {<br>             String strKey = (String) enum1.nextElement();<br>             String strValue = pps.getProperty(strKey);<br>             System.out.println(strKey + <span class="hljs-string">"="</span> + strValue);<br>             <span class="hljs-comment">//封装到JavaBean。</span><br>         }<br>     }<br> }<br></code></pre></td></tr></tbody></table></figure>
<p><strong>使用注解@ConfigurationProperties：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-comment">// 将application.properties配置文件中的以prefix内容开头的配置注入到当前容器！</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = "mycar")</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> </span>{<br>    <span class="hljs-keyword">private</span> String brand;<br>    <span class="hljs-keyword">private</span> Integer price;<br>    ...<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>properties配置文件：</strong></p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-meta">mycar.brand</span>=<span class="hljs-string">BYD</span><br><span class="hljs-meta">mycar.price</span>=<span class="hljs-string">100000</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="两种配置文件绑定方法"><a class="header-anchor" href="#两种配置文件绑定方法">¶</a>两种配置文件绑定方法</h3>
<ol>
<li>实体类添加 <code>@Component 和 @ConfigurationProperties(prefix = "mycar")</code></li>
<li>启动类或配置类添加 <code>@EnableConfigurationProperties(Car.class)</code>，实体类添加 <code>@ConfigurationProperties(prefix = "mycar")</code>
<ol>
<li>第二种适合第三方类使用，毕竟我们不能直接添加@Component注解到该类！</li>
</ol>
</li>
</ol>
<h1 id="三、自动配置原理"><a class="header-anchor" href="#三、自动配置原理">¶</a>三、自动配置原理</h1>
<blockquote>
<p>从分析@SpringBootApplication这个启动类注解入手！</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// @SpringBootApplication注解有下面三个注解组成</span><br><br><span class="hljs-meta">@SpringBootConfiguration</span><br><span class="hljs-meta">@EnableAutoConfiguration</span><br><span class="hljs-meta">@ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span><br><span class="hljs-meta">    @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SpringBootApplication{}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="1、-SpringBootConfiguration"><a class="header-anchor" href="#1、-SpringBootConfiguration">¶</a>1、@SpringBootConfiguration</h2>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SpringBootConfiguration {}<br></code></pre></td></tr></tbody></table></figure>
<p>@Configuration：代表当前是一个配置类</p>
<h2 id="2、-ComponentScan"><a class="header-anchor" href="#2、-ComponentScan">¶</a>2、@ComponentScan</h2>
<p>指定扫描哪些包，用来扫描注解！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> ComponentScan {<br>    <span class="hljs-meta">@AliasFor("basePackages")</span><br>    String[] value() <span class="hljs-keyword">default</span> {};<br><br>    <span class="hljs-meta">@AliasFor("value")</span><br>    String[] basePackages() <span class="hljs-keyword">default</span> {};<br>    <br>    ...<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="3、-EnableAutoConfiguration"><a class="header-anchor" href="#3、-EnableAutoConfiguration">¶</a>3、@EnableAutoConfiguration</h2>
<p><strong>该注解由以下两个注解组成：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AutoConfigurationPackage</span><br><span class="hljs-meta">@Import({AutoConfigurationImportSelector.class})</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableAutoConfiguration {<br>    String ENABLED_OVERRIDE_PROPERTY = <span class="hljs-string">"spring.boot.enableautoconfiguration"</span>;<br><br>    Class&lt;?&gt;[] exclude() <span class="hljs-keyword">default</span> {};<br><br>    String[] excludeName() <span class="hljs-keyword">default</span> {};<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="AutoConfigurationPackage"><a class="header-anchor" href="#AutoConfigurationPackage">¶</a>@AutoConfigurationPackage</h3>
<p>自动配置包，指定了默认的包规则！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Import({Registrar.class})</span> <span class="hljs-comment">// 给容器中导入一个组件, 利用Registrar给容器中导入一系列组件</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AutoConfigurationPackage {<br>    String[] basePackages() <span class="hljs-keyword">default</span> {};<br><br>    Class&lt;?&gt;[] basePackageClasses() <span class="hljs-keyword">default</span> {};<br>}<br><br><br><span class="hljs-comment">// Registrar.class</span><br><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Registrar</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ImportBeanDefinitionRegistrar</span>, <span class="hljs-title">DeterminableImports</span> </span>{<br>    Registrar() {<br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerBeanDefinitions</span><span class="hljs-params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> </span>{<br>        <span class="hljs-comment">// 将指定的一个包下的所有组件导入进来？MainApplication 所在包下。</span><br>        AutoConfigurationPackages.register(registry, (String[])(<span class="hljs-keyword">new</span> AutoConfigurationPackages.PackageImports(metadata)).getPackageNames().toArray(<span class="hljs-keyword">new</span> String[<span class="hljs-number">0</span>]));<br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">determineImports</span><span class="hljs-params">(AnnotationMetadata metadata)</span> </span>{<br>        <span class="hljs-keyword">return</span> Collections.singleton(<span class="hljs-keyword">new</span> AutoConfigurationPackages.PackageImports(metadata));<br>    }<br>}<br><span class="hljs-comment">//将指定的一个包下的所有组件导入进来？MainApplication 所在包下。</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="Import-2"><a class="header-anchor" href="#Import-2">¶</a>@Import</h3>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AutoConfigurationPackage</span><br><span class="hljs-meta">@Import({AutoConfigurationImportSelector.class})</span> <span class="hljs-comment">// 分析这个</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableAutoConfiguration {<br></code></pre></td></tr></tbody></table></figure>
<ul>
<li>利用 <code>getAutoConfigurationEntry(annotationMetadata);</code>给容器中批量导入一些组件</li>
<li>调用<code>List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes)</code>获取到所有需要导入到容器中的配置类</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> AutoConfigurationImportSelector.<span class="hljs-function">AutoConfigurationEntry <span class="hljs-title">getAutoConfigurationEntry</span><span class="hljs-params">(AnnotationMetadata annotationMetadata)</span> </span>{<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isEnabled(annotationMetadata)) {<br>        <span class="hljs-keyword">return</span> EMPTY_ENTRY;<br>    } <span class="hljs-keyword">else</span> {<br>        AnnotationAttributes attributes = <span class="hljs-keyword">this</span>.getAttributes(annotationMetadata);<br>        List&lt;String&gt; configurations = <span class="hljs-keyword">this</span>.getCandidateConfigurations(annotationMetadata, attributes);<br>        configurations = <span class="hljs-keyword">this</span>.removeDuplicates(configurations);<br>        Set&lt;String&gt; exclusions = <span class="hljs-keyword">this</span>.getExclusions(annotationMetadata, attributes);<br>        <span class="hljs-keyword">this</span>.checkExcludedClasses(configurations, exclusions);<br>        configurations.removeAll(exclusions);<br>        configurations = <span class="hljs-keyword">this</span>.getConfigurationClassFilter().filter(configurations);<br>        <span class="hljs-keyword">this</span>.fireAutoConfigurationImportEvents(configurations, exclusions);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AutoConfigurationImportSelector.AutoConfigurationEntry(configurations, exclusions);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>configurations有一百多个组件：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/06/25fb6c3a05f9002b0332d3893f292354.png" alt=""></p>
<ul>
<li>利用工厂加载 <code>Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(@Nullable ClassLoader classLoader)</code>得到所有的组件</li>
<li>从<code>META-INF/spring.factories</code>位置来加载一个文件。 默认扫描我们当前系统里面所有<code>META-INF/spring.factories</code>位置的文件</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;String&gt; <span class="hljs-title">loadFactoryNames</span><span class="hljs-params">(Class&lt;?&gt; factoryType, <span class="hljs-meta">@Nullable</span> ClassLoader classLoader)</span> </span>{<br>    ClassLoader classLoaderToUse = classLoader;<br>    <span class="hljs-keyword">if</span> (classLoader == <span class="hljs-keyword">null</span>) {<br>        classLoaderToUse = SpringFactoriesLoader.class.getClassLoader();<br>    }<br><br>    String factoryTypeName = factoryType.getName();<br>    <span class="hljs-comment">// 点进去</span><br>    <span class="hljs-keyword">return</span> (List)loadSpringFactories(classLoaderToUse).getOrDefault(factoryTypeName, Collections.emptyList());<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>到了这里：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(ClassLoader classLoader) {<br>    Map&lt;String, List&lt;String&gt;&gt; result = (Map)cache.get(classLoader);<br>    <span class="hljs-keyword">if</span> (result != <span class="hljs-keyword">null</span>) {<br>        <span class="hljs-keyword">return</span> result;<br>    } <span class="hljs-keyword">else</span> {<br>        HashMap result = <span class="hljs-keyword">new</span> HashMap();<br><br>        <span class="hljs-keyword">try</span> {<br>            <span class="hljs-comment">// 从`META-INF/spring.factories`位置来加载一个文件。</span><br>            Enumeration urls = classLoader.getResources(<span class="hljs-string">"META-INF/spring.factories"</span>);<br><br>            <span class="hljs-keyword">while</span>(urls.hasMoreElements()) {<br>                URL url = (URL)urls.nextElement();<br>                UrlResource resource = <span class="hljs-keyword">new</span> UrlResource(url);<br>                Properties properties = PropertiesLoaderUtils.loadProperties(resource);<br>                Iterator var6 = properties.entrySet().iterator();<br><br>                <span class="hljs-keyword">while</span>(var6.hasNext()) {<br>                    Entry&lt;?, ?&gt; entry = (Entry)var6.next();<br>                    String factoryTypeName = ((String)entry.getKey()).trim();<br>                    String[] factoryImplementationNames = StringUtils.commaDelimitedListToStringArray((String)entry.getValue());<br>                    String[] var10 = factoryImplementationNames;<br>                    <span class="hljs-keyword">int</span> var11 = factoryImplementationNames.length;<br><br>                    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> var12 = <span class="hljs-number">0</span>; var12 &lt; var11; ++var12) {<br>                        String factoryImplementationName = var10[var12];<br>                        ((List)result.computeIfAbsent(factoryTypeName, (key) -&gt; {<br>                            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ArrayList();<br>                        })).add(factoryImplementationName.trim());<br>                    }<br>                }<br>            }<br><br>            result.replaceAll((factoryType, implementations) -&gt; {<br>                <span class="hljs-keyword">return</span> (List)implementations.stream().distinct().collect(Collectors.collectingAndThen(Collectors.toList(), Collections::unmodifiableList));<br>            });<br>            cache.put(classLoader, result);<br>            <span class="hljs-keyword">return</span> result;<br>        } <span class="hljs-keyword">catch</span> (IOException var14) {<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">"Unable to load factories from location [META-INF/spring.factories]"</span>, var14);<br>        }<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>spring.factories文件：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/06/2c5db5b36ccc621210a24badc43e7fc5.png" alt=""></p>
<ul>
<li><code>spring-boot-autoconfigure-2.3.4.RELEASE.jar</code> 包里面也有 <code>META-INF/spring.factories</code></li>
<li><strong>文件里面写死了 spring-boot 一启动就要给容器中加载的所有配置类</strong></li>
<li>目前最新版132个自动配置项</li>
</ul>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/06/fb00fd4e010448ace612ed1f995e393f.png" alt=""></p>
<h3 id="按需开启自动配置组件"><a class="header-anchor" href="#按需开启自动配置组件">¶</a>按需开启自动配置组件</h3>
<p>虽然我们127个场景的所有自动配置启动的时候默认全部加载。</p>
<p>xxxxAutoConfiguration 按照条件装配规则（@Conditional），最终会按需配置。</p>
<p><strong>以aop包为例：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/06/dd174fbd8692652cb04aa847ace8f530.png" alt=""></p>
<h3 id="修改默认配置"><a class="header-anchor" href="#修改默认配置">¶</a>修改默认配置</h3>
<p><strong>SpringBoot 规范化命名例子：</strong></p>
<p>给容器中加入了文件上传解析器：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalOnBean({MultipartResolver.class})</span> <span class="hljs-comment">// 容器中有这个类型组件</span><br><span class="hljs-meta">@ConditionalOnMissingBean(</span><br><span class="hljs-meta">    name = {"multipartResolver"} // 容器中没有这个名字 multipartResolver 的组件</span><br><span class="hljs-meta">)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> MultipartResolver <span class="hljs-title">multipartResolver</span><span class="hljs-params">(MultipartResolver resolver)</span> </span>{<br>    <span class="hljs-comment">// 给@Bean标注的方法传入了对象参数，这个参数的值就会从容器中找。</span><br>    <span class="hljs-comment">// SpringMVC multipartResolver。防止有些用户配置的文件上传解析器不符合规范</span><br>    <span class="hljs-comment">// Detect if the user has created a MultipartResolver but named it incorrectly</span><br>    <span class="hljs-keyword">return</span> resolver;<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>修改默认配置：</strong></p>
<p>SpringBoot默认会在底层配好所有的组件。但是如果用户自己配置了以用户的优先！</p>
<p>找到这些组件，默认就是方法名，因此我们可以在自己的配置类中添加如下即可：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> MultipartResolver <span class="hljs-title">multipartResolver</span><span class="hljs-params">()</span> </span>{<br>    <span class="hljs-comment">// 写自己的逻辑</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="总结"><a class="header-anchor" href="#总结">¶</a>总结</h3>
<ol>
<li>SpringBoot先加载所有的自动配置类  xxxxxAutoConfiguration</li>
<li>每个自动配置类按照条件进行生效，默认都会绑定配置文件指定的值。<strong>xxxxProperties</strong>里面拿。xxxProperties和配置文件进行了绑定</li>
<li>生效的配置类就会给容器中装配很多组件</li>
<li>只要容器中有这些组件，相当于这些功能就有了</li>
<li>定制化配置
<ol>
<li>用户直接自己@Bean替换底层的组件</li>
<li>用户去看这个组件是获取的配置文件什么值就去修改。</li>
</ol>
</li>
</ol>
<ul>
<li>引入场景依赖：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter">https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter</a></li>
<li>查看自动配置了哪些
<ul>
<li>自己分析，引入场景对应的自动配置一般都生效了</li>
<li><strong>配置文件中debug=true开启自动配置报告</strong>。Negative（不生效）\Positive（生效）</li>
</ul>
</li>
<li>是否需要修改
<ul>
<li>参照文档修改配置项：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#common-application-properties">https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#common-application-properties</a></li>
<li>自己分析。xxxxProperties绑定了配置文件的哪些。（详见下方图解）</li>
</ul>
</li>
<li>自定义加入或者替换组件：@Bean</li>
</ul>
<p><strong>xxxxxAutoConfiguration —&gt; 导入组件  —&gt; 从xxxxProperties里面拿值  ----&gt; 去application.properties获取</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/06/d0f3565fd7f85bb4a2149a3821d11124.png" alt=""></p>
<h1 id="四、开发技巧"><a class="header-anchor" href="#四、开发技巧">¶</a>四、开发技巧</h1>
<h2 id="1、Lombok"><a class="header-anchor" href="#1、Lombok">¶</a>1、Lombok</h2>
<blockquote>
<p>可以简化 JavaBean 开发！同时包含了Slf4j日志框架！</p>
<p>似乎公司一般不使用，需要安装对应的Idea插件！（新版本以及默认安装）</p>
<p>最好的一点是改动JavaBean不用进行其他操作，自动完成！</p>
</blockquote>
<h3 id="依赖引入"><a class="header-anchor" href="#依赖引入">¶</a>依赖引入</h3>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--插件市场安装（默认已经安装）简化JavaBean与引入日志Slf4j--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="简化JavaBean"><a class="header-anchor" href="#简化JavaBean">¶</a>简化JavaBean</h3>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = "mycar")</span><br><span class="hljs-comment">// lombok</span><br><span class="hljs-meta">@Data</span> <span class="hljs-comment">// getter和 setter方法 以及 equals方法和toString方法！</span><br><span class="hljs-meta">@ToString</span> <span class="hljs-comment">// 编译时候自动生成toString</span><br><span class="hljs-meta">@AllArgsConstructor</span> <span class="hljs-comment">// 全参构造器</span><br><span class="hljs-meta">@NoArgsConstructor</span> <span class="hljs-comment">// 无参构造器</span><br><span class="hljs-meta">@EqualsAndHashCode</span> <span class="hljs-comment">// Equals和HashCode方法</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> </span>{<br><br>    <span class="hljs-keyword">private</span> String brand;<br>    <span class="hljs-keyword">private</span> Integer price;<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="简化日志Slf4j"><a class="header-anchor" href="#简化日志Slf4j">¶</a>简化日志Slf4j</h3>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span> <span class="hljs-comment">// 同样是lombok的</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>{<br><br>    <span class="hljs-meta">@Autowired</span><br>    Car car;<br><br>    <span class="hljs-meta">@RequestMapping("/car")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Car <span class="hljs-title">car</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-comment">// 可以使用{}进行占位的，逗号后添加变量或常量！</span><br>        log.info(<span class="hljs-string">"请求来了...."</span>);<br>        <span class="hljs-keyword">return</span> car;<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="2、Dev-tools"><a class="header-anchor" href="#2、Dev-tools">¶</a>2、Dev-tools</h2>
<blockquote>
<p>可以用来热更新，但有时还不如直接重启！</p>
</blockquote>
<p>底层有两个类加载器。一个复制加载第三方库，一个负贵加载本地java库。</p>
<p>第三方库是不会变的，也就是重就启动只需要加载本地java类即可，节省了重启时间！</p>
<p>快捷键 <code>CTRL + F9</code>：<strong>文件有变化时候才会生效</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">开发工具-快速重启</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">快捷键CTRL + F9：文件有变化时候才会生效</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">底层有两个类加载器。一个复制加载第三方库，一个负贵加载本地java库</span><br><span class="hljs-comment">第三方库是不会变的，也就是重就启动只需要加载本地java类即可，节省了重启时间</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.devtools.restart</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">可以使用官方推荐的付费插件 ：jrebel https://www.jrebel.com/products/jrebel</span><br><span class="hljs-comment">--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h2 id="3、Spring-Initailizr"><a class="header-anchor" href="#3、Spring-Initailizr">¶</a>3、Spring Initailizr</h2>
<blockquote>
<p>Idea提供的快速构建SpringBoot项目初始化向导！</p>
</blockquote>
<p>可以根据选择自动引入各种开发场景的starter包，以及一些其他工具等等！</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/06/d6bf94dc7313fd25b5479a840f776260.png" alt=""></p>
<h1 id="五、配置文件"><a class="header-anchor" href="#五、配置文件">¶</a>五、配置文件</h1>
<blockquote>
<p>分为properties和两种配置文件！</p>
</blockquote>
<h2 id="1、配置文件分类"><a class="header-anchor" href="#1、配置文件分类">¶</a>1、配置文件分类</h2>
<ul>
<li>properties：略</li>
<li>yaml：下方介绍</li>
</ul>
<h2 id="2、yaml"><a class="header-anchor" href="#2、yaml">¶</a>2、yaml</h2>
<h3 id="简介"><a class="header-anchor" href="#简介">¶</a>简介</h3>
<p>YAML 是 “YAML Ain’t Markup Language”（YAML 不是一种标记语言）的递归缩写。在开发的这种语言时，YAML 的意思其实是：“Yet Another Markup Language”（仍是一种标记语言）。</p>
<p><strong>非常适合用来做以数据为中心的配置文件！</strong></p>
<h3 id="基本语法"><a class="header-anchor" href="#基本语法">¶</a>基本语法</h3>
<ul>
<li>
<p>key: value；kv之间有空格</p>
</li>
<li>
<p>大小写敏感</p>
</li>
<li>
<p>使用缩进表示层级关系</p>
</li>
<li>
<p>缩进不允许使用tab，只允许空格（<strong>idea忽略，自动替换为空格，也可用CTRL + ALT + L自动格式化</strong>）</p>
</li>
<li>
<p>缩进的空格数不重要，只要相同层级的元素左对齐即可</p>
</li>
<li>
<p>'#'表示注释</p>
</li>
<li>
<p>字符串无需加引号，如果要加，''与""表示字符串内容 会被 转义/不转义</p>
</li>
</ul>
<h3 id="数据类型"><a class="header-anchor" href="#数据类型">¶</a>数据类型</h3>
<p><strong>字面量：单个的、不可再分的值。date、boolean、string、number、null</strong></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">k:</span> <span class="hljs-string">v</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>对象：键值对的集合。map、hash、set、object</strong></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 行内写法：  </span><br><span class="hljs-attr">k:</span> {<span class="hljs-attr">k1:</span> <span class="hljs-string">v1</span>,<span class="hljs-attr">k2:</span> <span class="hljs-string">v2</span>,<span class="hljs-attr">k3:</span> <span class="hljs-string">v3</span>}<br><span class="hljs-comment"># 或</span><br><span class="hljs-attr">k:</span> <br>  <span class="hljs-attr">k1:</span> <span class="hljs-string">v1</span><br>  <span class="hljs-attr">k2:</span> <span class="hljs-string">v2</span><br>  <span class="hljs-attr">k3:</span> <span class="hljs-string">v3</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>数组：一组按次序排列的值。array、list、queue</strong></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 行内写法：  </span><br><span class="hljs-attr">k:</span> [<span class="hljs-string">v1</span>,<span class="hljs-string">v2</span>,<span class="hljs-string">v3</span>]<br><span class="hljs-comment"># 或者</span><br><span class="hljs-attr">k:</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">v1</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">v2</span><br> <span class="hljs-bullet">-</span> <span class="hljs-string">v3</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="案例"><a class="header-anchor" href="#案例">¶</a>案例</h3>
<p><strong>JavaBean：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = "person")</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{<br>  <br>  <span class="hljs-keyword">private</span> String userName;<br>  <span class="hljs-keyword">private</span> Boolean boss;<br>  <span class="hljs-keyword">private</span> Date birth;<br>  <span class="hljs-keyword">private</span> Integer age;<br>  <span class="hljs-keyword">private</span> Pet pet;<br>  <span class="hljs-keyword">private</span> String[] interests;<br>  <span class="hljs-keyword">private</span> List&lt;String&gt; animal;<br>  <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; score;<br>  <span class="hljs-keyword">private</span> Set&lt;Double&gt; salarys;<br>  <span class="hljs-keyword">private</span> Map&lt;String, List&lt;Pet&gt;&gt; allPets;<br>}<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pet</span> </span>{<br>  <span class="hljs-keyword">private</span> String name;<br>  <span class="hljs-keyword">private</span> Double weight;<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>yaml文件：</strong></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 使用IDEA快捷键一键格式化防止出错：CTRL + ALT + L</span><br><span class="hljs-comment"># properties配置优先级更高！</span><br><br><span class="hljs-attr">person:</span><br>  <span class="hljs-attr">userName:</span> <span class="hljs-string">zs</span><br>  <span class="hljs-comment"># "zhang \n san" 字符串单引号作为字符串输出，双引号作为换行符输出</span><br>  <span class="hljs-comment"># 单引号不触发转义，双引号触发转义...（不重要）</span><br>  <span class="hljs-attr">boss:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">birth:</span> <span class="hljs-number">2021</span><span class="hljs-string">/10/6</span><br>  <span class="hljs-attr">age:</span> <span class="hljs-number">18</span><br>  <span class="hljs-comment">#  interests: [篮球,足球]</span><br>  <span class="hljs-attr">interests:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">篮球</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">足球</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">18</span><br>  <span class="hljs-attr">animal:</span> [ <span class="hljs-string">猫</span>,<span class="hljs-string">狗</span> ]<br>  <span class="hljs-comment">#  score:</span><br>  <span class="hljs-comment">#    english: 80</span><br>  <span class="hljs-comment">#    math: 90</span><br>  <span class="hljs-attr">score:</span> { <span class="hljs-attr">english:</span> <span class="hljs-number">80</span>, <span class="hljs-attr">math:</span> <span class="hljs-number">90</span> }<br>  <span class="hljs-attr">salarys:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">9999.89</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">8832.22</span><br>  <span class="hljs-attr">pet:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">狗狗</span><br>    <span class="hljs-attr">weight:</span> <span class="hljs-number">99</span><br>  <span class="hljs-attr">allPets:</span><br>    <span class="hljs-attr">sick:</span><br>      <span class="hljs-bullet">-</span> { <span class="hljs-attr">name:</span> <span class="hljs-string">狗</span>, <span class="hljs-attr">weight:</span> <span class="hljs-number">99</span> }<br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">猫</span><br>        <span class="hljs-attr">weight:</span> <span class="hljs-number">98</span><br>    <span class="hljs-attr">health:</span><br>      <span class="hljs-bullet">-</span> { <span class="hljs-attr">name:</span> <span class="hljs-string">狗</span>, <span class="hljs-attr">weight:</span> <span class="hljs-number">99</span> }<br></code></pre></td></tr></tbody></table></figure>
<h2 id="3、配置提示"><a class="header-anchor" href="#3、配置提示">¶</a>3、配置提示</h2>
<p>自定义的类和配置文件绑定一般没有提示，可以添加如下包就会由一些友好的提示！</p>
<p><strong>依赖导入</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span><br>                    <span class="hljs-comment">&lt;!--lombok不进行打包--&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span><br>                    <span class="hljs-comment">&lt;!--yml配置提示 不进行打包--&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>  <br></code></pre></td></tr></tbody></table></figure>
<h1 id="六、Web开发"><a class="header-anchor" href="#六、Web开发">¶</a>六、Web开发</h1>
<h2 id="1、SpringMVC自动配置概览"><a class="header-anchor" href="#1、SpringMVC自动配置概览">¶</a>1、SpringMVC自动配置概览</h2>
<blockquote>
<p><strong>大多场景我们都无需自定义配置！</strong></p>
</blockquote>
<ol>
<li>内容协商视图解析器和BeanName视图解析器</li>
<li>静态资源（包括webjars）</li>
<li>自动注册 Converter，GenericConverter，Formatter</li>
<li>支持 HttpMessageConverters （后来我们配合内容协商理解原理）</li>
<li>自动注册 MessageCodesResolver （国际化用）</li>
<li>静态index.html 页支持</li>
<li>自定义 Favicon</li>
<li>自动使用 ConfigurableWebBindingInitializer ，（DataBinder负责将请求数据绑定到JavaBean上）</li>
</ol>
<ul>
<li>
<p>不用@EnableWebMvc注解。使用 <code>@Configuration</code> + <code>WebMvcConfigurer</code> 自定义规则</p>
</li>
<li>
<p>声明 <code>WebMvcRegistrations</code> 改变默认底层组件</p>
</li>
<li>
<p>使用 <code>@EnableWebMvc+@Configuration+DelegatingWebMvcConfiguration 全面接管SpringMVC</code></p>
</li>
</ul>
<h2 id="2、简单功能分析"><a class="header-anchor" href="#2、简单功能分析">¶</a>2、简单功能分析</h2>
<h3 id="静态资源访问"><a class="header-anchor" href="#静态资源访问">¶</a>静态资源访问</h3>
<p>只要静态资源放在类路径下： <code>/static</code> or <code>/public</code> or <code>/resources</code> or <code>/META-INF/resources</code></p>
<p>访问 ： 当前项目根路径/ + 静态资源名</p>
<p>原理： 静态映射/**。</p>
<p>请求进来，先去找Controller看能不能处理。不能处理的所有请求又都交给静态资源处理器。静态资源也找不到则响应404页面！</p>
<p><strong>改变默认的静态资源路径和前缀：</strong></p>
<p>默认无前缀！</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mvc:</span><br>    <span class="hljs-comment"># 静态资源访问前缀 当前项目 + static-path-pattern + 静态资源名 = 静态资源文件夹下找</span><br>    <span class="hljs-comment"># 配置了欢迎页，要关闭前缀访问，否则无法直达欢迎页，导致欢迎页也得加前缀！</span><br>    <span class="hljs-attr">static-path-pattern:</span> <span class="hljs-string">/res/**</span><br>  <span class="hljs-comment"># 静态资源路径，下方配置已过期</span><br><span class="hljs-comment">#  resources:</span><br><span class="hljs-comment">#    static-locations: classpath:/haha/</span><br>  <span class="hljs-comment"># 新版为如下，若修改后不生效，可以mvn clean一下，</span><br>  <span class="hljs-comment"># 实测指定静态资源文件夹后，META-INF/resources目录仍可以访问</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-attr">static-locations:</span> <span class="hljs-string">classpath:/haha/</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="webjar"><a class="header-anchor" href="#webjar">¶</a>webjar</h3>
<blockquote>
<p>即将一些第三方其他包打包成了jar供我们导入！</p>
</blockquote>
<p>官网：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.webjars.org/">https://www.webjars.org/</a></p>
<p>自动映射 <code>/webjars/**</code></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">    webjars支持</span><br><span class="hljs-comment">    地址：http://localhost:8080/webjars/jquery/3.6.0/jquery.js</span><br><span class="hljs-comment">	后面地址要按照依赖里面的包路径</span><br><span class="hljs-comment">    自动映射/webjars/**</span><br><span class="hljs-comment">    --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jquery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.6.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="欢迎页支持"><a class="header-anchor" href="#欢迎页支持">¶</a>欢迎页支持</h3>
<blockquote>
<p>即默认的index页面！</p>
</blockquote>
<ul>
<li>静态资源路径下  index.html
<ul>
<li>可以配置静态资源路径</li>
<li>但是不可以配置静态资源的访问前缀。否则导致 index.html不能被默认访问</li>
</ul>
</li>
</ul>
<h3 id="自定义-Favicon"><a class="header-anchor" href="#自定义-Favicon">¶</a>自定义 Favicon</h3>
<p>favicon.ico：放在静态资源目录下即可。</p>
<p>注意：同样配置静态资源访问前缀会导致失效！无法生效重启项目或rebuild项目并强制刷新浏览器！</p>
<h3 id="静态资源配置原理"><a class="header-anchor" href="#静态资源配置原理">¶</a>静态资源配置原理</h3>
<ul>
<li>1、SpringBoot启动默认加载  xxxAutoConfiguration 类（自动配置类）</li>
<li>2、SpringMVC功能的自动配置类 WebMvcAutoConfiguration，生效</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span><br><span class="hljs-meta">@ConditionalOnClass({ Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class })</span><br><span class="hljs-meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span><br><span class="hljs-meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span><br><span class="hljs-meta">@AutoConfigureAfter({ DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,</span><br><span class="hljs-meta">		ValidationAutoConfiguration.class })</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcAutoConfiguration</span> </span>{}<br></code></pre></td></tr></tbody></table></figure>
<ul>
<li>3、给容器中配了什么。
<ul>
<li>配置文件的相关属性和xxx进行了绑定。WebMvcProperties，<strong>spring.mvc</strong>、ResourceProperties，<strong>spring.resources</strong></li>
<li>配置类只有一个有参构造器</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@Import(EnableWebMvcConfiguration.class)</span><br><span class="hljs-comment">//  绑定配置文件</span><br><span class="hljs-meta">@EnableConfigurationProperties({ WebMvcProperties.class, ResourceProperties.class })</span><br><span class="hljs-meta">@Order(0)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebMvcAutoConfigurationAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>{}<br><br><br><span class="hljs-comment">// 配置类只有一个有参构造器</span><br><br><span class="hljs-comment">//有参构造器所有参数的值都会从容器中确定</span><br><span class="hljs-comment">//ResourceProperties resourceProperties；获取和spring.resources绑定的所有的值的对象</span><br><span class="hljs-comment">//WebMvcProperties mvcProperties 获取和spring.mvc绑定的所有的值的对象</span><br><span class="hljs-comment">//ListableBeanFactory beanFactory Spring的beanFactory</span><br><span class="hljs-comment">//HttpMessageConverters 找到所有的HttpMessageConverters</span><br><span class="hljs-comment">//ResourceHandlerRegistrationCustomizer 找到 资源处理器的自定义器。=========</span><br><span class="hljs-comment">//DispatcherServletPath  </span><br><span class="hljs-comment">//ServletRegistrationBean   给应用注册Servlet、Filter....</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WebMvcAutoConfigurationAdapter</span><span class="hljs-params">(ResourceProperties resourceProperties, WebMvcProperties mvcProperties,</span></span><br><span class="hljs-function"><span class="hljs-params">                                      ListableBeanFactory beanFactory, ObjectProvider&lt;HttpMessageConverters&gt; messageConvertersProvider,</span></span><br><span class="hljs-function"><span class="hljs-params">                                      ObjectProvider&lt;ResourceHandlerRegistrationCustomizer&gt; resourceHandlerRegistrationCustomizerProvider,</span></span><br><span class="hljs-function"><span class="hljs-params">                                      ObjectProvider&lt;DispatcherServletPath&gt; dispatcherServletPath,</span></span><br><span class="hljs-function"><span class="hljs-params">                                      ObjectProvider&lt;ServletRegistrationBean&lt;?&gt;&gt; servletRegistrations)</span> </span>{<br>    <span class="hljs-keyword">this</span>.resourceProperties = resourceProperties;<br>    <span class="hljs-keyword">this</span>.mvcProperties = mvcProperties;<br>    <span class="hljs-keyword">this</span>.beanFactory = beanFactory;<br>    <span class="hljs-keyword">this</span>.messageConvertersProvider = messageConvertersProvider;<br>    <span class="hljs-keyword">this</span>.resourceHandlerRegistrationCustomizer = resourceHandlerRegistrationCustomizerProvider.getIfAvailable();<br>    <span class="hljs-keyword">this</span>.dispatcherServletPath = dispatcherServletPath;<br>    <span class="hljs-keyword">this</span>.servletRegistrations = servletRegistrations;<br>}<br></code></pre></td></tr></tbody></table></figure>
<ul>
<li>4、资源处理的默认规则</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> </span>{<br>    <span class="hljs-comment">// spring.web.resources.add-mappings设置为false将会导致静态资源配置全部不生效，即静态资源全部无法访问</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.resourceProperties.isAddMappings()) {<br>        logger.debug(<span class="hljs-string">"Default resource handling disabled"</span>);<br>        <span class="hljs-keyword">return</span>;<br>    }<br>    Duration cachePeriod = <span class="hljs-keyword">this</span>.resourceProperties.getCache().getPeriod();<br>    CacheControl cacheControl = <span class="hljs-keyword">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();<br>    <span class="hljs-comment">//webjars的规则</span><br>    <span class="hljs-keyword">if</span> (!registry.hasMappingForPattern(<span class="hljs-string">"/webjars/**"</span>)) {<br>        customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="hljs-string">"/webjars/**"</span>)<br>                                             .addResourceLocations(<span class="hljs-string">"classpath:/META-INF/resources/webjars/"</span>)<br>                                             .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));<br>    }<br><br>    <span class="hljs-comment">// 其他静态文件 this.resourceProperties.getStaticLocations() 里有默认路径值</span><br>    String staticPathPattern = <span class="hljs-keyword">this</span>.mvcProperties.getStaticPathPattern();<br>    <span class="hljs-keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) {<br>        customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern)<br>                                             .addResourceLocations(getResourceLocations(<span class="hljs-keyword">this</span>.resourceProperties.getStaticLocations()))<br>                                             .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>对应配置：</strong></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-attr">static-locations:</span> <span class="hljs-string">classpath:/haha/</span><br>      <span class="hljs-attr">add-mappings:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 是否禁用静态资源的全部配置，true不禁用</span><br></code></pre></td></tr></tbody></table></figure>
<ul>
<li>5、这里的 <code>this.resourceProperties.getStaticLocations())</code> 默认静态资源路径值</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties(prefix = "spring.resources", ignoreUnknownFields = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResourceProperties</span> </span>{<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = { <span class="hljs-string">"classpath:/META-INF/resources/"</span>,<br>                                                                  <span class="hljs-string">"classpath:/resources/"</span>, <span class="hljs-string">"classpath:/static/"</span>, <span class="hljs-string">"classpath:/public/"</span> };<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Locations of static resources. Defaults to classpath:[/META-INF/resources/,</span><br><span class="hljs-comment">	 * /resources/, /static/, /public/].</span><br><span class="hljs-comment">	 */</span><br>    <span class="hljs-keyword">private</span> String[] staticLocations = CLASSPATH_RESOURCE_LOCATIONS;<br></code></pre></td></tr></tbody></table></figure>
<ul>
<li>6、欢迎页面处理规则</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// HandlerMapping：处理器映射。保存了每一个Handler能处理哪些请求。  </span><br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> WelcomePageHandlerMapping <span class="hljs-title">welcomePageHandlerMapping</span><span class="hljs-params">(ApplicationContext applicationContext,</span></span><br><span class="hljs-function"><span class="hljs-params">                                                               FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider)</span> </span>{<br>    WelcomePageHandlerMapping welcomePageHandlerMapping = <span class="hljs-keyword">new</span> WelcomePageHandlerMapping(<br>        <span class="hljs-keyword">new</span> TemplateAvailabilityProviders(applicationContext), applicationContext, getWelcomePage(),<br>        <span class="hljs-keyword">this</span>.mvcProperties.getStaticPathPattern());<br>    welcomePageHandlerMapping.setInterceptors(getInterceptors(mvcConversionService, mvcResourceUrlProvider));<br>    welcomePageHandlerMapping.setCorsConfigurations(getCorsConfigurations());<br>    <span class="hljs-keyword">return</span> welcomePageHandlerMapping;<br>}<br><br>WelcomePageHandlerMapping(TemplateAvailabilityProviders templateAvailabilityProviders,<br>                          ApplicationContext applicationContext, Optional&lt;Resource&gt; welcomePage, String staticPathPattern) {<br>    <span class="hljs-keyword">if</span> (welcomePage.isPresent() &amp;&amp; <span class="hljs-string">"/**"</span>.equals(staticPathPattern)) {<br>        <span class="hljs-comment">//要用欢迎页功能，必须是/**</span><br>        logger.info(<span class="hljs-string">"Adding welcome page: "</span> + welcomePage.get());<br>        setRootViewName(<span class="hljs-string">"forward:index.html"</span>);<br>    }<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (welcomeTemplateExists(templateAvailabilityProviders, applicationContext)) {<br>        <span class="hljs-comment">// 调用Controller  /index</span><br>        logger.info(<span class="hljs-string">"Adding welcome page template: index"</span>);<br>        setRootViewName(<span class="hljs-string">"index"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="3、请求参数处理"><a class="header-anchor" href="#3、请求参数处理">¶</a>3、请求参数处理</h2>
<h3 id="请求映射"><a class="header-anchor" href="#请求映射">¶</a>请求映射</h3>
<h4 id="REST原理"><a class="header-anchor" href="#REST原理">¶</a>REST原理</h4>
<p><strong>原理（表单提交要使用REST的时候）：</strong></p>
<ul>
<li>表单提交会带上<code>_method=PUT</code></li>
<li>请求过来被<code>HiddenHttpMethodFilter</code>拦截
<ul>
<li>请求是否正常，并且是POST
<ul>
<li>获取到<code>_method</code>的值。</li>
<li>兼容以下请求；<code>PUT.DELETE.PATCH</code></li>
<li>原生request（post），<strong>包装模式requesWrapper重写了getMethod方法，返回的是传入的值</strong>。</li>
<li><strong>过滤器链放行的时候用wrapper。以后的方法调用getMethod是调用requesWrapper的。</strong></li>
</ul>
</li>
</ul>
</li>
<li>Rest使用客户端工具，如PostMan直接发送Put、delete等方式请求，无需Filter，不会经过Filter过滤！还是因为表单不支持put，delete请求才进行包装重写！</li>
</ul>
<p><strong>rest风格手动开启：</strong></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mvc:</span><br>    <span class="hljs-comment"># 开启rest风格发送delete和put请求</span><br>    <span class="hljs-attr">hiddenmethod:</span><br>      <span class="hljs-attr">filter:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 默认false</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>SpringBoot的一批新的注解：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>{<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 处理顺序：动态请求 -&gt; META-INF/resource -&gt; resource -&gt; static -&gt; public</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@RequestMapping("/mn.jpg")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"aaa"</span>;<br>    }<br><br><span class="hljs-comment">//    @RequestMapping(value = "/user",method = RequestMethod.GET)</span><br>    <span class="hljs-meta">@GetMapping("/user")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUser</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"GET-张三"</span>;<br>    }<br><br><span class="hljs-comment">//    @RequestMapping(value = "/user",method = RequestMethod.POST)</span><br>    <span class="hljs-meta">@PostMapping("/user")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">saveUser</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"POST-张三"</span>;<br>    }<br><br><br><span class="hljs-comment">//    @RequestMapping(value = "/user",method = RequestMethod.PUT)</span><br>    <span class="hljs-meta">@PutMapping("/user")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">putUser</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"PUT-张三"</span>;<br>    }<br><br><span class="hljs-comment">//    @RequestMapping(value = "/user",method = RequestMethod.DELETE)</span><br>    <span class="hljs-meta">@DeleteMapping("/user")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">deleteUser</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"DELETE-张三"</span>;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>修改默认的_method参数名称：</strong></p>
<ol>
<li>使用@Bean 注入 WebMvcConfigurer</li>
<li>直接实现WebMvcConfigurer接口即可</li>
</ol>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>{<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> HiddenHttpMethodFilter <span class="hljs-title">hiddenHttpMethodFilter</span><span class="hljs-params">()</span></span>{<br>        HiddenHttpMethodFilter methodFilter = <span class="hljs-keyword">new</span> HiddenHttpMethodFilter();<br>        <span class="hljs-comment">// 修改默认的_method参数名！</span><br>        methodFilter.setMethodParam(<span class="hljs-string">"_m"</span>);<br>        <span class="hljs-keyword">return</span> methodFilter;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h4 id="请求映射原理"><a class="header-anchor" href="#请求映射原理">¶</a>请求映射原理</h4>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/11/8cca2ed66bbba4ff1a11520617195442.png" alt=""></p>
<p><strong>SpringMVC功能分析都从 org.springframework.web.servlet.DispatcherServlet -&gt;doDispatch()</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception </span>{<br>    HttpServletRequest processedRequest = request;<br>    HandlerExecutionChain mappedHandler = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">boolean</span> multipartRequestParsed = <span class="hljs-keyword">false</span>;<br><br>    WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);<br><br>    <span class="hljs-keyword">try</span> {<br>        ModelAndView mv = <span class="hljs-keyword">null</span>;<br>        Exception dispatchException = <span class="hljs-keyword">null</span>;<br><br>        <span class="hljs-keyword">try</span> {<br>            processedRequest = checkMultipart(request);<br>            multipartRequestParsed = (processedRequest != request);<br><br>            <span class="hljs-comment">// 找到当前请求使用哪个Handler（Controller的方法）处理</span><br>            mappedHandler = getHandler(processedRequest);<br><br>            <span class="hljs-comment">//HandlerMapping：处理器映射。/xxx-&gt;&gt;xxxx</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>getHandler()方法的handlerMappings处理器映射：</strong></p>
<p>所有的请求映射都在HandlerMapping中：</p>
<ul>
<li>SpringBoot自动配置欢迎页的 <code>WelcomePageHandlerMapping</code> 。访问 <code>/</code>能访问到index.html；</li>
<li>SpringBoot自动配置了默认的 <code>RequestMappingHandlerMapping</code></li>
<li>请求进来，挨个尝试所有的HandlerMapping看是否有请求信息。
<ul>
<li>如果有就找到这个请求对应的 handler</li>
<li>如果没有就是下一个 HandlerMapping</li>
</ul>
</li>
</ul>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/11/d5badd0222c88c887ffa1f31d861fc5d.png" alt=""></p>
<p><strong>RequestMappingHandlerMapping：保存了所有@RequestMapping 和handler的映射规则。</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/11/22bb1f8063e993e558d2144ecc0ea81e.png" alt=""></p>
<p>我们需要一些自定义的映射处理，我们也可以自己给容器中放<strong>HandlerMapping</strong>。自定义 <strong>HandlerMapping</strong></p>
<h3 id="普通参数与基本注解"><a class="header-anchor" href="#普通参数与基本注解">¶</a>普通参数与基本注解</h3>
<h4 id="注解"><a class="header-anchor" href="#注解">¶</a>注解</h4>
<ul>
<li>
<p>@PathVariable：路径参数获取，或使用<code>Map&lt;String, String&gt;</code></p>
</li>
<li>
<p>@RequestHeader：请求头参数获取，或使用<code>Map&lt;String, String&gt;, MultiValueMap&lt;String, String&gt;, or HttpHeaders</code></p>
</li>
<li>
<p>@RequestParam：请求参数获取，或使用<code>Map&lt;String, String&gt; or MultiValueMap&lt;String, String&gt;</code></p>
</li>
<li>
<p>@RequestBody：请求体获取（<strong>post请求才有请求体，表单提交</strong>）</p>
</li>
<li>
<p>@CookieValue：cookie获取</p>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ParameterController</span> </span>{<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 路径参数获取！</span><br><span class="hljs-comment">     * 请求头参数获取！</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     *  Map&lt;String, String&gt; mp：将路径参数全部保存到该map，类型必须为String,String类型</span><br><span class="hljs-comment">     * 	其他的map类似，规定好了的，多参数直接自动封装为map！</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping("/car/{id}/owner/{username}")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">getCar</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id,</span></span><br><span class="hljs-function"><span class="hljs-params">                                      <span class="hljs-meta">@PathVariable</span> String username,</span></span><br><span class="hljs-function"><span class="hljs-params">                                      <span class="hljs-meta">@PathVariable</span> Map&lt;String, String&gt; mp,</span></span><br><span class="hljs-function"><span class="hljs-params">                                      // 请求头参数获取</span></span><br><span class="hljs-function"><span class="hljs-params">                                      <span class="hljs-meta">@RequestHeader("User-Agent")</span> String userAgent,</span></span><br><span class="hljs-function"><span class="hljs-params">                                      <span class="hljs-meta">@RequestHeader</span> Map&lt;String, String&gt; header,</span></span><br><span class="hljs-function"><span class="hljs-params">                                      // 请求参数获取 Map&lt;String, String&gt; or MultiValueMap&lt;String, String&gt;</span></span><br><span class="hljs-function"><span class="hljs-params">                                      <span class="hljs-meta">@RequestParam("age")</span> Integer age,</span></span><br><span class="hljs-function"><span class="hljs-params">                                      <span class="hljs-meta">@RequestParam("inters")</span> List&lt;String&gt; inters,</span></span><br><span class="hljs-function"><span class="hljs-params">                                      <span class="hljs-meta">@RequestParam</span> Map&lt;String, String&gt; params</span></span><br><span class="hljs-function"><span class="hljs-params">                                      // cookie获取</span></span><br><span class="hljs-function"><span class="hljs-params">                                      // <span class="hljs-meta">@CookieValue("_ga")</span> String _ga,</span></span><br><span class="hljs-function"><span class="hljs-params">                                      //<span class="hljs-meta">@CookieValue</span> Cookie cookie,</span></span><br><span class="hljs-function"><span class="hljs-params">                                      )</span></span>{<br>        HashMap&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        map.put(<span class="hljs-string">"id"</span>, id);<br>        map.put(<span class="hljs-string">"username"</span>, username);<br>        map.put(<span class="hljs-string">"mp"</span>, mp);<br>        map.put(<span class="hljs-string">"UA"</span>, userAgent);<br>        map.put(<span class="hljs-string">"header"</span>, header);<br>        map.put(<span class="hljs-string">"age"</span>, age);<br>        map.put(<span class="hljs-string">"inters"</span>, inters);<br>        map.put(<span class="hljs-string">"params"</span>, params);<br>        <span class="hljs-comment">// 谷歌浏览器测试没有Cookie，可以set进去在测试</span><br>        <span class="hljs-comment">// map.put("_ga", _ga);</span><br>        <span class="hljs-comment">// map.put("cookie", cookie);</span><br>        <span class="hljs-keyword">return</span> map;<br>    }<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 请求体获取！</span><br><span class="hljs-comment">     * 获取表单的post提交信息！</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping("/save")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">postMethod</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> String content)</span></span>{<br>        HashMap&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br><br>        map.put(<span class="hljs-string">"content"</span>, content);<br>        <span class="hljs-keyword">return</span> map;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<ul>
<li>@RequestAttribute：获取请求域参数，也可以<code>HttpServletRequest</code></li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RequestController</span> </span>{<br><br>    <span class="hljs-meta">@GetMapping("/goto")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">goToPage</span><span class="hljs-params">(HttpServletRequest request)</span></span>{<br>        request.setAttribute(<span class="hljs-string">"msg"</span>, <span class="hljs-string">"成功了..."</span>);<br>        request.setAttribute(<span class="hljs-string">"code"</span>, <span class="hljs-number">200</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"forward:/success"</span>;<br>    }<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     *  获取request域中数据！</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-meta">@GetMapping("/success")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">success</span><span class="hljs-params">(<span class="hljs-meta">@RequestAttribute(value = "msg", required = false)</span> String msg,</span></span><br><span class="hljs-function"><span class="hljs-params">                                       <span class="hljs-meta">@RequestAttribute(value = "code", required = false)</span> Integer code,</span></span><br><span class="hljs-function"><span class="hljs-params">                                       // 同一次请求可以直接调用request对象</span></span><br><span class="hljs-function"><span class="hljs-params">                                       HttpServletRequest request)</span></span>{<br><br>        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        Object attribute = request.getAttribute(<span class="hljs-string">"msg"</span>);<br><br>        map.put(<span class="hljs-string">"msg"</span>, msg);<br>        map.put(<span class="hljs-string">"code"</span>, code);<br>        map.put(<span class="hljs-string">"request"</span>, attribute);<br><br><br>        <span class="hljs-comment">// 又一次测试</span><br>        map.put(<span class="hljs-string">"map"</span>, request.getAttribute(<span class="hljs-string">"map"</span>));<br>        map.put(<span class="hljs-string">"model"</span>, request.getAttribute(<span class="hljs-string">"model"</span>));<br>        map.put(<span class="hljs-string">"request"</span>, request.getAttribute(<span class="hljs-string">"request"</span>));<br><br><br>        <span class="hljs-keyword">return</span> map;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<ul>
<li>@MatrixVariable：矩阵变量参数获取</li>
</ul>
<p>1、语法： 请求路径：<code>/cars/sell;low=34;brand=byd,audi,yd</code></p>
<p>2、SpringBoot 默认是禁用了矩阵变量的功能</p>
<ul>
<li>
<pre><code> 手动开启：原理。对于路径的处理是UrlPathHelper进行解析。
</code></pre>
</li>
<li>
<pre><code>         removeSemicolonContent（移除分号内容）支持矩阵变量的，默认是true，需要改为true进行支持！
</code></pre>
</li>
</ul>
<p>3、矩阵变量必须有url路径变量才能被解析，即矩阵变量在url中要<code>{}</code>括起来</p>
<p><strong>手动开启矩阵变量功能：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>{<br><br>    <span class="hljs-comment">// 1. @Bean 一个 WebMvcConfigurer</span><br>    <span class="hljs-comment">// 2. 直接实现WebMvcConfigurer接口后重写方法即可</span><br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configurePathMatch</span><span class="hljs-params">(PathMatchConfigurer configurer)</span> </span>{<br>        UrlPathHelper urlPathHelper = <span class="hljs-keyword">new</span> UrlPathHelper();<br>        <span class="hljs-comment">// 设置不移除分号后面内容，矩阵变量才可以生效！</span><br>        urlPathHelper.setRemoveSemicolonContent(<span class="hljs-keyword">false</span>);<br>        configurer.setUrlPathHelper(urlPathHelper);<br>    }<br>    <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> WebMvcConfigurer <span class="hljs-title">webMvcConfigurer</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> WebMvcConfigurer() {<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configurePathMatch</span><span class="hljs-params">(PathMatchConfigurer configurer)</span> </span>{<br>                UrlPathHelper urlPathHelper = <span class="hljs-keyword">new</span> UrlPathHelper();<br>                <span class="hljs-comment">// 设置不移除分号后面内容，矩阵变量才可以生效！</span><br>                urlPathHelper.setRemoveSemicolonContent(<span class="hljs-keyword">false</span>);<br>                configurer.setUrlPathHelper(urlPathHelper);<br>            }<br>        };<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>测试：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * /cars/sell;low=34;brand=byd,audi,yd  ；矩阵变量</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * 问题：页面开发，cookie禁用了，session里面的内容怎么使用；</span><br><span class="hljs-comment"> * 		session.set(a,b)---&gt; jsessionid ---&gt; cookie ----&gt; 每次发请求携带。</span><br><span class="hljs-comment"> * 		url重写：/abc;jsesssionid=xxxx 把cookie的值使用矩阵变量的方式进行传递.</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * /cars/sell;low=34;brand=byd,audi,yd</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@GetMapping("/cars/{path}")</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">carsSell</span><span class="hljs-params">(<span class="hljs-meta">@MatrixVariable("low")</span> Integer low,</span></span><br><span class="hljs-function"><span class="hljs-params">                                    <span class="hljs-meta">@MatrixVariable("brand")</span> List&lt;String&gt; brand,</span></span><br><span class="hljs-function"><span class="hljs-params">                                    <span class="hljs-meta">@PathVariable("path")</span> String path)</span></span>{<br>    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br><br>    map.put(<span class="hljs-string">"low"</span>, low);<br>    map.put(<span class="hljs-string">"brand"</span>, brand);<br>    map.put(<span class="hljs-string">"path"</span>, path);<br>    <span class="hljs-keyword">return</span> map;<br>}<br><br><span class="hljs-comment">// 可以使用pathVar指定哪个路径的相同参数！</span><br><span class="hljs-comment">// /boss/1;age=20/2;age=10</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@GetMapping("/boss/{bossId}/{empId}")</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Map <span class="hljs-title">boss</span><span class="hljs-params">(<span class="hljs-meta">@MatrixVariable(value = "age",pathVar = "bossId")</span> Integer bossAge,</span></span><br><span class="hljs-function"><span class="hljs-params">                <span class="hljs-meta">@MatrixVariable(value = "age",pathVar = "empId")</span> Integer empAge)</span></span>{<br>    Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br><br>    map.put(<span class="hljs-string">"bossAge"</span>,bossAge);<br>    map.put(<span class="hljs-string">"empAge"</span>,empAge);<br>    <span class="hljs-keyword">return</span> map;<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<h4 id="Servlet-API"><a class="header-anchor" href="#Servlet-API">¶</a>Servlet API</h4>
<p><strong>ServletRequestMethodArgumentResolver 来解析以下的部分参数：</strong></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">WebRequest、ServletRequest、MultipartRequest、 HttpSession、javax.servlet.http.PushBuilder、Principal、InputStream、Reader、HttpMethod、Locale、TimeZone、ZoneId<br></code></pre></td></tr></tbody></table></figure>
<h4 id="复杂参数"><a class="header-anchor" href="#复杂参数">¶</a>复杂参数</h4>
<blockquote>
<p><strong>Map</strong>、**Model（map、model里面的数据会被放在request的请求域  request.setAttribute）、**Errors/BindingResult、<strong>RedirectAttributes（ 重定向携带数据）</strong>、<strong>ServletResponse（response）</strong>、SessionStatus、UriComponentsBuilder、ServletUriComponentsBuilder</p>
</blockquote>
<h4 id="自定义对象参数"><a class="header-anchor" href="#自定义对象参数">¶</a>自定义对象参数</h4>
<p>可以自动类型转换与格式化，可以级联封装！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *     姓名： &lt;input name="userName"/&gt; &lt;br/&gt;</span><br><span class="hljs-comment"> *     年龄： &lt;input name="age"/&gt; &lt;br/&gt;</span><br><span class="hljs-comment"> *     生日： &lt;input name="birth"/&gt; &lt;br/&gt;</span><br><span class="hljs-comment"> *     宠物姓名：&lt;input name="pet.name"/&gt;&lt;br/&gt;</span><br><span class="hljs-comment"> *     宠物年龄：&lt;input name="pet.age"/&gt;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{<br>    <br>    <span class="hljs-keyword">private</span> String userName;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> Date birth;<br>    <span class="hljs-keyword">private</span> Pet pet;<br>    <br>}<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pet</span> </span>{<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String age;<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="POJO封装过程"><a class="header-anchor" href="#POJO封装过程">¶</a>POJO封装过程</h3>
<p>ServletModelAttributeMethodProcessor来解析参数！</p>
<h3 id="参数处理原理"><a class="header-anchor" href="#参数处理原理">¶</a>参数处理原理</h3>
<ul>
<li>
<p>HandlerMapping中找到能处理请求的Handler（Controller.method()）</p>
</li>
<li>
<p>为当前Handler 找一个适配器 HandlerAdapter； <strong>RequestMappingHandlerAdapter</strong></p>
</li>
<li>
<p>适配器执行目标方法并确定方法参数的每一个值</p>
</li>
<li>
<p><strong>1、HandlerAdapter</strong></p>
<ul>
<li>支持方法上标注@RequestMapping</li>
<li>支持函数式编程的等等</li>
</ul>
</li>
</ul>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/11/ef03fb15f5c7380a241c11a435287243.png" alt=""></p>
<ul>
<li><strong>2、执行目标方法</strong></li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Actually invoke the handler.</span><br><span class="hljs-comment">//DispatcherServlet -- doDispatch</span><br>mv = ha.handle(processedRequest, response, mappedHandler.getHandler());<br><br><br><br>mav = invokeHandlerMethod(request, response, handlerMethod); <span class="hljs-comment">//执行目标方法</span><br><br><br><span class="hljs-comment">//ServletInvocableHandlerMethod 执行当前请求，会调用controller中的对应方法</span><br>Object returnValue = invokeForRequest(webRequest, mavContainer, providedArgs);<br></code></pre></td></tr></tbody></table></figure>
<ul>
<li><strong>3、参数解析器-HandlerMethodArgumentResolver</strong>
<ul>
<li>确定将要执行的目标方法的每一个参数的值是什么;</li>
<li>SpringMVC目标方法能写多少种参数类型。取决于参数解析器。</li>
</ul>
</li>
</ul>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/11/29271034c9ae0e77eb06ddfb54565dce.png" alt=""></p>
<ul>
<li>当前解析器是否支持解析这种参数</li>
<li>支持就调用 resolveArgument</li>
</ul>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/11/79460da51895f8cedf0c38f8cd132994.png" alt=""></p>
<ul>
<li><strong>4、返回值处理器</strong></li>
</ul>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/11/6fa478f1b0d1cc8f2dbd9f04b345cc48.png" alt=""></p>
<ul>
<li><strong>5、如何确定目标方法每一个参数的值</strong></li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//获取方法的参数值</span><br>Object[] args = getMethodArgumentValues(request, mavContainer, providedArgs);<br></code></pre></td></tr></tbody></table></figure>
<ul>
<li>
<p><strong>5.1、挨个判断所有参数解析器哪个支持解析这个参数</strong></p>
</li>
<li>
<p><strong>5.2、解析这个参数的值</strong></p>
<ul>
<li>调用各自 <code>HandlerMethodArgumentResolver</code> 的 <code>resolveArgument</code> 方法即可</li>
</ul>
</li>
<li>
<p><strong>5.3、自定义类型参数封装POJO</strong></p>
<ul>
<li>这个参数处理器支持</li>
<li>是否为简单类型。</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">WebDataBinder binder = binderFactory.createBinder(webRequest, attribute, name);<br></code></pre></td></tr></tbody></table></figure>
<ul>
<li>WebDataBinder：web数据绑定器，将请求参数的值绑定到指定的JavaBean里面</li>
<li>WebDataBinder：利用它里面的 Converters 将请求数据转成指定的数据类型。再次封装到JavaBean中</li>
<li>GenericConversionService：在设置每一个值的时候，找它里面的所有converter那个可以将这个数据类型（request带来参数的字符串）转换到指定的类型（JavaBean – Integer）</li>
<li><strong>未来我们可以给WebDataBinder里面放自己的Converter；</strong></li>
</ul>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/11/a8f341a19125c1df86bb2fb2b8f96dbc.png" alt=""></p>
<ul>
<li><strong>5.4、自定义 Converter</strong></li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>{<br><br>    <span class="hljs-comment">// 1. @Bean // WebMvcConfigurer</span><br>    <span class="hljs-comment">// 2. 直接实现WebMvcConfigurer接口即可</span><br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> WebMvcConfigurer <span class="hljs-title">webMvcConfigurer</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> WebMvcConfigurer() {<br>            <span class="hljs-comment">// 重写一个 自定义 converter</span><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addFormatters</span><span class="hljs-params">(FormatterRegistry registry)</span> </span>{<br>                registry.addConverter(<span class="hljs-keyword">new</span> Converter&lt;String, Pet&gt;() {<br><br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-function"><span class="hljs-keyword">public</span> Pet <span class="hljs-title">convert</span><span class="hljs-params">(String source)</span> </span>{<br>                        <span class="hljs-keyword">if</span>(!StringUtils.isEmpty(source)){<br>                            Pet pet = <span class="hljs-keyword">new</span> Pet();<br>                            String[] split = source.split(<span class="hljs-string">","</span>);<br>                            pet.setName(split[<span class="hljs-number">0</span>]);<br>                            pet.setAge(Integer.parseInt(split[<span class="hljs-number">1</span>]));<br>                            <span class="hljs-keyword">return</span> pet;<br>                        }<br>                        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>                    }<br>                });<br>            }<br>        }<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<ul>
<li><strong>6、目标方法执行完成</strong>
<ul>
<li>将所有的数据都放在 <strong>ModelAndViewContainer</strong>；包含要去的页面地址View。还包含Model数据。</li>
</ul>
</li>
</ul>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/11/79c81cc12f49e78ecd76b3f8c4ab34bf.png" alt=""></p>
<ul>
<li><strong>7、处理派发结果</strong></li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);<br>renderMergedOutputModel(mergedModel, getRequestToExpose(request), response);<br><span class="hljs-comment">// 暴露模型作为请求域属性</span><br><span class="hljs-comment">// Expose the model object as request attributes.</span><br>exposeModelAsRequestAttributes(model, request);<br><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">exposeModelAsRequestAttributes</span><span class="hljs-params">(Map&lt;String, Object&gt; model,</span></span><br><span class="hljs-function"><span class="hljs-params">                                              HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception </span>{<br><br>    <span class="hljs-comment">//model中的所有数据遍历挨个放在请求域中</span><br>    model.forEach((name, value) -&gt; {<br>        <span class="hljs-keyword">if</span> (value != <span class="hljs-keyword">null</span>) {<br>            request.setAttribute(name, value);<br>        }<br>        <span class="hljs-keyword">else</span> {<br>            request.removeAttribute(name);<br>        }<br>    });<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="4、数据响应与内容协商"><a class="header-anchor" href="#4、数据响应与内容协商">¶</a>4、数据响应与内容协商</h2>
<h3 id="响应JSON"><a class="header-anchor" href="#响应JSON">¶</a>响应JSON</h3>
<h4 id="jackson-jar-ResponseBody"><a class="header-anchor" href="#jackson-jar-ResponseBody">¶</a>jackson.jar+@ResponseBody</h4>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>web场景自动引入了json场景<br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-json<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="返回值解析器原理"><a class="header-anchor" href="#返回值解析器原理">¶</a>返回值解析器原理</h3>
<ul>
<li>返回值处理器判断是否支持这种类型返回值 supportsReturnType</li>
<li>返回值处理器调用 handleReturnValue 进行处理</li>
<li>RequestResponseBodyMethodProcessor 可以处理返回值标了@ResponseBody 注解的。
<ul>
<li>利用 MessageConverters 进行处理将数据写为json
<ul>
<li><strong>内容协商</strong>（浏览器默认会以请求头的方式告诉服务器他能接受什么样的内容类型）</li>
<li>服务器最终根据自己自身的能力，决定服务器能生产出什么样内容类型的数据，</li>
<li>SpringMVC会挨个遍历所有容器底层的 HttpMessageConverter ，看谁能处理？
<ul>
<li>得到MappingJackson2HttpMessageConverter可以将对象写为json</li>
<li>利用MappingJackson2HttpMessageConverter将对象转为json再写出去。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/11/be510f7c44ea2be159f2edab440e8099.png" alt=""></p>
<h3 id="SpringMVC支持的返回值"><a class="header-anchor" href="#SpringMVC支持的返回值">¶</a>SpringMVC支持的返回值</h3>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plain">ModelAndView<br>Model<br>View<br>ResponseEntity <br>ResponseBodyEmitter<br>StreamingResponseBody<br>HttpEntity<br>HttpHeaders<br>Callable<br>DeferredResult<br>ListenableFuture<br>CompletionStage<br>WebAsyncTask<br>有 @ModelAttribute 且为对象类型的<br>@ResponseBody 注解 ---&gt; RequestResponseBodyMethodProcessor<br></code></pre></td></tr></tbody></table></figure>
<h3 id="HTTPMessageConverter原理"><a class="header-anchor" href="#HTTPMessageConverter原理">¶</a>HTTPMessageConverter原理</h3>
<h4 id="MessageConverter规范"><a class="header-anchor" href="#MessageConverter规范">¶</a>MessageConverter规范</h4>
<p>HttpMessageConverter: 看是否支持将此 Class类型的对象，转为MediaType类型的数据。</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/11/3b87214940a1331d9259c6c189c704a2.png" alt=""></p>
<h4 id="默认的MessageConverter"><a class="header-anchor" href="#默认的MessageConverter">¶</a>默认的MessageConverter</h4>
<p>最终 <code>MappingJackson2HttpMessageConverter</code>  把对象转为JSON（利用底层的jackson的objectMapper转换的）</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/11/ad48ee43f3360d1c895ae2c489902254.png" alt=""></p>
<h3 id="内容协商"><a class="header-anchor" href="#内容协商">¶</a>内容协商</h3>
<blockquote>
<p>根据客户端接收能力不同，返回不同媒体类型的数据。</p>
</blockquote>
<h4 id="引入xml依赖"><a class="header-anchor" href="#引入xml依赖">¶</a>引入xml依赖</h4>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--支持内容协商 jackson 支持 xml模块 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="postman分别测试返回json和xml"><a class="header-anchor" href="#postman分别测试返回json和xml">¶</a>postman分别测试返回json和xml</h4>
<p>只需要改变请求头中Accept字段。Http协议中规定的，告诉服务器本客户端可以接收的数据类型！</p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/11/c3466f78461255e24bbcb7798b72c1ad.png" alt=""></p>
<h4 id="开启浏览器参数方式内容协商功能"><a class="header-anchor" href="#开启浏览器参数方式内容协商功能">¶</a>开启浏览器参数方式内容协商功能</h4>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>    <span class="hljs-attr">contentnegotiation:</span><br>      <span class="hljs-attr">favor-parameter:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment">#开启请求参数内容协商模式</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>发请求：</strong></p>
<ul>
<li><code>http://localhost:8080/test/person?format=json</code></li>
<li><code>http://localhost:8080/test/person?format=xml</code></li>
</ul>
<h4 id="内容协商原理"><a class="header-anchor" href="#内容协商原理">¶</a>内容协商原理</h4>
<ul>
<li>
<p>1、判断当前响应头中是否已经有确定的媒体类型。MediaType</p>
</li>
<li>
<p><strong>2、获取客户端（PostMan、浏览器）支持接收的内容类型。获取客户端Accept请求头字段 application/xml</strong></p>
<ul>
<li>contentNegotiationManager 内容协商管理器 默认使用基于请求头的策略</li>
<li>HeaderContentNegotiationStrategy  确定客户端可以接收的内容类型</li>
</ul>
</li>
<li>
<p>3、遍历循环所有当前系统的 <strong>MessageConverter</strong>，看谁支持操作这个对象（Person）</p>
</li>
<li>
<p>4、找到支持操作Person的converter，把converter支持的媒体类型统计出来。</p>
</li>
<li>
<p>5、客户端需要 application/xml。服务端能力【10种、json、xml】</p>
</li>
</ul>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/11/97917c71f0a940faed8d2264caaeff2c.png" alt=""></p>
<ul>
<li>6、进行内容协商的最佳匹配媒体类型</li>
<li>7、用支持将对象转为最佳匹配媒体类型的converter。调用它进行转化 。</li>
</ul>
<h4 id="自定义-MessageConverter"><a class="header-anchor" href="#自定义-MessageConverter">¶</a>自定义 MessageConverter</h4>
<p>实现多协议数据兼容。json、xml、x-nb</p>
<p><strong>流程：</strong></p>
<ul>
<li>@ResponseBody 响应数据出去 调用 RequestResponseBodyMethodProcessor 处理</li>
<li>Processor 处理方法返回值。通过 MessageConverter 处理</li>
<li>所有 MessageConverter 合起来可以支持各种媒体类型数据的操作（读、写）</li>
<li>内容协商找到最终的 messageConverter；</li>
</ul>
<p><strong>自定义的NBMessageConverter：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NBMessageConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HttpMessageConverter</span>&lt;<span class="hljs-title">Person</span>&gt; </span>{<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">canRead</span><span class="hljs-params">(Class&lt;?&gt; clazz, MediaType mediaType)</span> </span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">canWrite</span><span class="hljs-params">(Class&lt;?&gt; clazz, MediaType mediaType)</span> </span>{<br>        <span class="hljs-comment">// Person类型时可写</span><br>        <span class="hljs-keyword">return</span> clazz.isAssignableFrom(Person.class);<br>    }<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 告诉MessageConverter这个Converter能写那些数据类型！</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     *  application/x-nb</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;MediaType&gt; <span class="hljs-title">getSupportedMediaTypes</span><span class="hljs-params">()</span> </span>{<br>        <span class="hljs-keyword">return</span> MediaType.parseMediaTypes(<span class="hljs-string">"application/x-nb"</span>);<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Person <span class="hljs-title">read</span><span class="hljs-params">(Class&lt;? extends Person&gt; clazz, HttpInputMessage inputMessage)</span> <span class="hljs-keyword">throws</span> IOException, HttpMessageNotReadableException </span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    }<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 自定义数据类型的写出！</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> person</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> contentType</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> outputMessage</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> HttpMessageNotWritableException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write</span><span class="hljs-params">(Person person, MediaType contentType, HttpOutputMessage outputMessage)</span> <span class="hljs-keyword">throws</span> IOException, HttpMessageNotWritableException </span>{<br>        <span class="hljs-comment">// 自定义写出格式</span><br>        String data = person.getUserName() + <span class="hljs-string">";"</span> + person.getAge() + <span class="hljs-string">";"</span> + person.getBirth();<br>        <span class="hljs-comment">// 获取写出流写出去</span><br>        OutputStream body = outputMessage.getBody();<br>        body.write(data.getBytes());<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>加入容器：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>{<br><br><br>    <span class="hljs-comment">// 1. @Bean // WebMvcConfigurer</span><br>    <span class="hljs-comment">// 2. 直接实现WebMvcConfigurer接口即可</span><br><br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> WebMvcConfigurer <span class="hljs-title">webMvcConfigurer</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> WebMvcConfigurer() {<br>            <span class="hljs-comment">// 自定义 messageConverter</span><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">extendMessageConverters</span><span class="hljs-params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>{<br>                <span class="hljs-comment">// 添加我们自定义的Converter！</span><br>                converters.add(<span class="hljs-keyword">new</span> NBMessageConverter());<br>            }<br>        };<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>测试：</strong></p>
<p>使用postman在请求头添加 <code>Accept=application/x-nb</code>发送请求测试即可！</p>
<h4 id="基于浏览器参数的内容协商"><a class="header-anchor" href="#基于浏览器参数的内容协商">¶</a>基于浏览器参数的内容协商</h4>
<p>将自定义的 <code>application/x-nb</code>绑定为<code>nb</code>使用浏览器请求参数format传进去！</p>
<p>有可能我们添加的自定义的功能会覆盖默认很多功能，导致一些默认的功能失效。</p>
<p><strong>测试</strong>：<code>http://localhost:8080/test/person?format=nb</code></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>{<br><br>    <span class="hljs-comment">// 1. @Bean // WebMvcConfigurer</span><br>    <span class="hljs-comment">// 2. 直接实现WebMvcConfigurer接口即可</span><br>    <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> WebMvcConfigurer <span class="hljs-title">webMvcConfigurer</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> WebMvcConfigurer() {<br>            <br>            <span class="hljs-comment">// 自定义 messageConverter</span><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">extendMessageConverters</span><span class="hljs-params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>{<br>                <span class="hljs-comment">// 添加我们自定义的Converter！</span><br>                converters.add(<span class="hljs-keyword">new</span> NBMessageConverter());<br>            }<br><br>            <span class="hljs-comment">// 添加参数format支持的自定义类型 nb</span><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configureContentNegotiation</span><span class="hljs-params">(ContentNegotiationConfigurer configurer)</span> </span>{<br>                HashMap&lt;String, MediaType&gt; mediaTypes = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>                <span class="hljs-comment">// 指定解析映射（基于请求参数）</span><br>                mediaTypes.put(<span class="hljs-string">"json"</span>, MediaType.APPLICATION_JSON);<br>                mediaTypes.put(<span class="hljs-string">"xml"</span>, MediaType.APPLICATION_ATOM_XML);<br>                mediaTypes.put(<span class="hljs-string">"nb"</span>, MediaType.parseMediaType(<span class="hljs-string">"application/x-nb"</span>));<br>                ParameterContentNegotiationStrategy paramsStrategy = <span class="hljs-keyword">new</span><br>                        ParameterContentNegotiationStrategy(mediaTypes);<br><br>                <span class="hljs-comment">// 同样可以设置默认的请求参数名format！</span><br>                <span class="hljs-comment">// paramsStrategy.setParameterName("ff");</span><br><br>                <span class="hljs-comment">// （基于请求头）</span><br>                <span class="hljs-comment">// 配置完毕上面的自定义请求参数映射后，将会覆盖底层默认的两种，因此再次将</span><br>                <span class="hljs-comment">// 基于请求头的再注入回去！</span><br>                HeaderContentNegotiationStrategy headerStrategy = <span class="hljs-keyword">new</span> HeaderContentNegotiationStrategy();<br><br>                configurer.strategies(Arrays.asList(paramsStrategy, headerStrategy ));<br>            }<br>        };<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="5、视图解析原理"><a class="header-anchor" href="#5、视图解析原理">¶</a>5、视图解析原理</h2>
<ul>
<li>目标方法处理的过程中，所有数据都会被放在 <strong>ModelAndViewContainer</strong> 里面。<strong>包括数据和视图地址</strong></li>
<li>方法的参数是一个自定义类型对象（从请求参数中确定的），把他重新放在 ModelAndViewContainer</li>
<li><strong>任何目标方法执行完成以后都会返回 ModelAndView（数据和视图地址）。</strong></li>
<li><strong>processDispatchResult  处理派发结果（页面改如何响应）</strong>
<ul>
<li><strong>render(mv, request, response); 进行页面渲染逻辑</strong>
<ul>
<li>根据方法的String返回值得到 <strong>View</strong> 对象【定义了页面的渲染逻辑】
<ul>
<li>所有的视图解析器尝试是否能根据当前返回值得到View对象</li>
<li>得到了  redirect:/main.html --&gt; Thymeleaf new RedirectView()</li>
<li>ContentNegotiationViewResolver 里面包含了下面所有的视图解析器，内部还是利用下面所有视图解析器得到视图对象。</li>
<li><code>view.render(mv.getModelInternal(), request, response)</code>   视图对象调用自定义的render进行页面渲染工作
<ul>
<li>RedirectView 如何渲染【重定向到一个页面】</li>
<li>获取目标url地址</li>
<li>response.sendRedirect(encodedURL);</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>视图解析：</strong></p>
<ul>
<li>返回值以 <strong>forward:</strong> 开始： <code>new InternalResourceView(forwardUrl)</code>, 转发 <code>request.getRequestDispatcher(path).forward(request, response)</code></li>
<li>返回值以 <strong>redirect:</strong> 开始： <code>new RedirectView()</code>，render就是重定向</li>
<li>返回值是普通字符串： <code>new ThymeleafView()</code></li>
</ul>
<h2 id="6、模板引擎Thymeleaf"><a class="header-anchor" href="#6、模板引擎Thymeleaf">¶</a>6、模板引擎Thymeleaf</h2>
<h3 id="thymeleaf简介"><a class="header-anchor" href="#thymeleaf简介">¶</a>thymeleaf简介</h3>
<p>Thymeleaf is a modern server-side Java template engine for both web and standalone environments, capable of processing HTML, XML, JavaScript, CSS and even plain text.</p>
<p><strong>现代化、服务端Java模板引擎</strong></p>
<h3 id="基本语法-2"><a class="header-anchor" href="#基本语法-2">¶</a>基本语法</h3>
<p><strong>表达式：</strong></p>
<table>
<thead>
<tr>
<th>表达式名字</th>
<th>语法</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>变量取值</td>
<td>${…}</td>
<td>获取请求域、session域、对象等值</td>
</tr>
<tr>
<td>选择变量</td>
<td>*{…}</td>
<td>获取上下文对象值</td>
</tr>
<tr>
<td>消息</td>
<td>#{…}</td>
<td>获取国际化等值</td>
</tr>
<tr>
<td>链接</td>
<td>@{…}</td>
<td>生成链接</td>
</tr>
<tr>
<td>片段表达式</td>
<td>~{…}</td>
<td>jsp:include 作用，引入公共页面片段</td>
</tr>
</tbody>
</table>
<p><strong>字面量：</strong></p>
<p>文本值: <strong>‘one text’</strong> <strong>,</strong> <strong>‘Another one!’</strong> <strong>,…</strong></p>
<p>数字: <strong>0</strong> <strong>,</strong> <strong>34</strong> <strong>,</strong> <strong>3.0</strong> <strong>,</strong> <strong>12.3</strong> <strong>,…</strong></p>
<p>布尔值: <strong>true</strong> <strong>,</strong> <strong>false</strong></p>
<p>空值: <strong>null</strong></p>
<p>变量： one，two，… 变量不能有空格</p>
<p><strong>文本操作：</strong></p>
<p>字符串拼接: <strong>+</strong></p>
<p>变量替换: <strong>|The name is ${name}|</strong></p>
<p><strong>数学运算：</strong></p>
<p>运算符: + , - , * , / , %</p>
<p><strong>布尔运算：</strong></p>
<p>运算符:  <strong>and</strong> <strong>,</strong> <strong>or</strong></p>
<p>一元运算: <strong>!</strong> <strong>,</strong> <strong>not</strong></p>
<p><strong>比较运算：</strong></p>
<p>比较: <strong>&gt;</strong> <strong>,</strong> <strong>&lt;</strong> <strong>,</strong> <strong>&gt;=</strong> <strong>,</strong> <strong>&lt;=</strong> <strong>(</strong> <strong>gt</strong> <strong>,</strong> <strong>lt</strong> <strong>,</strong> <strong>ge</strong> <strong>,</strong> <strong>le</strong> <strong>)</strong></p>
<p>等式: <strong>==</strong> <strong>,</strong> <strong>!=</strong> <strong>(</strong> <strong>eq</strong> <strong>,</strong> <strong>ne</strong> <strong>)</strong></p>
<p><strong>条件运算：</strong></p>
<p>If-then: <strong>(if) ? (then)</strong></p>
<p>If-then-else: <strong>(if) ? (then) : (else)</strong></p>
<p>Default: (value) <strong>?: (defaultvalue)</strong></p>
<h3 id="设置属性值"><a class="header-anchor" href="#设置属性值">¶</a>设置属性值</h3>
<p><strong>设置单个值：</strong></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"subscribe.html"</span> <span class="hljs-attr">th:attr</span>=<span class="hljs-string">"action=@{/subscribe}"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">fieldset</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"email"</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Subscribe!"</span> <span class="hljs-attr">th:attr</span>=<span class="hljs-string">"value=#{subscribe.submit}"</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">fieldset</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>设置多个值：</strong></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"../../images/gtvglogo.png"</span>  <span class="hljs-attr">th:attr</span>=<span class="hljs-string">"src=@{/images/gtvglogo.png},title=#{logo},alt=#{logo}"</span> /&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>以上两个的代替写法 <code>th:xxxx</code>：</strong></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Subscribe!"</span> <span class="hljs-attr">th:value</span>=<span class="hljs-string">"#{subscribe.submit}"</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"subscribe.html"</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">"@{/subscribe}"</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>所有h5兼容的标签写法：</strong><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-value-to-specific-attributes">https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-value-to-specific-attributes</a></p>
<h3 id="迭代"><a class="header-anchor" href="#迭代">¶</a>迭代</h3>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">"prod : ${prods}"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${prod.name}"</span>&gt;</span>Onions<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${prod.price}"</span>&gt;</span>2.41<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${prod.inStock}? #{true} : #{false}"</span>&gt;</span>yes<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">"prod,iterStat : ${prods}"</span> <span class="hljs-attr">th:class</span>=<span class="hljs-string">"${iterStat.odd}? 'odd'"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${prod.name}"</span>&gt;</span>Onions<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${prod.price}"</span>&gt;</span>2.41<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${prod.inStock}? #{true} : #{false}"</span>&gt;</span>yes<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="条件运算"><a class="header-anchor" href="#条件运算">¶</a>条件运算</h3>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"comments.html"</span></span><br><span class="hljs-tag"><span class="hljs-attr">th:href</span>=<span class="hljs-string">"@{/product/comments(prodId=${prod.id})}"</span></span><br><span class="hljs-tag"><span class="hljs-attr">th:if</span>=<span class="hljs-string">"${not #lists.isEmpty(prod.comments)}"</span>&gt;</span>view<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:switch</span>=<span class="hljs-string">"${user.role}"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:case</span>=<span class="hljs-string">"'admin'"</span>&gt;</span>User is an administrator<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:case</span>=<span class="hljs-string">"#{roles.manager}"</span>&gt;</span>User is a manager<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:case</span>=<span class="hljs-string">"*"</span>&gt;</span>User is some other thing<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="属性优先级"><a class="header-anchor" href="#属性优先级">¶</a>属性优先级</h3>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/12/1a621ab5b3d001466c9c21624fab7963.png" alt=""></p>
<h2 id="7、Thymeleaf使用"><a class="header-anchor" href="#7、Thymeleaf使用">¶</a>7、Thymeleaf使用</h2>
<h3 id="引入Starter"><a class="header-anchor" href="#引入Starter">¶</a>引入Starter</h3>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="自动配置好了thymeleaf"><a class="header-anchor" href="#自动配置好了thymeleaf">¶</a>自动配置好了thymeleaf</h3>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@EnableConfigurationProperties(ThymeleafProperties.class)</span><br><span class="hljs-meta">@ConditionalOnClass({ TemplateMode.class, SpringTemplateEngine.class })</span><br><span class="hljs-meta">@AutoConfigureAfter({ WebMvcAutoConfiguration.class, WebFluxAutoConfiguration.class })</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThymeleafAutoConfiguration</span> </span>{ }<br></code></pre></td></tr></tbody></table></figure>
<h3 id="自动配好的策略"><a class="header-anchor" href="#自动配好的策略">¶</a>自动配好的策略</h3>
<ul>
<li>
<p>所有thymeleaf的配置值都在 ThymeleafProperties</p>
</li>
<li>
<p>配置好了 <strong>SpringTemplateEngine</strong></p>
</li>
<li>
<p>配好了 <strong>ThymeleafViewResolver</strong></p>
</li>
<li>
<p>我们只需要直接开发页面</p>
</li>
</ul>
<p><strong>默认配置好的前后缀：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String DEFAULT_PREFIX = <span class="hljs-string">"classpath:/templates/"</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String DEFAULT_SUFFIX = <span class="hljs-string">".html"</span>;  <span class="hljs-comment">//xxx.html</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>需引入thymeleaf的名称空间：</strong></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">"http://www.thymeleaf.org"</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="和"><a class="header-anchor" href="#和">¶</a>$和@</h3>
<p>@会自动用地址拼串，即使你加了 全局访问前缀路径，也会自动帮你拼接！</p>
<p>即使添加了访问前缀路径！</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/hello</span> <span class="hljs-comment"># 访问前缀路径</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>测试页面：</strong></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-comment">&lt;!--加入thymeleaf名称空间--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">"http://www.thymeleaf.org"</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${msg}"</span>&gt;</span>哈哈<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        解析结果：</span><br><span class="hljs-comment">            &lt;a href="https://www.itnxd.cn"&gt;去百度&lt;/a&gt;</span><br><span class="hljs-comment">            &lt;a href="link"&gt;去百度&lt;/a&gt;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        @会自动用地址拼串，即使你加了 全局访问前缀路径，也会自动帮你拼接！</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        &lt;a href="/hello/link"&gt;去百度&lt;/a&gt;</span><br><span class="hljs-comment">        --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"www.baidu.com"</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"${link}"</span>&gt;</span>去百度<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"www.baidu.com"</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@{/link}"</span>&gt;</span>去百度<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="行内写法"><a class="header-anchor" href="#行内写法">¶</a>行内写法</h3>
<p><code>th:text="${xxx}"</code>：标签内写法</p>
<p><code>[[${xxx}]]</code>：行内写法，标签外写法</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default dropdown-toggle"</span> <span class="hljs-attr">data-toggle</span>=<span class="hljs-string">"dropdown"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"images/photos/user-avatar.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> /&gt;</span><br>    [[${session.loginUser.userName}]]<br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"caret"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><br> <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"value"</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${indexCount}"</span>&gt;</span>230<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="抽取公共页面"><a class="header-anchor" href="#抽取公共页面">¶</a>抽取公共页面</h3>
<blockquote>
<p>官方文档：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#template-layout">https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#template-layout</a></p>
</blockquote>
<p><strong>可使用<code>th:fragment</code>或直接使用id选择器也可以声明为公共页面！</strong></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">"http://www.thymeleaf.org"</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span> <span class="hljs-attr">th:fragment</span>=<span class="hljs-string">"commonheader"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"css/style.css"</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@{/css/style.css}"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"css/style-responsive.css"</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@{/css/style-responsive.css}"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"leftmenu"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"left-side sticky-left-side"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:fragment</span>=<span class="hljs-string">"headermenu"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header-section"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"commonscript"</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>引用公共页面：</strong></p>
<ul>
<li>
<p>th:insert</p>
</li>
<li>
<p>th:replace</p>
</li>
<li>
<p>th:include</p>
</li>
</ul>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--公共页面--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:fragment</span>=<span class="hljs-string">"copy"</span>&gt;</span><br>    <span class="hljs-symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery<br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>  ...<br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:insert</span>=<span class="hljs-string">"footer :: copy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:replace</span>=<span class="hljs-string">"footer :: copy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:include</span>=<span class="hljs-string">"footer :: copy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <br>    <span class="hljs-comment">&lt;!--效果如下--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span><br>            <span class="hljs-symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span><br>        <span class="hljs-symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <br>    <span class="hljs-comment">&lt;!--语法：两种都可--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:insert</span>=<span class="hljs-string">"~{footer :: copy}"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:insert</span>=<span class="hljs-string">"footer :: copy"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>测试使用：</strong></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:include</span>=<span class="hljs-string">"common :: commonheader"</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:replace</span>=<span class="hljs-string">"common :: #leftmenu"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:replace</span>=<span class="hljs-string">"common :: headermenu"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:replace</span>=<span class="hljs-string">"common :: #commonscript"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="数据渲染"><a class="header-anchor" href="#数据渲染">¶</a>数据渲染</h3>
<blockquote>
<p>遍历状态：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#keeping-iteration-status">https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#keeping-iteration-status</a></p>
<p>路径参数的获取：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#link-urls">https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#link-urls</a></p>
<p>当前标签生成序列：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#numbers">https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#numbers</a></p>
<p>带有参数的处理规则：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#link-urls">https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#link-urls</a></p>
</blockquote>
<p><code>th:each="user,stats:${users}"</code>：遍历状态，user变量后面用逗号隔开的变量stats就是Thymeleaf的状态变量</p>
<ul>
<li>stats.count：计数，获取当前是第几个</li>
<li>stats.current：获取当前对象</li>
</ul>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"gradeX"</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">"user,stats:${users}"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${stats.count}"</span>&gt;</span>Trident<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${user.userName}"</span>&gt;</span>Internet<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> &gt;</span>[[${user.password}]]<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><code>${#numbers.sequence(1,page.pages)}</code>：Thymeleaf的工具类用来生成一个序列，可以将当前标签按照规则重复生成！</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--/user/delete/id?pn=xx--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@{/user/delete/{id}(id=${user.id},pn=${page.current})}"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">页码为当前页码时，设为激活状态</span><br><span class="hljs-comment">${#numbers.sequence(1,page.pages)}：Thymeleaf的工具类用来生成一个序列</span><br><span class="hljs-comment">--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">th:class</span>=<span class="hljs-string">"${num==page.current?'active':''}"</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">"num:${#numbers.sequence(1,page.pages)}"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@{/dynamic_table(pn=${num})}"</span>&gt;</span>[[${num}]]<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"next"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@{/dynamic_table(pn=${page.current+1})}"</span>&gt;</span>Next → <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h2 id="8、拦截器"><a class="header-anchor" href="#8、拦截器">¶</a>8、拦截器</h2>
<h3 id="HandlerInterceptor-接口"><a class="header-anchor" href="#HandlerInterceptor-接口">¶</a>HandlerInterceptor 接口</h3>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 登录检查！</span><br><span class="hljs-comment"> * 1、配置好拦截器要拦截哪些请求</span><br><span class="hljs-comment"> * 2、把这些配置放在容器中</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ITNXD</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2021-10-08 11:19</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>{<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 目标方法执行之前执行！</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception </span>{<br><br>        log.info(<span class="hljs-string">"拦截的路径是{}"</span>, request.getRequestURI());<br><br>        HttpSession session = request.getSession();<br>        Object loginUser = session.getAttribute(<span class="hljs-string">"loginUser"</span>);<br>        <span class="hljs-keyword">if</span>(loginUser != <span class="hljs-keyword">null</span>){<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        }<br>        <span class="hljs-comment">// 未登录，跳转到登录页面！</span><br>        request.setAttribute(<span class="hljs-string">"msg"</span>, <span class="hljs-string">"请先登录！"</span>);<br>        request.getRequestDispatcher(<span class="hljs-string">"/"</span>).forward(request, response);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>    }<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 目标方法执行之后执行！</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> modelAndView</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception </span>{<br>        HandlerInterceptor.<span class="hljs-keyword">super</span>.postHandle(request, response, handler, modelAndView);<br>    }<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 目标方法执行完成后执行！</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ex</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception </span>{<br>        HandlerInterceptor.<span class="hljs-keyword">super</span>.afterCompletion(request, response, handler, ex);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="配置拦截器"><a class="header-anchor" href="#配置拦截器">¶</a>配置拦截器</h3>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 1、编写一个拦截器实现HandlerInterceptor接口</span><br><span class="hljs-comment"> * 2、拦截器注册到容器中（实现WebMvcConfigurer的addInterceptors）</span><br><span class="hljs-comment"> * 3、指定拦截规则【如果是拦截所有，静态资源也会被拦截】</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@EnableWebMvc</span>：可以全面接管SpringMVC，所有规则全部自己重新配置，实现定制和扩展功能</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>{<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> </span>{<br>        registry.addInterceptor(<span class="hljs-keyword">new</span> LoginInterceptor())<br>                <span class="hljs-comment">// 拦截路径（动静态全部都拦了）</span><br>                .addPathPatterns(<span class="hljs-string">"/**"</span>)<br>                <span class="hljs-comment">// 放行路径：css,js,font,images</span><br>                .excludePathPatterns(<span class="hljs-string">"/"</span>, <span class="hljs-string">"/login"</span>, <span class="hljs-string">"/css/**"</span>, <span class="hljs-string">"/js/**"</span>,<br>                        <span class="hljs-string">"/fonts/**"</span>, <span class="hljs-string">"/images/**"</span>, <span class="hljs-string">"/aa/**"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="拦截器原理"><a class="header-anchor" href="#拦截器原理">¶</a>拦截器原理</h3>
<ul>
<li>根据当前请求，找到<strong>HandlerExecutionChain</strong>【可以处理请求的handler以及handler的所有 拦截器】</li>
<li>先来<strong>顺序执行</strong>所有拦截器的 preHandle方法
<ul>
<li>如果当前拦截器prehandler返回为true。则执行下一个拦截器的preHandle</li>
<li>如果当前拦截器返回为false。直接<strong>倒序执行</strong>所有已经执行了的拦截器的  afterCompletion；</li>
</ul>
</li>
<li><strong>如果任何一个拦截器返回false。直接跳出不执行目标方法</strong></li>
<li><strong>所有拦截器都返回True。执行目标方法</strong></li>
<li><strong>倒序</strong>执行所有拦截器的postHandle方法。</li>
<li><strong>前面的步骤有任何异常都会直接倒序触发 afterCompletion</strong></li>
<li>页面成功渲染完成以后，也会<strong>倒序</strong>触发 afterCompletion</li>
</ul>
<p><strong>如下图：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/12/ce9ebec135c8a426e53e93a5c291bdb1.png" alt=""></p>
<h2 id="9、文件上传"><a class="header-anchor" href="#9、文件上传">¶</a>9、文件上传</h2>
<h3 id="页面表单"><a class="header-anchor" href="#页面表单">¶</a>页面表单</h3>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--文件上传必须为post--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"form"</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">"@{/upload}"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">"multipart/form-data"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"exampleInputEmail1"</span>&gt;</span>邮箱<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"exampleInputEmail1"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Enter email"</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"exampleInputPassword1"</span>&gt;</span>名字<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"exampleInputPassword1"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"username"</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--单文件上传--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"exampleInputFile"</span>&gt;</span>头像<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"headerImg"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"exampleInputFile"</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--多文件上传--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"exampleInputFile"</span>&gt;</span>生活照<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"photos"</span> <span class="hljs-attr">multiple</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"checkbox"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span>&gt;</span> Check me out<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="文件上传代码"><a class="header-anchor" href="#文件上传代码">¶</a>文件上传代码</h3>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FormController</span> </span>{<br><br>    <span class="hljs-meta">@GetMapping("/form_layouts")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">form_layouts</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"form/form_layouts"</span>;<br>    }<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * MultipartFile 自动封装上传过来的文件</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> email</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> username</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> headerImg</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> photos</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping("/upload")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">upload</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam("email")</span> String email,</span></span><br><span class="hljs-function"><span class="hljs-params">                         <span class="hljs-meta">@RequestParam("username")</span> String username,</span></span><br><span class="hljs-function"><span class="hljs-params">                         // <span class="hljs-meta">@RequestPart</span>获取表单文件</span></span><br><span class="hljs-function"><span class="hljs-params">                         <span class="hljs-meta">@RequestPart("headerImg")</span> MultipartFile headerImg,</span></span><br><span class="hljs-function"><span class="hljs-params">                         <span class="hljs-meta">@RequestPart("photos")</span> MultipartFile[] photos)</span> <span class="hljs-keyword">throws</span> IOException </span>{<br><br>        log.info(<span class="hljs-string">"上传的信息：email={}，username={}，headerImg={}，photos={}"</span>,<br>                email,username,headerImg.getSize(),photos.length);<br><br>        <span class="hljs-keyword">if</span>(!headerImg.isEmpty()){<br>            <span class="hljs-comment">//保存到文件服务器，OSS服务器</span><br>            String originalFilename = headerImg.getOriginalFilename();<br>            headerImg.transferTo(<span class="hljs-keyword">new</span> File(<span class="hljs-string">"C:\\Users\\15890\\Desktop\\"</span>+originalFilename));<br>        }<br><br>        <span class="hljs-keyword">if</span>(photos.length &gt; <span class="hljs-number">0</span>){<br>            <span class="hljs-keyword">for</span> (MultipartFile photo : photos) {<br>                <span class="hljs-keyword">if</span>(!photo.isEmpty()){<br>                    String originalFilename = photo.getOriginalFilename();<br>                    photo.transferTo(<span class="hljs-keyword">new</span> File(<span class="hljs-string">"C:\\Users\\15890\\Desktop\\"</span>+originalFilename));<br>                }<br>            }<br>        }<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"index"</span>;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="文件上传配置"><a class="header-anchor" href="#文件上传配置">¶</a>文件上传配置</h3>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-attr">multipart:</span><br>      <span class="hljs-attr">max-file-size:</span> <span class="hljs-string">10MB</span> <span class="hljs-comment"># 单文件大小</span><br>      <span class="hljs-attr">max-request-size:</span> <span class="hljs-string">100MB</span> <span class="hljs-comment"># 请求文件总大小</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="自动配置原理"><a class="header-anchor" href="#自动配置原理">¶</a>自动配置原理</h3>
<ul>
<li>文件上传自动配置类-<strong>MultipartAutoConfiguration</strong>-MultipartProperties
<ul>
<li>自动配置好了 StandardServletMultipartResolver   【<strong>文件上传解析器</strong>】</li>
<li><strong>原理步骤：</strong>
<ul>
<li>1、请求进来使用文件上传解析器判断（isMultipart）并封装（resolveMultipart，返回MultipartHttpServletRequest）文件上传请求</li>
<li><strong>2、参数解析器来解析请求中的文件内容封装成MultipartFile</strong></li>
<li>3、将request中文件信息封装为一个Map；<code>MultiValueMap&lt;String, MultipartFile&gt;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>FileCopyUtils。实现文件流的拷贝，底层就是该工具类实现的！</strong></p>
<h2 id="10、异常-错误-处理"><a class="header-anchor" href="#10、异常-错误-处理">¶</a>10、异常/错误 处理</h2>
<h3 id="默认规则"><a class="header-anchor" href="#默认规则">¶</a>默认规则</h3>
<ul>
<li>默认情况下，Spring Boot提供**/error**处理所有错误的映射</li>
<li>对于机器客户端，它将生成JSON响应，其中包含错误，HTTP状态和异常消息的详细信息。</li>
<li>对于浏览器客户端，响应一个“ whitelabel”错误视图，以HTML格式呈现相同的数据</li>
</ul>
<p><strong>机器客户端JSON响应：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/12/f66c672fb1c46bed938a9ea9d29e392d.png" alt=""></p>
<p><strong>浏览器的白页：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/12/a4acc09c2aaa69da2df2b3cc0053b0af.png" alt=""></p>
<ul>
<li>要完全替换默认行为，可以实现 ErrorController 并注册该类型的Bean定义，或添加ErrorAttributes类型的组件以使用现有机制但替换其内容。</li>
<li>error/下的4xx，5xx页面会被自动解析；</li>
</ul>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/12/fc1077950557e0d2d2f9d771ce65b9d8.png" alt=""></p>
<h3 id="异常处理自动配置原理"><a class="header-anchor" href="#异常处理自动配置原理">¶</a>异常处理自动配置原理</h3>
<ul>
<li><strong>ErrorMvcAutoConfiguration  自动配置异常处理规则</strong>
<ul>
<li>容器中的组件：类型：<strong>DefaultErrorAttributes</strong> -&gt; id：errorAttributes
<ul>
<li><code>public class DefaultErrorAttributes implements ErrorAttributes, HandlerExceptionResolver</code></li>
<li>DefaultErrorAttributes：<strong>定义错误页面中可以包含哪些数据</strong>。</li>
</ul>
</li>
<li>容器中的组件：类型：<strong>BasicErrorController</strong> --&gt; id：basicErrorController（<strong>json+白页 适配响应</strong>）
<ul>
<li>处理默认 <strong>/error</strong> 路径的请求；页面响应 <code>new ModelAndView("error", model)；</code></li>
<li>容器中有组件 View-&gt;id 是error；（<strong>响应默认错误页</strong>）</li>
</ul>
</li>
<li>容器中放组件 <strong>BeanNameViewResolver</strong>（<strong>视图解析器</strong>）；按照返回的视图名作为组件的id去容器中找View对象。
<ul>
<li>容器中的组件：类型：DefaultErrorViewResolver -&gt; id：conventionErrorViewResolver</li>
<li><strong>如果发生错误，会以HTTP的状态码 作为视图页地址（viewName），找到真正的页面</strong></li>
<li>error/404、5xx.html</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>如果想要返回页面；就会找error视图【<strong>StaticView</strong>】。(默认是一个白页)</p>
<p><strong>小总结：</strong></p>
<ul>
<li>如果想向错误页面保存数据（Request域）则修改DefaultErrorAttributes</li>
<li>如果想修改默认的错误页json或白页就去修改BasicErrorController</li>
<li>如果想修改错误页面的文件位置则去修改BeanNameViewResolver</li>
</ul>
<h3 id="异常处理步骤流程"><a class="header-anchor" href="#异常处理步骤流程">¶</a>异常处理步骤流程</h3>
<ul>
<li>1、执行目标方法，<strong>目标方法运行期间有任何异常都会被catch</strong>、而且标志当前请求结束；并且用 dispatchException 来封装</li>
<li>2、<strong>进入视图解析流程（页面渲染）</strong> <code>processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException)</code></li>
<li>3、<code>mv = processHandlerException</code>，处理handler发生的异常，<strong>处理完成返回ModelAndView</strong>；
<ul>
<li>1、<strong>遍历所有的 handlerExceptionResolvers</strong>，看谁能处理当前异常【HandlerExceptionResolver处理器异常解析器】</li>
<li>2、系统默认的  异常解析器：
<ul>
<li>1、<strong>DefaultErrorAttributes先来处理异常。把异常信息保存到request域</strong>，并且返回null；</li>
<li>2、<strong>默认没有任何人能处理异常，则将异常抛出</strong>
<ul>
<li>1、如果没有任何人能处理最终底层就会发送 <strong>/error</strong> 请求。<strong>会被底层的BasicErrorController处理</strong></li>
<li>2、解析错误视图；遍历所有的  <strong>ErrorViewResolver</strong>  看谁能解析。</li>
<li>3、默认的 <strong>DefaultErrorViewResolver</strong> ,<strong>作用是把响应状态码作为错误页的地址</strong>，error/500.html</li>
<li>4、<strong>模板引擎最终响应</strong>这个页面 error/500.html</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="发生错误放到request域的数据"><a class="header-anchor" href="#发生错误放到request域的数据">¶</a>发生错误放到request域的数据</h3>
<ul>
<li>status</li>
<li>error</li>
<li>trace</li>
<li>message</li>
<li>path</li>
</ul>
<p><strong>postman返回的json数据：</strong></p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json">{<br>    <span class="hljs-attr">"timestamp"</span>: <span class="hljs-string">"2021-10-08T11:44:47.853+00:00"</span>,<br>    <span class="hljs-attr">"status"</span>: <span class="hljs-number">500</span>,<br>    <span class="hljs-attr">"error"</span>: <span class="hljs-string">"Internal Server Error"</span>,<br>    <span class="hljs-attr">"trace"</span>: <span class="hljs-string">"java.lang.ArithmeticException: / by zer"</span>,<br>    <span class="hljs-attr">"message"</span>: <span class="hljs-string">"/ by zero"</span>,<br>    <span class="hljs-attr">"path"</span>: <span class="hljs-string">"/basic_table"</span><br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>错误页面获取数据：</strong></p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"error-wrapper text-center"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"images/500-error.png"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>OOOPS!!!<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${message}"</span>&gt;</span>Something went wrong.<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${error}"</span>&gt;</span>Something went wrong.<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nrml-txt"</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${trace}"</span>&gt;</span>Why not try refreshing you page? Or you can <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>contact our support<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> if the problem persists.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"back-btn"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"index.html"</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${status}"</span>&gt;</span> Back To Home<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="定制错误处理逻辑"><a class="header-anchor" href="#定制错误处理逻辑">¶</a>定制错误处理逻辑</h3>
<h4 id="自定义错误页"><a class="header-anchor" href="#自定义错误页">¶</a>自定义错误页</h4>
<p>error/404.html   error/5xx.html；有精确的错误状态码页面就匹配精确，没有就找 4xx.html；如果都没有就触发白页！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 不带请求参数a，将会返回400错误码！400---一般是请求参数错误！</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> a</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(value = {"/basic_table", "/basic_table.html"})</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">basicTable</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam("a")</span> <span class="hljs-keyword">int</span> a)</span></span>{<br><br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">10</span> /<span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">"table/basic_table"</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>
<h4 id="ControllerAdvice-ExceptionHandler"><a class="header-anchor" href="#ControllerAdvice-ExceptionHandler">¶</a>@ControllerAdvice+@ExceptionHandler</h4>
<blockquote>
<p>处理全局异常；底层是 ExceptionHandlerExceptionResolver 支持的！</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 处理全局 controller 异常！</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ITNXD</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2021-10-08 21:07</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@ControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlobalExceptionHandler</span> </span>{<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 用来处理数学异常！</span><br><span class="hljs-comment">     * 数学异常、空指针异常、请求参数错误异常！</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@ExceptionHandler({ArithmeticException.class, NullPointerException.class,</span><br><span class="hljs-meta">            MissingServletRequestParameterException.class})</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">handleArithException</span><span class="hljs-params">(Exception e)</span></span>{<br>        log.error(<span class="hljs-string">"异常是: {}"</span>, e);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"login"</span>; <span class="hljs-comment">// 返回一个视图地址 ModelAndView;</span><br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h4 id="ResponseStatus-自定义异常"><a class="header-anchor" href="#ResponseStatus-自定义异常">¶</a>@ResponseStatus+自定义异常</h4>
<blockquote>
<p>底层是 ResponseStatusExceptionResolver ，把responsestatus注解的信息组装成ModelAndView返回，底层调用 <code>response.sendError(statusCode, resolvedReason)</code></p>
<p>相当于调用tomcat发送的 /error !</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 自定义异常：用户太多异常！</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ITNXD</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2021-10-08 21:28</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// 表示该异常会返回一个状态码信息！</span><br><span class="hljs-meta">@ResponseStatus(value = HttpStatus.FORBIDDEN, reason = "用户数量太多！")</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserTooManyException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span></span>{<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserTooManyException</span><span class="hljs-params">()</span></span>{<br><br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserTooManyException</span><span class="hljs-params">(String msg)</span></span>{<br>        <span class="hljs-keyword">super</span>(msg);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>测试：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(value = {"/dynamic_table", "/dynamic_table.html"})</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">dynamicTable</span><span class="hljs-params">(Model model)</span></span>{<br>    List&lt;User&gt; users = Arrays.asList(<span class="hljs-keyword">new</span> User(<span class="hljs-string">"牛逼"</span>, <span class="hljs-string">"123456"</span>),<br>                                     <span class="hljs-keyword">new</span> User(<span class="hljs-string">"张三"</span>, <span class="hljs-string">"89032"</span>),<br>                                     <span class="hljs-keyword">new</span> User(<span class="hljs-string">"李四"</span>, <span class="hljs-string">"93993"</span>));<br>    model.addAttribute(<span class="hljs-string">"users"</span>, users);<br><br><br>    <span class="hljs-comment">// 模拟异常</span><br>    <span class="hljs-keyword">if</span>(users.size() &gt; <span class="hljs-number">2</span>){<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UserTooManyException(<span class="hljs-string">"用户太多了！"</span>);<br>    }<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">"table/dynamic_table1"</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>
<h4 id="Spring底层的异常"><a class="header-anchor" href="#Spring底层的异常">¶</a>Spring底层的异常</h4>
<blockquote>
<p>如参数类型转换异常；DefaultHandlerExceptionResolver 处理框架底层的异常。</p>
<p>没人处理tomcat发送 /error请求，SpringBoot会处理，要是SpringBoot也不处理则会返回tomcat的默认错误蓝白页！</p>
</blockquote>
<h4 id="自定义异常解析器"><a class="header-anchor" href="#自定义异常解析器">¶</a>自定义异常解析器</h4>
<blockquote>
<p>自定义实现 HandlerExceptionResolver 处理异常；可以作为默认的全局异常处理规则!</p>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 实现异常解析的底层接口 HandlerExceptionResolver，自定义异常解析器！</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ITNXD</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2021-10-08 21:46</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">// 自定义异常解析器权重最低，防止已有的解析器生效，我们可以指定他为最高优先级！</span><br><span class="hljs-meta">@Order(value = Ordered.HIGHEST_PRECEDENCE)</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomerHandlerExceptionResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerExceptionResolver</span> </span>{<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">resolveException</span><span class="hljs-params">(HttpServletRequest request,</span></span><br><span class="hljs-function"><span class="hljs-params">                                         HttpServletResponse response,</span></span><br><span class="hljs-function"><span class="hljs-params">                                         Object handler, Exception ex)</span> </span>{<br>        <span class="hljs-keyword">try</span> {<br>            response.sendError(<span class="hljs-number">520</span>, <span class="hljs-string">"我喜欢的错误！"</span>);<br>        } <span class="hljs-keyword">catch</span> (IOException e) {<br>            e.printStackTrace();<br>        }<br><br>        <span class="hljs-comment">// 这里可以不返回ModelAndView使得底层源码的for循环可以继续适配其他ExceptionResolver</span><br>        <span class="hljs-comment">// 就相当于可以在解析异常处理之前执行一些方法！类似 preHandler 方法！</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView();<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="11、Web原生组件注入"><a class="header-anchor" href="#11、Web原生组件注入">¶</a>11、Web原生组件注入</h2>
<h3 id="使用Servlet-API"><a class="header-anchor" href="#使用Servlet-API">¶</a>使用Servlet API</h3>
<blockquote>
<p>SpringBoot为了兼容旧系统的Servlet！</p>
</blockquote>
<ul>
<li>
<p>@ServletComponentScan(basePackages = <strong>“com.itnxd.admin”</strong>) ：指定原生Servlet组件都放在那里</p>
</li>
<li>
<p>@WebServlet(urlPatterns = <strong>“/my”</strong>)：效果：直接响应，<strong>没有经过Spring的拦截器</strong></p>
</li>
<li>
<p>@WebFilter(urlPatterns={<strong>“/css/*”</strong>,<strong>“/images/*”</strong>})</p>
</li>
<li>
<p>@WebListener</p>
</li>
</ul>
<p><strong>主应用开启扫描Servlet包：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 指定扫描包 扫描原生Servlet</span><br><span class="hljs-meta">@ServletComponentScan(basePackages = "com.itnxd.helloworld4")</span><br><span class="hljs-comment">// 快捷复制 ctrl + alt + shift + c 复制包路径！</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorld4Application</span> </span>{<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<br>        SpringApplication.run(HelloWorld4Application.class, args);<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>WebServlet：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@WebServlet(urlPatterns = "/my")</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>{<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>{<br>        resp.getWriter().write(<span class="hljs-string">"666"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>WebFilter：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-comment">// /**是spring里的，原生的是/*</span><br><span class="hljs-meta">@WebFilter(urlPatterns = {"/my", "/css/*", "/images/*"})</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span> </span>{<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException </span>{<br>        log.info(<span class="hljs-string">"filter初始化！"</span>);<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest servletRequest,</span></span><br><span class="hljs-function"><span class="hljs-params">                         ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{<br>        log.info(<span class="hljs-string">"filter工作！"</span>);<br>        <span class="hljs-comment">// 放行</span><br>        filterChain.doFilter(servletRequest, servletResponse);<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>{<br>        log.info(<span class="hljs-string">"filter销毁！"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>WebListener：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@WebListener</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServletContextListener</span> </span>{<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextInitialized</span><span class="hljs-params">(ServletContextEvent sce)</span> </span>{<br>        log.info(<span class="hljs-string">"Listener监听到项目初始化完成！"</span>);<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextDestroyed</span><span class="hljs-params">(ServletContextEvent sce)</span> </span>{<br>        log.info(<span class="hljs-string">"Listener监听到项目销毁！"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="使用RegistrationBean"><a class="header-anchor" href="#使用RegistrationBean">¶</a>使用RegistrationBean</h3>
<ul>
<li>ServletRegistrationBean</li>
<li>FilterRegistrationBean</li>
<li>ServletListenerRegistrationBean</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 默认也是true</span><br><span class="hljs-meta">@Configuration(proxyBeanMethods = true)</span> <span class="hljs-comment">// 保证是单示例的，防止每次拦截都会向容器中添加一些东西</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRegistConfig</span> </span>{<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title">myServlet</span><span class="hljs-params">()</span></span>{<br>        MyServlet myServlet = <span class="hljs-keyword">new</span> MyServlet();<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ServletRegistrationBean(myServlet, <span class="hljs-string">"/my"</span>, <span class="hljs-string">"/my2"</span>);<br>    }<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title">myFilter</span><span class="hljs-params">()</span></span>{<br>        MyFilter myFilter = <span class="hljs-keyword">new</span> MyFilter();<br>        <span class="hljs-comment">// myServlet()拦截啥filter就拦啥！</span><br>        <span class="hljs-comment">// return new FilterRegistrationBean(myFilter, myServlet());</span><br><br>        <span class="hljs-comment">// 或者</span><br>        FilterRegistrationBean filterRegistrationBean = <span class="hljs-keyword">new</span> FilterRegistrationBean(myFilter);<br>        filterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="hljs-string">"/my"</span>, <span class="hljs-string">"/my2"</span>, <span class="hljs-string">"/css/*"</span>));<br>        <span class="hljs-keyword">return</span> filterRegistrationBean;<br>    }<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ServletListenerRegistrationBean <span class="hljs-title">myListener</span><span class="hljs-params">()</span></span>{<br>        MyListener myListener = <span class="hljs-keyword">new</span> MyListener();<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ServletListenerRegistrationBean(myListener);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="不经过spring拦截器？"><a class="header-anchor" href="#不经过spring拦截器？">¶</a>不经过spring拦截器？</h3>
<p><strong>多个Servlet都能处理到同一层路径，精确优选原则！</strong></p>
<p><strong>DispatchServlet 如何注册进来：</strong></p>
<ul>
<li>
<p>容器中自动配置了  DispatcherServlet  属性绑定到 WebMvcProperties；对应的配置文件配置项是 <strong>spring.mvc。</strong></p>
</li>
<li>
<p>通过 <code>ServletRegistrationBean&lt;DispatcherServlet&gt;</code> 把 DispatcherServlet  配置进来。</p>
</li>
<li>
<p><strong>默认映射的是 / 路径。</strong></p>
</li>
</ul>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mvc:</span><br>    <span class="hljs-attr">servlet:</span><br>      <span class="hljs-attr">path:</span> <span class="hljs-string">/</span> <span class="hljs-comment"># DispatcherServlet默认映射的是/</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>原生Servlet默认使我们自己定义的，例如：<code>/my</code></strong></p>
<p><strong>因此：精确匹配的话，默认是到不了DispatcherServlet 的！</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/12/8075fe0af3c4cb62841802a36ea546cf.png" alt=""></p>
<h2 id="12、嵌入式Servlet容器"><a class="header-anchor" href="#12、嵌入式Servlet容器">¶</a>12、嵌入式Servlet容器</h2>
<h3 id="原理"><a class="header-anchor" href="#原理">¶</a>原理</h3>
<ul>
<li>SpringBoot 应用启动发现当前是Web应用。web场景包-导入tomcat</li>
<li>web应用会创建一个web版的ioc容器 <code>ServletWebServerApplicationContext </code></li>
<li>·ServletWebServerApplicationContext·  启动的时候寻找 <code>ServletWebServerFactory</code>（<strong>Servlet 的web服务器工厂，Servlet 的web服务器</strong>）</li>
<li>SpringBoot底层默认有很多的WebServer工厂；TomcatServletWebServerFactory, JettyServletWebServerFactory, UndertowServletWebServerFactory</li>
<li>底层直接会有一个自动配置类。<strong>ServletWebServerFactoryAutoConfiguration</strong></li>
<li>ServletWebServerFactoryAutoConfiguration 导入了 <strong>ServletWebServerFactoryConfiguration</strong>（<strong>配置类</strong>）</li>
<li>ServletWebServerFactoryConfiguration 配置类动态判断系统中到底导入了那个Web服务器的包。（<strong>默认是web-starter导入tomcat包</strong>），容器中就有 <strong>TomcatServletWebServerFactory</strong></li>
<li>TomcatServletWebServerFactory 创建出 Tomcat 服务器并启动；TomcatWebServer 的构造器拥有初始化方法 <strong>initialize—this.tomcat.start();</strong></li>
<li>内嵌服务器，就是手动把启动服务器的代码调用（tomcat核心jar包存在）</li>
</ul>
<h3 id="切换嵌入式Servlet容器"><a class="header-anchor" href="#切换嵌入式Servlet容器">¶</a>切换嵌入式Servlet容器</h3>
<ul>
<li>默认支持的webServer：Tomcat, Jetty, or Undertow</li>
<li>ServletWebServerApplicationContext 容器启动寻找ServletWebServerFactory 并引导创建服务器</li>
<li>切换服务器</li>
</ul>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/12/bbfae54edad820015245af09170a3df2.png" alt=""></p>
<p><strong>先手动排除默认的tomcat依赖，在手动添加其他服务器依赖：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="定制Servlet容器"><a class="header-anchor" href="#定制Servlet容器">¶</a>定制Servlet容器</h3>
<ul>
<li>1、实现  <code>WebServerFactoryCustomizer&lt;ConfigurableServletWebServerFactory&gt; </code>
<ul>
<li>把配置文件的值和 ServletWebServerFactory 进行绑定</li>
<li>修改配置文件 <strong><a target="_blank" rel="noopener external nofollow noreferrer" href="http://server.xxx">server.xxx</a></strong> (xxx表示服务器名)</li>
</ul>
</li>
<li>2、直接自定义 <strong>ConfigurableServletWebServerFactory</strong></li>
</ul>
<p>xxxxxCustomizer：<strong>定制化器</strong>，可以改变xxxx的默认规则！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomizationBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebServerFactoryCustomizer</span>&lt;<span class="hljs-title">ConfigurableServletWebServerFactory</span>&gt; </span>{<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">customize</span><span class="hljs-params">(ConfigurableServletWebServerFactory server)</span> </span>{<br>        server.setPort(<span class="hljs-number">9000</span>);<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="13、定制化原理"><a class="header-anchor" href="#13、定制化原理">¶</a>13、定制化原理</h2>
<h3 id="定制化的常见方式"><a class="header-anchor" href="#定制化的常见方式">¶</a>定制化的常见方式</h3>
<ul>
<li>修改配置文件；</li>
<li>xxxxxCustomizer，实现定制化器接口</li>
<li>编写自定义的配置类   xxxConfiguration + @Bean<strong>替换、增加容器中默认组件；视图解析器</strong></li>
<li>Web应用 编写一个配置类实现 <code>WebMvcConfigurer</code> 即可定制化web功能；+ @Bean给容器中再扩展一些组件</li>
<li><code>EnableWebMvc + WebMvcConfigurer  @Bean</code>  可以<strong>全面接管SpringMVC，所有规则全部自己重新配置； 实现定制和扩展功能</strong></li>
</ul>
<p>@EnableWebMvc开启手动定制，则springmvc底层实现好的组件将全部失效，只能自己自定义！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableWebMvc</span> <span class="hljs-comment">// 可以全面接管SpringMVC，所有规则全部自己重新配置，实现定制和扩展功能</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>{<br>  	<span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 定义资源行为！</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> registry</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> </span>{<br>        <span class="hljs-comment">// 访问/aa下的资源都去类路径下的static目录去匹配！</span><br>        registry.addResourceHandler(<span class="hljs-string">"/aa/**"</span>)<br>            .addResourceLocations(<span class="hljs-string">"classpath:/static"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="EnableWebMvc-原理"><a class="header-anchor" href="#EnableWebMvc-原理">¶</a>@EnableWebMvc 原理</h3>
<ul>
<li>1、WebMvcAutoConfiguration  默认的SpringMVC的自动配置功能类。静态资源、欢迎页…</li>
<li>2、一旦使用 <strong>@EnableWebMvc</strong> 。会 <code>@Import(DelegatingWebMvcConfiguration.class)</code></li>
<li><strong>3、DelegatingWebMvcConfiguration 的作用，只保证SpringMVC最基本的使用</strong>
<ul>
<li>把所有系统中的 WebMvcConfigurer 拿过来。所有功能的定制都是这些 WebMvcConfigurer  合起来一起生效</li>
<li><strong>自动配置了一些非常底层的组件</strong>。RequestMappingHandlerMapping、这些组件依赖的组件都是从容器中获取</li>
</ul>
</li>
<li>4、WebMvcAutoConfiguration 里面的配置要能生效 必须  <strong>@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</strong>
<ul>
<li><code>public class DelegatingWebMvcConfiguration extends WebMvcConfigurationSupport</code></li>
</ul>
</li>
<li>5、@EnableWebMvc  导致了 WebMvcAutoConfiguration  没有生效。</li>
</ul>
<h3 id="原理分析套路"><a class="header-anchor" href="#原理分析套路">¶</a>原理分析套路</h3>
<ul>
<li>
<p><strong>导入场景starter</strong></p>
</li>
<li>
<p>xxxxAutoConfiguration</p>
</li>
<li>
<p>导入xxx组件</p>
</li>
<li>
<p>绑定xxxProperties</p>
</li>
<li>
<p><strong>绑定配置文件项</strong></p>
</li>
</ul>
<h1 id="七、数据访问"><a class="header-anchor" href="#七、数据访问">¶</a>七、数据访问</h1>
<h2 id="1、整合JDBC"><a class="header-anchor" href="#1、整合JDBC">¶</a>1、整合JDBC</h2>
<h3 id="导入JDBC场景"><a class="header-anchor" href="#导入JDBC场景">¶</a>导入JDBC场景</h3>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>自动导入的东西：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/13/dc3347c97dc569dae877dc73f3a707ac.png" alt=""></p>
<h3 id="导入数据库驱动"><a class="header-anchor" href="#导入数据库驱动">¶</a>导入数据库驱动</h3>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--版本仲裁或者自己指定！</span><br><span class="hljs-comment">		想要修改版本</span><br><span class="hljs-comment">            1、直接依赖引入具体版本（maven的就近依赖原则）</span><br><span class="hljs-comment">            2、重新声明版本（maven的属性的就近优先原则）</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-comment">&lt;!-- &lt;mysql.verson&gt;8.0.26&lt;/mysql.verson&gt;--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--mysql驱动--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="分析自动配置"><a class="header-anchor" href="#分析自动配置">¶</a>分析自动配置</h3>
<ul>
<li><strong>DataSourceAutoConfiguration</strong> ： 数据源的自动配置
<ul>
<li>修改数据源相关的配置：<strong>spring.datasource</strong></li>
<li><strong>数据库连接池的配置，是自己容器中没有DataSource才自动配置的</strong></li>
<li>底层配置好的连接池是：<strong>HikariDataSource</strong></li>
</ul>
</li>
<li>DataSourceTransactionManagerAutoConfiguration： <strong>事务管理器</strong>的自动配置</li>
<li>JdbcTemplateAutoConfiguration： <strong>JdbcTemplate</strong>的自动配置，可以来对数据库进行crud
<ul>
<li>可以修改这个配置项 @ConfigurationProperties(prefix = “<strong>spring.jdbc</strong>”) 来修改JdbcTemplate</li>
</ul>
</li>
<li>JndiDataSourceAutoConfiguration： <strong>jndi</strong>的自动配置</li>
<li>XADataSourceAutoConfiguration： <strong>分布式事务相关</strong>的</li>
</ul>
<h3 id="修改配置项"><a class="header-anchor" href="#修改配置项">¶</a>修改配置项</h3>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/book</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">xxxxx</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>  <span class="hljs-attr">jdbc:</span><br>    <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">query-timeout:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># 查询时间限制（单位秒）</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="测试"><a class="header-anchor" href="#测试">¶</a>测试</h3>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorld4ApplicationTests</span> </span>{<br><br>    <span class="hljs-meta">@Autowired</span><br>    JdbcTemplate jdbcTemplate;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">contextLoads</span><span class="hljs-params">()</span> </span>{<br><br>        Long num = jdbcTemplate.queryForObject(<span class="hljs-string">"select count(*) from t_book"</span>, Long.class);<br>        System.out.println(num);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="2、整合Druid"><a class="header-anchor" href="#2、整合Druid">¶</a>2、整合Druid</h2>
<blockquote>
<p>druid官方github地址：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/alibaba/druid">https://github.com/alibaba/druid</a></p>
</blockquote>
<p><strong>整合第三方技术的两种方式：</strong></p>
<ul>
<li>自定义</li>
<li>找starter</li>
</ul>
<h3 id="自定义方式"><a class="header-anchor" href="#自定义方式">¶</a>自定义方式</h3>
<p><strong>导入依赖：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--第三方德鲁伊数据源--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>配置数据源：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Deprecated</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDataSourceConfig</span> </span>{<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 默认自动配置判断没有数据源才会使用自定义数据源！</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-comment">// 配置直接去yml配置文件找对应前缀开头的即可（因为属性一一对应）</span><br>    <span class="hljs-meta">@ConfigurationProperties("spring.datasource")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource <span class="hljs-title">dataSource</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>{<br>        DruidDataSource druidDataSource = <span class="hljs-keyword">new</span> DruidDataSource();<br>        <span class="hljs-keyword">return</span>  druidDataSource;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>指定配置文件前缀可直接在配置文件中找：</strong></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/book</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">xxxxx</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>测试：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorld4ApplicationTests</span> </span>{<br><br>    <span class="hljs-meta">@Autowired</span><br>    JdbcTemplate jdbcTemplate;<br>    <span class="hljs-meta">@Autowired</span><br>    DataSource dataSource;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">contextLoads</span><span class="hljs-params">()</span> </span>{<br><br>        Long num = jdbcTemplate.queryForObject(<span class="hljs-string">"select count(*) from t_book"</span>, Long.class);<br>        System.out.println(num);<br><br>        log.info(<span class="hljs-string">"数据源类型是：{}"</span>, dataSource.getClass());<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h4 id="StatViewServlet"><a class="header-anchor" href="#StatViewServlet">¶</a>StatViewServlet</h4>
<p><strong>StatViewServlet的用途包括：</strong></p>
<ul>
<li>提供监控信息展示的html页面</li>
<li>提供监控信息的JSON API</li>
</ul>
<p><strong>旧版的xml配置：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>DruidStatView<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.alibaba.druid.support.http.StatViewServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>DruidStatView<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/druid/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>SpringBoot配置：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Deprecated</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDataSourceConfig</span> </span>{<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 配置druid的监控页功能！</span><br><span class="hljs-comment">     * https://github.com/alibaba/druid/wiki/%E9%85%8D%E7%BD%AE_StatViewServlet%E9%85%8D%E7%BD%AE</span><br><span class="hljs-comment">     * https://github.com/alibaba/druid/wiki/Druid%E8%BF%9E%E6%8E%A5%E6%B1%A0%E4%BB%8B%E7%BB%8D#37-%E5%8C%BA%E9%97%B4%E5%88%86%E5%B8%83</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     *  Druid使用，访问密码设置：</span><br><span class="hljs-comment">     * https://github.com/alibaba/druid/wiki/%E9%85%8D%E7%BD%AE_StatViewServlet%E9%85%8D%E7%BD%AE#12-%E9%85%8D%E7%BD%AE%E7%9B%91%E6%8E%A7%E9%A1%B5%E9%9D%A2%E8%AE%BF%E9%97%AE%E5%AF%86%E7%A0%81</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title">statViewServlet</span><span class="hljs-params">()</span></span>{<br>        StatViewServlet statViewServlet = <span class="hljs-keyword">new</span> StatViewServlet();<br>        ServletRegistrationBean&lt;StatViewServlet&gt; servletRegistrationBean =<br>                <span class="hljs-keyword">new</span> ServletRegistrationBean&lt;&gt;(statViewServlet, <span class="hljs-string">"/druid/*"</span>);<br><br><br>        servletRegistrationBean.addInitParameter(<span class="hljs-string">"loginUsername"</span>, <span class="hljs-string">"admin"</span>);<br>        servletRegistrationBean.addInitParameter(<span class="hljs-string">"loginPassword"</span>, <span class="hljs-string">"admin"</span>);<br><br><br>        <span class="hljs-keyword">return</span> servletRegistrationBean;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>开启 StatFilter和wallfilter：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Deprecated</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDataSourceConfig</span> </span>{<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 默认自动配置判断没有数据源才会使用自定义数据源！</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * StatFilter开启：</span><br><span class="hljs-comment">     * https://github.com/alibaba/druid/wiki/%E9%85%8D%E7%BD%AE_StatFilter</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * 防火墙wall开启:</span><br><span class="hljs-comment">     * https://github.com/alibaba/druid/wiki/%E9%85%8D%E7%BD%AE-wallfilter</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConfigurationProperties("spring.datasource")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource <span class="hljs-title">dataSource</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>{<br>        DruidDataSource druidDataSource = <span class="hljs-keyword">new</span> DruidDataSource();<br><br>        <span class="hljs-comment">// 监控统计用的filter:stat和防火墙用的 wall</span><br>        druidDataSource.setFilters(<span class="hljs-string">"stat, wall"</span>);<br>        <span class="hljs-keyword">return</span>  druidDataSource;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>或直接在配置文件里写：</strong></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/book</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">n158903258</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-comment"># type: com.zaxxer.hikari.HikariDataSource</span><br>    <span class="hljs-comment"># 这里的是druid里属性，不会有提示</span><br>	<span class="hljs-attr">filters:</span> <span class="hljs-string">stat,wall</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>访问地址：</strong> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:8080/druid">http://localhost:8080/druid</a></p>
<h4 id="StatFilter"><a class="header-anchor" href="#StatFilter">¶</a>StatFilter</h4>
<p>用于统计监控信息；如SQL监控、URI监控！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Deprecated</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDataSourceConfig</span> </span>{<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 配置webStatFilter webUrl监控！</span><br><span class="hljs-comment">     * https://github.com/alibaba/druid/wiki/%E9%85%8D%E7%BD%AE_%E9%85%8D%E7%BD%AEWebStatFilter</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title">webStatFilter</span><span class="hljs-params">()</span></span>{<br>        WebStatFilter webStatFilter = <span class="hljs-keyword">new</span> WebStatFilter();<br><br>        FilterRegistrationBean&lt;WebStatFilter&gt; filterRegistrationBean =<br>                <span class="hljs-keyword">new</span> FilterRegistrationBean(webStatFilter, statViewServlet());<br>        filterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="hljs-string">"/*"</span>));<br>        <span class="hljs-comment">// 添加初始化参数！</span><br>        filterRegistrationBean.addInitParameter(<span class="hljs-string">"exclusions"</span>,<br>                <span class="hljs-string">"*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*"</span>);<br>        <span class="hljs-keyword">return</span> filterRegistrationBean;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="Starter方式"><a class="header-anchor" href="#Starter方式">¶</a>Starter方式</h3>
<p><strong>引入依赖：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--通过starter引入数据源--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="分析自动配置-2"><a class="header-anchor" href="#分析自动配置-2">¶</a>分析自动配置</h4>
<ul>
<li>扩展配置项 <strong>spring.datasource.druid</strong></li>
<li>导入了一些组件：
<ul>
<li>DruidSpringAopConfiguration.<strong>class</strong>,   监控SpringBean的；配置项：<strong>spring.datasource.druid.aop-patterns</strong></li>
<li>DruidStatViewServletConfiguration.<strong>class</strong>, 监控页的配置：<strong>spring.datasource.druid.stat-view-servlet；默认开启</strong></li>
<li>DruidWebStatFilterConfiguration.<strong>class</strong>, web监控配置；<strong>spring.datasource.druid.web-stat-filter；默认开启</strong></li>
<li>DruidFilterConfiguration.<strong>class</strong>}) 所有Druid自己filter的配置</li>
</ul>
</li>
</ul>
<p><strong>DruidFilterConfiguration的组件：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String FILTER_STAT_PREFIX = <span class="hljs-string">"spring.datasource.druid.filter.stat"</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String FILTER_CONFIG_PREFIX = <span class="hljs-string">"spring.datasource.druid.filter.config"</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String FILTER_ENCODING_PREFIX = <span class="hljs-string">"spring.datasource.druid.filter.encoding"</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String FILTER_SLF4J_PREFIX = <span class="hljs-string">"spring.datasource.druid.filter.slf4j"</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String FILTER_LOG4J_PREFIX = <span class="hljs-string">"spring.datasource.druid.filter.log4j"</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String FILTER_LOG4J2_PREFIX = <span class="hljs-string">"spring.datasource.druid.filter.log4j2"</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String FILTER_COMMONS_LOG_PREFIX = <span class="hljs-string">"spring.datasource.druid.filter.commons-log"</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String FILTER_WALL_PREFIX = <span class="hljs-string">"spring.datasource.druid.filter.wall"</span>;<br></code></pre></td></tr></tbody></table></figure>
<p><strong>系统中所有filter：</strong></p>
<table>
<thead>
<tr>
<th>别名</th>
<th>Filter类名</th>
</tr>
</thead>
<tbody>
<tr>
<td>default</td>
<td>com.alibaba.druid.filter.stat.StatFilter</td>
</tr>
<tr>
<td>stat</td>
<td>com.alibaba.druid.filter.stat.StatFilter</td>
</tr>
<tr>
<td>mergeStat</td>
<td>com.alibaba.druid.filter.stat.MergeStatFilter</td>
</tr>
<tr>
<td>encoding</td>
<td>com.alibaba.druid.filter.encoding.EncodingConvertFilter</td>
</tr>
<tr>
<td>log4j</td>
<td>com.alibaba.druid.filter.logging.Log4jFilter</td>
</tr>
<tr>
<td>log4j2</td>
<td>com.alibaba.druid.filter.logging.Log4j2Filter</td>
</tr>
<tr>
<td>slf4j</td>
<td>com.alibaba.druid.filter.logging.Slf4jLogFilter</td>
</tr>
<tr>
<td>commonlogging</td>
<td>com.alibaba.druid.filter.logging.CommonsLogFilter</td>
</tr>
</tbody>
</table>
<h4 id="配置文件"><a class="header-anchor" href="#配置文件">¶</a>配置文件</h4>
<p>SpringBoot配置示例：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter">https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter</a></p>
<p>配置项列表：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/alibaba/druid/wiki/DruidDataSource%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8">https://github.com/alibaba/druid/wiki/DruidDataSource%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8</a></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/book</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">xxxx</span><br><br>    <span class="hljs-comment"># 引入stater后使用</span><br>    <span class="hljs-comment"># https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter</span><br>    <span class="hljs-attr">druid:</span><br>      <span class="hljs-comment">#      aop-patterns: com.itnxd.helloworld4.* #监控SpringBean</span><br>      <span class="hljs-attr">filters:</span> <span class="hljs-string">stat,wall</span>  <span class="hljs-comment"># 底层开启功能，stat（sql监控），wall（防火墙）</span><br>      <span class="hljs-attr">stat-view-servlet:</span> <span class="hljs-comment"># 配置监控页功能</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">login-password:</span> <span class="hljs-string">admin</span><br>        <span class="hljs-attr">login-username:</span> <span class="hljs-string">admin</span><br>        <span class="hljs-attr">reset-enable:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">web-stat-filter:</span>  <span class="hljs-comment"># 监控web</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">url-pattern:</span> <span class="hljs-string">/*</span><br>        <span class="hljs-attr">exclusions:</span> <span class="hljs-string">'*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*'</span><br><br>      <span class="hljs-comment"># https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE-filter</span><br>      <span class="hljs-attr">filter:</span> <span class="hljs-comment"># 对上面filters里面的组件的详细配置</span><br>        <span class="hljs-attr">stat:</span> <span class="hljs-comment"># 慢查询</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">slow-sql-millis:</span> <span class="hljs-number">1000</span><br>          <span class="hljs-attr">log-slow-sql:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">wall:</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">config:</span><br>            <span class="hljs-attr">update-allow:</span> <span class="hljs-literal">true</span><br>            <span class="hljs-attr">drop-table-allow:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></tbody></table></figure>
<h2 id="3、整合MyBatis"><a class="header-anchor" href="#3、整合MyBatis">¶</a>3、整合MyBatis</h2>
<blockquote>
<p>官方地址：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/mybatis">https://github.com/mybatis</a></p>
</blockquote>
<p><strong>starter：</strong></p>
<ul>
<li>SpringBoot官方的Starter：<code>spring-boot-starter-*</code></li>
<li>第三方的： <code>*-spring-boot-starter</code></li>
</ul>
<h3 id="导入依赖"><a class="header-anchor" href="#导入依赖">¶</a>导入依赖</h3>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--mybatis starter引入--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>自动导入的东西：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/13/2860a1714570f560ceb0cd8f9c52fbe9.png" alt=""></p>
<h3 id="配置模式"><a class="header-anchor" href="#配置模式">¶</a>配置模式</h3>
<ul>
<li>
<p>全局配置文件</p>
</li>
<li>
<p>SqlSessionFactory: 自动配置好了</p>
</li>
<li>
<p>SqlSession：自动配置了 <strong>SqlSessionTemplate 组合了SqlSession</strong></p>
</li>
<li>
<p>@Import(<strong>AutoConfiguredMapperScannerRegistrar</strong>.<strong>class</strong>）；</p>
</li>
<li>
<p>Mapper： 只要我们写的操作MyBatis的接口标注了 <strong>@Mapper 就会被自动扫描进来</strong></p>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableConfigurationProperties(MybatisProperties.class)</span> ： MyBatis配置项绑定类。<br><span class="hljs-meta">@AutoConfigureAfter({ DataSourceAutoConfiguration.class, MybatisLanguageDriverAutoConfiguration.class })</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MybatisAutoConfiguration</span></span>{}<br><br><span class="hljs-meta">@ConfigurationProperties(prefix = "mybatis")</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MybatisProperties</span></span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>配置文件：</strong></p>
<p>mybatis.configuration下面的所有，就是相当于改mybatis全局配置文件中的值！</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 可以不写全局；配置文件，所有全局配置文件的配置都放在configuration配置项中即可</span><br><span class="hljs-attr">mybatis:</span><br>  <span class="hljs-comment">#  config-location: classpath:mybatis/mybatis-config.xml  #全局配置文件位置</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mybatis/mapper/*.xml</span>  <span class="hljs-comment">#sql映射文件位置</span><br>  <span class="hljs-attr">configuration:</span> <span class="hljs-comment"># 该配置与全局配置不可同时存在！</span><br>    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 驼峰命名开启</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>测试：</strong></p>
<p><strong>AccountMapper.xml文件：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><br><span class="hljs-meta">        <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="hljs-meta">        <span class="hljs-meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.itnxd.helloworld4.mapper.AccountMapper"</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--public Account getAcct(Long id);--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getAcct"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.itnxd.helloworld4.bean.Account"</span>&gt;</span><br>        select * from account_tbl where id = #{id}<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>Mapper层、Service层、Controller层：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AccountMapper</span> </span>{<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Account <span class="hljs-title">getAcct</span><span class="hljs-params">(Long id)</span></span>;<br>}<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountService</span> </span>{<br><br>    <span class="hljs-meta">@Autowired</span><br>    AccountMapper accountMapper;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Account <span class="hljs-title">getAcctById</span><span class="hljs-params">(Long id)</span></span>{<br>        <span class="hljs-keyword">return</span> accountMapper.getAcct(id);<br>    }<br>}<br><br><br><span class="hljs-meta">@Autowired</span><br>AccountService accountService;<br><br><span class="hljs-comment">// http://localhost:8888/acct?id=1</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-meta">@GetMapping("/acct")</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Account <span class="hljs-title">getById</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam("id")</span> Long id)</span></span>{<br>    <span class="hljs-keyword">return</span> accountService.getAcctById(id);<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>小总结：</strong></p>
<ul>
<li>
<p>导入mybatis官方starter</p>
</li>
<li>
<p>编写mapper接口。标准@Mapper注解</p>
</li>
<li>
<p>编写sql映射文件并绑定mapper接口</p>
</li>
<li>
<p>在application.yaml中指定Mapper配置文件的位置，以及指定全局配置文件的信息 （建议；<strong>配置在mybatis.configuration</strong>）</p>
</li>
</ul>
<h3 id="注解配置混合模式"><a class="header-anchor" href="#注解配置混合模式">¶</a>注解配置混合模式</h3>
<ul>
<li>简单sql标注注解，复杂sql还是写xml映射文件！</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span> <span class="hljs-comment">// 每个接口写麻烦，在启动类上标注mapper扫描包即可！但建议直接使用Mapper!</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CityMapper</span> </span>{<br><br>    <span class="hljs-meta">@Select("select * from city where id=#{id}")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> City <span class="hljs-title">getById</span><span class="hljs-params">(Long id)</span></span>;<br><br>    <span class="hljs-meta">@Insert("insert into city(`name`,`state`,`country`) values(#{name}, #{state}, #{country})")</span><br>    <span class="hljs-comment">// 可以添加选项，获取主键值进行封装</span><br>    <span class="hljs-meta">@Options(useGeneratedKeys = true, keyProperty = "id")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(City city)</span></span>;<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>复杂写映射文件：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"insert"</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">"id"</span>&gt;</span><br>    insert into city(`name`,`state`,`country`) values(#{name}, #{state}, #{country})<br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>启动类标注@MapperScan指定mapper扫描，即可不用每个mapper上单独标注注解：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@MapperScan("com.itnxd.helloworld4.mapper")</span><br><span class="hljs-comment">// MyBatis建议直接在接口标注mapper！ MP建议直接使用MapperScan扫描！</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorld4Application</span> </span>{<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<br>        SpringApplication.run(HelloWorld4Application.class, args);<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>小总结：</strong></p>
<ul>
<li>
<p>引入mybatis-starter</p>
</li>
<li>
<p><strong>配置application.yaml中，指定mapper-location位置即可</strong></p>
</li>
<li>
<p>编写Mapper接口并标注@Mapper注解</p>
</li>
<li>
<p><strong>简单方法直接注解方式</strong></p>
</li>
<li>
<p><strong>复杂方法编写mapper.xml进行绑定映射</strong></p>
</li>
<li>
<p>启动类标注 <code>@MapperScan("com.itnxd.admin.mapper")</code> 简化，其他的接口就可以不用标注@Mapper注解，<strong>但不建议使用</strong></p>
</li>
</ul>
<h2 id="4、整合Mybatis-Plus"><a class="header-anchor" href="#4、整合Mybatis-Plus">¶</a>4、整合Mybatis-Plus</h2>
<h3 id="导入依赖-2"><a class="header-anchor" href="#导入依赖-2">¶</a>导入依赖</h3>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--mp引入 自动引入mybatis和jdbc，因此上面这两个可以注释掉--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="自动配置-2"><a class="header-anchor" href="#自动配置-2">¶</a>自动配置</h3>
<ul>
<li>
<p>MybatisPlusAutoConfiguration 配置类，MybatisPlusProperties 配置项绑定。**mybatis-plus：xxx **就是对mybatis-plus的定制</p>
</li>
<li>
<p><strong>SqlSessionFactory 自动配置好。底层是容器中默认的数据源</strong></p>
</li>
<li>
<p>mapperLocations 自动配置好的。有默认值。<code>classpath*:/mapper/**/*.xml</code> 任意包的类路径下的所有mapper文件夹下任意路径下的所有xml都是sql映射文件。  建议以后sql映射文件，放在 mapper下。</p>
</li>
<li>
<p><strong>容器中也自动配置好了</strong> <strong>SqlSessionTemplate</strong></p>
</li>
<li>
<p>@Mapper 标注的接口也会被自动扫描；<strong>建议直接 @MapperScan(“com.itnxd.admin.mapper”) 批量扫描</strong></p>
</li>
<li>
<p>只需要我们的Mapper继承 <strong>BaseMapper</strong> 就可以拥有crud能力</p>
</li>
</ul>
<h3 id="测试-2"><a class="header-anchor" href="#测试-2">¶</a>测试</h3>
<p><strong>前提：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UsersMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseMapper</span>&lt;<span class="hljs-title">Users</span>&gt; </span>{<br>}<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UsersService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">IService</span>&lt;<span class="hljs-title">Users</span>&gt; </span>{<br><br>}<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * implements UsersService：为MP的顶级Service! 有许多要重写的方法！</span><br><span class="hljs-comment"> * extends ServiceImpl&lt;UsersMapper, Users&gt;：MP对重写方法的实现！</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ITNXD</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2021-10-09 21:17</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UsersServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceImpl</span>&lt;<span class="hljs-title">UsersMapper</span>, <span class="hljs-title">Users</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">UsersService</span> </span>{<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>测试：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br>UsersMapper usersMapper; <span class="hljs-comment">// 波浪线不用管，启动后容器就有了</span><br><br><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testUserMapper</span><span class="hljs-params">()</span></span>{<br>    Users user = usersMapper.selectById(<span class="hljs-number">1</span>);<br>    log.info(<span class="hljs-string">"用户信息：{}"</span>, user);<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="分页测试"><a class="header-anchor" href="#分页测试">¶</a>分页测试</h3>
<p><strong>向request域保存page对象：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(value = {"/dynamic_table", "/dynamic_table.html"})</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">dynamicTable</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(value = "pn", defaultValue = "1")</span> Integer pn,</span></span><br><span class="hljs-function"><span class="hljs-params">                              Model model)</span></span>{<br><br>       <span class="hljs-comment">// 当前页数 每页数量</span><br>       Page&lt;Users&gt; usersPage = <span class="hljs-keyword">new</span> Page&lt;&gt;(pn, <span class="hljs-number">2</span>);<br>       Page&lt;Users&gt; page = usersService.page(usersPage, <span class="hljs-keyword">null</span>);<br><br>       <span class="hljs-comment">// 需要结合分页插件使用！</span><br>       model.addAttribute(<span class="hljs-string">"page"</span>, page);<br><br>       <span class="hljs-comment">/**</span><br><span class="hljs-comment">        * Thymeleaf生成一个序列，用来展示分页！</span><br><span class="hljs-comment">        *  Create a sequence (array) of integer numbers going</span><br><span class="hljs-comment">        *  from x to y</span><br><span class="hljs-comment">           ${#numbers.sequence(from,to)}</span><br><span class="hljs-comment">           ${#numbers.sequence(from,to,step)}</span><br><span class="hljs-comment">        */</span><br><br>       <span class="hljs-keyword">return</span> <span class="hljs-string">"table/dynamic_table1"</span>;<br>   }<br></code></pre></td></tr></tbody></table></figure>
<p><strong>开启MP分页插件使分页生效：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBatisConfig</span> </span>{<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title">mybatisPlusInterceptor</span><span class="hljs-params">()</span></span>{<br><br>        MybatisPlusInterceptor interceptor = <span class="hljs-keyword">new</span> MybatisPlusInterceptor();<br><br>        <span class="hljs-comment">// 添加分页插件！</span><br>        PaginationInnerInterceptor paginationInnerInterceptor = <span class="hljs-keyword">new</span> PaginationInnerInterceptor();<br>        <span class="hljs-comment">// 最后一页以后跳回首页</span><br>        paginationInnerInterceptor.setOverflow(<span class="hljs-keyword">true</span>);<br>        paginationInnerInterceptor.setMaxLimit(<span class="hljs-number">500L</span>);<br>        interceptor.addInnerInterceptor(paginationInnerInterceptor);<br><br>        <span class="hljs-keyword">return</span> interceptor;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>html页面获取数据：</strong></p>
<p>用到了Thymeleaf的用法，详见注释！</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs html"> <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"display table table-bordered table-striped"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dynamic-table"</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>#<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>id<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>name<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>age<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>email<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>操作<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"gradeX"</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">"user,stat:${page.records}"</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${stat.count}"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${user.id}"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${user.name}"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"${user.age}"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>[[${user.email}]]<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br>                 <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">                路径参数的获取！</span><br><span class="hljs-comment">                https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#link-urls</span><br><span class="hljs-comment">                --&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@{/user/delete/{id}(id=${user.id},pn=${page.current})}"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-danger btn-sm"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row-fluid"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"span6"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dataTables_info"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"hidden-table-info_info"</span>&gt;</span><br>            当前第 [[${page.current}]] 页 总计 [[${page.pages}]] 页 共 [[${page.total}]] 条记录<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"span6"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dataTables_paginate paging_bootstrap pagination"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"prev disabled"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>← Previous<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><br>                <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">                页码为当前页码时，设为激活状态</span><br><span class="hljs-comment">                ${#numbers.sequence(1,page.pages)}：Thymeleaf的工具类用来生成一个序列</span><br><span class="hljs-comment">                当前标签生成序列！</span><br><span class="hljs-comment">                https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#numbers</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                带有参数的处理规则；</span><br><span class="hljs-comment">                https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#link-urls</span><br><span class="hljs-comment">                --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">th:class</span>=<span class="hljs-string">"${num==page.current?'active':''}"</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">"num:${#numbers.sequence(1,page.pages)}"</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@{/dynamic_table(pn=${num})}"</span>&gt;</span>[[${num}]]<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"next"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@{/dynamic_table(pn=${page.current+1})}"</span>&gt;</span>Next → <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>重定向携带参数：</strong></p>
<p>其实就是将参数拼接到url最后进行携带！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping("/user/delete/{id}")</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">deleteUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable("id")</span> Long id,</span></span><br><span class="hljs-function"><span class="hljs-params">                         <span class="hljs-meta">@RequestParam(value = "pn", defaultValue = "1")</span> Integer pn,</span></span><br><span class="hljs-function"><span class="hljs-params">                         // 重定向携带参数</span></span><br><span class="hljs-function"><span class="hljs-params">                         RedirectAttributes redirectAttributes)</span></span>{<br>    usersService.removeById(id);<br>    <span class="hljs-comment">// 将请求参数放到重定向中携带</span><br>    redirectAttributes.addAttribute(<span class="hljs-string">"pn"</span>, pn);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/dynamic_table"</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="5、整合Redis"><a class="header-anchor" href="#5、整合Redis">¶</a>5、整合Redis</h2>
<h3 id="导入依赖-3"><a class="header-anchor" href="#导入依赖-3">¶</a>导入依赖</h3>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>自动导入的东西：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/13/d50a62f713dccb3f6123b60f31d3f62e.png" alt=""></p>
<h3 id="自动配置-3"><a class="header-anchor" href="#自动配置-3">¶</a>自动配置</h3>
<ul>
<li>
<p>RedisAutoConfiguration 自动配置类。RedisProperties 属性类 --&gt; <strong><a target="_blank" rel="noopener external nofollow noreferrer" href="http://spring.redis.xxx">spring.redis.xxx</a></strong> 是对redis的配置</p>
</li>
<li>
<p>连接工厂是准备好的。<strong>Lettuce</strong>ConnectionConfiguration（<strong>默认</strong>）、<strong>Jedis</strong>ConnectionConfiguration</p>
</li>
<li>
<p><strong>自动注入了RedisTemplate</strong>&lt;<strong>Object</strong>, <strong>Object</strong>&gt;</p>
</li>
<li>
<p><strong>自动注入了StringRedisTemplate；k：v都是String</strong></p>
</li>
<li>
<p>底层只要我们使用 <strong>StringRedisTemplate、RedisTemplate就可以操作redis</strong></p>
</li>
</ul>
<h3 id="导入Jedis"><a class="header-anchor" href="#导入Jedis">¶</a>导入Jedis</h3>
<p>默认是Lettuce，导入后就有了两个，可以通过配置文件指定选择哪个！</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--引入jedis--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="配置文件-2"><a class="header-anchor" href="#配置文件-2">¶</a>配置文件</h3>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">redis://82.156.11.189:6379</span><br>    <span class="hljs-attr">client-type:</span> <span class="hljs-string">jedis</span> <span class="hljs-comment"># 默认是 Lettuce</span><br>    <span class="hljs-attr">jedis:</span><br>      <span class="hljs-attr">pool:</span><br>        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">10</span><br>        <span class="hljs-attr">max-active:</span> <span class="hljs-number">10</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="测试-3"><a class="header-anchor" href="#测试-3">¶</a>测试</h3>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br>StringRedisTemplate stringRedisTemplate;<br><span class="hljs-meta">@Autowired</span><br>RedisConnectionFactory redisConnectionFactory;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testRedis</span><span class="hljs-params">()</span></span>{<br>    ValueOperations&lt;String, String&gt; operations =<br>            stringRedisTemplate.opsForValue();<br><br>    operations.set(<span class="hljs-string">"hello"</span>, <span class="hljs-string">"world"</span>);<br>    String hello = operations.get(<span class="hljs-string">"hello"</span>);<br>    System.out.println(hello);<br><br>    System.out.println(redisConnectionFactory.getClass());<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="计数器案例"><a class="header-anchor" href="#计数器案例">¶</a>计数器案例</h3>
<p><strong>添加拦截器拦截url地址：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span> <span class="hljs-comment">// 为了WebMvcConfigurer可以从容器中获取到！</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisUrlCountInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>{<br><br>    <span class="hljs-meta">@Autowired</span><br>    StringRedisTemplate redisTemplate;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception </span>{<br>        String requestURL = request.getRequestURI();<br>        <span class="hljs-comment">// 每次访问当前url就+1</span><br>        redisTemplate.opsForValue().increment(requestURL);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>将拦截器加入容器：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>{<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * filter和Interceptor？</span><br><span class="hljs-comment">     * filter是Servlet定义的原生组件，脱离spring也可以使用！</span><br><span class="hljs-comment">     * interceptor是spring定义的接口，可以使用spring的自动装配功能！</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Autowired</span><br>    RedisUrlCountInterceptor redisUrlCountInterceptor;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> </span>{<br>        registry.addInterceptor(<span class="hljs-keyword">new</span> LoginInterceptor())<br>                <span class="hljs-comment">// 拦截路径（动静态全部都拦了）</span><br>                .addPathPatterns(<span class="hljs-string">"/**"</span>)<br>                <span class="hljs-comment">// 放行路径：css,js,font,images</span><br>                .excludePathPatterns(<span class="hljs-string">"/"</span>, <span class="hljs-string">"/login"</span>, <span class="hljs-string">"/css/**"</span>, <span class="hljs-string">"/js/**"</span>,<br>                        <span class="hljs-string">"/fonts/**"</span>, <span class="hljs-string">"/images/**"</span>, <span class="hljs-string">"/aa/**"</span>);<br><br>        <span class="hljs-comment">// 注入redis的拦截器!</span><br>        <span class="hljs-comment">// 这里不能直接new，RedisUrlCountInterceptor中我们使用的是IOC注入的组件 StringRedisTemplate</span><br>        <span class="hljs-comment">//registry.addInterceptor(new RedisUrlCountInterceptor());</span><br>        registry.addInterceptor(redisUrlCountInterceptor)<br>                .addPathPatterns(<span class="hljs-string">"/**"</span>)<br>                .excludePathPatterns(<span class="hljs-string">"/"</span>, <span class="hljs-string">"/login"</span>, <span class="hljs-string">"/css/**"</span>, <span class="hljs-string">"/js/**"</span>,<br>                        <span class="hljs-string">"/fonts/**"</span>, <span class="hljs-string">"/images/**"</span>, <span class="hljs-string">"/aa/**"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>Controller保存数据：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br>StringRedisTemplate redisTemplate;<br><br><span class="hljs-meta">@GetMapping("/index.html")</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">indexPage</span><span class="hljs-params">(HttpSession session, Model model)</span></span>{<br><br>    ValueOperations&lt;String, String&gt; operations = redisTemplate.opsForValue();<br>    String s = operations.get(<span class="hljs-string">"/index.html"</span>);<br>    String s1 = operations.get(<span class="hljs-string">"/query"</span>);<br><br>    model.addAttribute(<span class="hljs-string">"indexCount"</span>, s);<br>    model.addAttribute(<span class="hljs-string">"queryCount"</span>, s1);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">"index"</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>
<h1 id="八、单元测试"><a class="header-anchor" href="#八、单元测试">¶</a>八、单元测试</h1>
<h2 id="1、JUnit5-的变化"><a class="header-anchor" href="#1、JUnit5-的变化">¶</a>1、JUnit5 的变化</h2>
<p><strong>Spring Boot 2.2.0 版本开始引入 JUnit 5 作为单元测试默认库</strong></p>
<p>作为最新版本的JUnit框架，JUnit5与之前版本的Junit框架有很大的不同。由三个不同子项目的几个不同模块组成。</p>
<p><strong>JUnit 5 = JUnit Platform + JUnit Jupiter + JUnit Vintage</strong></p>
<ul>
<li>
<p><strong>JUnit Platform</strong>: Junit Platform是在JVM上启动测试框架的基础，不仅支持Junit自制的测试引擎，<strong>其他测试引擎也都可以接入</strong>。</p>
</li>
<li>
<p><strong>JUnit Jupiter</strong>: JUnit Jupiter提供了JUnit5的新的编程模型，是JUnit5新特性的核心。内部 包含了一个<strong>测试引擎</strong>，用于在Junit Platform上运行。</p>
</li>
<li>
<p><strong>JUnit Vintage</strong>: 由于JUint已经发展多年，为了照顾老的项目，JUnit Vintage提供了兼容JUnit4.x,Junit3.x的测试引擎。</p>
</li>
</ul>
<p><strong>注意：</strong></p>
<p>SpringBoot 2.4 以上版本移除了默认对 Vintage 的依赖。如果需要兼容junit4需要自行引入（不能使用junit4的功能 @Test）</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hamcrest<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hamcrest-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>依赖导入，默认已经导入：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>以前：</strong></p>
<p>@SpringBootTest + @RunWith(SpringTest.class)</p>
<p><strong>SpringBoot整合Junit以后：</strong></p>
<ul>
<li>编写测试方法：@Test标注（注意需要使用junit5版本的注解）</li>
<li>Junit类具有Spring的功能，@Autowired、比如 @Transactional 标注测试方法，测试完成后自动<strong>回滚</strong></li>
</ul>
<h2 id="2、JUnit5常用注解"><a class="header-anchor" href="#2、JUnit5常用注解">¶</a>2、JUnit5常用注解</h2>
<blockquote>
<p>JUnit5的注解与JUnit4的注解有所变化：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations">https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations</a></p>
</blockquote>
<ul>
<li>
<p>**@Test :**表示方法是测试方法。但是与JUnit4的@Test不同，他的职责非常单一不能声明任何属性，拓展的测试将会由Jupiter提供额外测试</p>
</li>
<li>
<p>**@ParameterizedTest :**表示方法是参数化测试</p>
</li>
<li>
<p>**@RepeatedTest :**表示方法可重复执行</p>
</li>
<li>
<p>**@DisplayName :**为测试类或者测试方法设置展示名称</p>
</li>
<li>
<p>**@BeforeEach :**表示在每个单元测试之前执行</p>
</li>
<li>
<p>**@AfterEach :**表示在每个单元测试之后执行</p>
</li>
<li>
<p>**@BeforeAll :**表示在所有单元测试之前执行</p>
</li>
<li>
<p>**@AfterAll :**表示在所有单元测试之后执行</p>
</li>
<li>
<p>**@Tag :**表示单元测试类别，类似于JUnit4中的@Categories</p>
</li>
<li>
<p>**@Disabled :**表示测试类或测试方法不执行，类似于JUnit4中的@Ignore</p>
</li>
<li>
<p>**@Timeout :**表示测试方法运行如果超过了指定时间将会返回错误</p>
</li>
<li>
<p>**@ExtendWith :**为测试类或测试方法提供扩展类引用</p>
</li>
</ul>
<p><strong>测试：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DisplayName("Junit5功能测试！")</span><br><span class="hljs-meta">@SpringBootTest</span> <span class="hljs-comment">// 不标注也能用，但标注了才能使用容器内的组件！</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Junit5Test</span> </span>{<br><br>    <span class="hljs-meta">@DisplayName("测试DisplayName 注解！")</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testDisplayName</span> <span class="hljs-params">()</span></span>{<br>        System.out.println(<span class="hljs-string">"==========1=========="</span>);<br>    }<br><br>    <span class="hljs-meta">@Disabled</span> <span class="hljs-comment">// 禁用该测试</span><br>    <span class="hljs-meta">@DisplayName("测试2！")</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testDisplayName2</span> <span class="hljs-params">()</span></span>{<br>        System.out.println(<span class="hljs-string">"=========2==========="</span>);<br>    }<br><br>    <span class="hljs-meta">@BeforeEach</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testBeforeEach</span><span class="hljs-params">()</span></span>{<br>        System.out.println(<span class="hljs-string">"============beforeEach======="</span>);<br>    }<br><br>    <span class="hljs-meta">@AfterEach</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testAfterEach</span><span class="hljs-params">()</span></span>{<br>        System.out.println(<span class="hljs-string">"============afterEach============"</span>);<br>    }<br><br>    <span class="hljs-meta">@BeforeAll</span><br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testBeforeAll</span><span class="hljs-params">()</span></span>{<br>        System.out.println(<span class="hljs-string">"============BeforeAll =============="</span>);<br>    }<br><br>    <span class="hljs-meta">@AfterAll</span><br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testAfterAll</span><span class="hljs-params">()</span></span>{<br>        System.out.println(<span class="hljs-string">"============afterAll =============="</span>);<br>    }<br><br>    <span class="hljs-meta">@Timeout(value = 500, unit = TimeUnit.MILLISECONDS)</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testTimeout</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{<br>        Thread.sleep(<span class="hljs-number">500</span>);<br>    }<br><br>    <span class="hljs-meta">@RepeatedTest(5)</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testRepeat</span><span class="hljs-params">()</span></span>{<br>        System.out.println(<span class="hljs-string">"hhhhhhhhh"</span>);<br>    }<br><br>    <span class="hljs-meta">@ParameterizedTest()</span><br>    <span class="hljs-meta">@ValueSource(strings = { "racecar", "radar", "able was I ere I saw elba" })</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">palindromes</span><span class="hljs-params">(String candidate)</span> </span>{<br>        System.out.println(candidate);<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="3、断言（assertions）"><a class="header-anchor" href="#3、断言（assertions）">¶</a>3、断言（assertions）</h2>
<p>断言（assertions）是测试方法中的核心部分，用来对测试需要满足的条件进行验证。<strong>这些断言方法都是 org.junit.jupiter.api.Assertions 的静态方法</strong>。</p>
<ul>
<li>
<p><strong>检查业务逻辑返回的数据是否合理。</strong></p>
</li>
<li>
<p><strong>所有的测试运行结束以后，会有一个详细的测试报告；</strong></p>
</li>
</ul>
<h3 id="简单断言"><a class="header-anchor" href="#简单断言">¶</a>简单断言</h3>
<p>用来对单个值进行简单的验证。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>assertEquals</td>
<td>判断两个对象或两个原始类型是否相等</td>
</tr>
<tr>
<td>assertNotEquals</td>
<td>判断两个对象或两个原始类型是否不相等</td>
</tr>
<tr>
<td>assertSame</td>
<td>判断两个对象引用是否指向同一个对象</td>
</tr>
<tr>
<td>assertNotSame</td>
<td>判断两个对象引用是否指向不同的对象</td>
</tr>
<tr>
<td>assertTrue</td>
<td>判断给定的布尔值是否为 true</td>
</tr>
<tr>
<td>assertFalse</td>
<td>判断给定的布尔值是否为 false</td>
</tr>
<tr>
<td>assertNull</td>
<td>判断给定的对象引用是否为 null</td>
</tr>
<tr>
<td>assertNotNull</td>
<td>判断给定的对象引用是否不为 null</td>
</tr>
</tbody>
</table>
<p><strong>测试：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * 可以使用maven的生命周期clean + test在项目上线前进行一次全部的测试！</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ITNXD</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2021-10-10 14:00</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@DisplayName("断言测试！")</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AssertTest</span> </span>{<br><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">cal</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span></span>{<br>        <span class="hljs-keyword">return</span> a + b;<br>    }<br><br>    <span class="hljs-comment">// 前面断言失败后面代码不会执行！</span><br>    <span class="hljs-meta">@DisplayName("简单断言测试！")</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testSimple</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-keyword">int</span> c = cal(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);<br>        <span class="hljs-comment">// Assertions.assertEquals("5", c);</span><br>        <span class="hljs-comment">// assertEquals(5, c);</span><br>        assertEquals(<span class="hljs-number">5</span>, c, <span class="hljs-string">"计算失败！"</span>);<br><br>        Object o1 = <span class="hljs-keyword">new</span> Object();<br>        Object o2 = <span class="hljs-keyword">new</span> Object();<br>        assertSame(o1, o2, <span class="hljs-string">"对象不一致！"</span>);<br><br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="数组断言"><a class="header-anchor" href="#数组断言">¶</a>数组断言</h3>
<p>通过 assertArrayEquals 方法来判断两个对象或原始类型的数组是否相等!</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DisplayName("数组断言测试！")</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testArray</span><span class="hljs-params">()</span></span>{<br>    assertArrayEquals(<span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[] {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>}, <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[] {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>});<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="组合断言"><a class="header-anchor" href="#组合断言">¶</a>组合断言</h3>
<p>assertAll 方法接受多个 org.junit.jupiter.api.Executable 函数式接口的实例作为要验证的断言，可以通过 lambda 表达式很容易的提供这些断言!</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 都成功才成功</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName("assert all")</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">all</span><span class="hljs-params">()</span> </span>{<br>    assertAll(<span class="hljs-string">"Math"</span>,<br>              () -&gt; assertEquals(<span class="hljs-number">2</span>, <span class="hljs-number">1</span> + <span class="hljs-number">1</span>, <span class="hljs-string">"失败"</span>),<br>              () -&gt; assertTrue(<span class="hljs-number">1</span> &gt; <span class="hljs-number">0</span>, <span class="hljs-string">"失败"</span>)<br>             );<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="异常断言"><a class="header-anchor" href="#异常断言">¶</a>异常断言</h3>
<p>在JUnit4时期，想要测试方法的异常情况时，需要用**@Rule<strong>注解的ExpectedException变量还是比较麻烦的。而JUnit5提供了一种新的断言方式</strong>Assertions.assertThrows()** ,配合函数式编程就可以进行使用。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName("异常测试")</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">exceptionTest</span><span class="hljs-params">()</span> </span>{<br>    ArithmeticException exception = Assertions.assertThrows(<br>        <span class="hljs-comment">//扔出断言异常</span><br>        ArithmeticException.class, () -&gt; System.out.println(<span class="hljs-number">1</span> % <span class="hljs-number">0</span>));<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="超时断言"><a class="header-anchor" href="#超时断言">¶</a>超时断言</h3>
<p>Junit5还提供了<strong>Assertions.assertTimeout()</strong> 为测试方法设置了超时时间!</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName("超时测试")</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">timeoutTest</span><span class="hljs-params">()</span> </span>{<br>    <span class="hljs-comment">//如果测试方法时间超过1s将会异常</span><br>    Assertions.assertTimeout(Duration.ofMillis(<span class="hljs-number">1000</span>), () -&gt; Thread.sleep(<span class="hljs-number">500</span>));<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="快速失败"><a class="header-anchor" href="#快速失败">¶</a>快速失败</h3>
<p>通过 fail 方法直接使得测试失败!</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName("fail")</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">shouldFail</span><span class="hljs-params">()</span> </span>{<br>    fail(<span class="hljs-string">"This should fail"</span>);<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="4、前置条件（assumptions）"><a class="header-anchor" href="#4、前置条件（assumptions）">¶</a>4、前置条件（assumptions）</h2>
<p>JUnit 5 中的前置条件（assumptions【假设】）类似于断言，不同之处在于不满足的断言会使得测试方法失败，而不满足的前置条件只会使得测试方法的执行终止。前置条件可以看成是测试方法执行的前提，当该前提不满足时，就没有继续执行的必要。</p>
<ul>
<li>
<p>assumeTrue 和 assumFalse 确保给定的条件为 true 或 false，不满足条件会使得测试执行终止。</p>
</li>
<li>
<p>assumingThat 的参数是表示条件的布尔值和对应的 Executable 接口的实现对象。只有条件满足时，Executable 对象才会被执行；当条件不满足时，测试执行并不会终止。</p>
</li>
<li>
<p><strong>assume 出现错误就跳过了，进行maven clean+test时显示的是ignore而不是error，</strong></p>
</li>
<li>
<p>assert错误就是错误！</p>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// assume 出现错误就跳过了，进行maven clean+test时显示的是ignore而不是error，</span><br><span class="hljs-comment">// assert错误就是错误！</span><br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String environment = <span class="hljs-string">"DEV"</span>;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName("simple")</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">simpleAssume</span><span class="hljs-params">()</span> </span>{<br>    <span class="hljs-comment">// 同样需要导入静态包 Assumptions</span><br>    assumeTrue(Objects.equals(<span class="hljs-keyword">this</span>.environment, <span class="hljs-string">"jjj"</span>));<br>    assumeFalse(() -&gt; Objects.equals(<span class="hljs-keyword">this</span>.environment, <span class="hljs-string">"PROD"</span>));<br>}<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisplayName("assume then do")</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">assumeThenDo</span><span class="hljs-params">()</span> </span>{<br>    assumingThat(<br>        Objects.equals(<span class="hljs-keyword">this</span>.environment, <span class="hljs-string">"DEV"</span>),<br>        () -&gt; System.out.println(<span class="hljs-string">"In DEV"</span>)<br>    );<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="5、嵌套测试"><a class="header-anchor" href="#5、嵌套测试">¶</a>5、嵌套测试</h2>
<p>JUnit 5 可以通过 Java 中的内部类和@Nested 注解实现嵌套测试，从而可以更好的把相关的测试方法组织在一起。在内部类中可以使用@BeforeEach 和@AfterEach 注解，而且嵌套的层次没有限制。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * 内层可以调用外层，外层无法调用内层！</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ITNXD</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2021-10-10 14:34</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@DisplayName("嵌套测试！")</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestingAStackDemo</span> </span>{<br><br>    Stack&lt;Object&gt; stack;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-meta">@DisplayName("is instantiated with new Stack()")</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">isInstantiatedWithNew</span><span class="hljs-params">()</span> </span>{<br>        <span class="hljs-keyword">new</span> Stack&lt;&gt;();<br>    }<br><br>    <span class="hljs-comment">// 表示是一个嵌套测试！</span><br>    <span class="hljs-meta">@Nested</span><br>    <span class="hljs-meta">@DisplayName("when new")</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WhenNew</span> </span>{<br><br>        <span class="hljs-meta">@BeforeEach</span><br>        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">createNewStack</span><span class="hljs-params">()</span> </span>{<br>            stack = <span class="hljs-keyword">new</span> Stack&lt;&gt;();<br>        }<br><br>        <span class="hljs-meta">@Test</span><br>        <span class="hljs-meta">@DisplayName("is empty")</span><br>        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">()</span> </span>{<br>            assertTrue(stack.isEmpty());<br>        }<br><br>        <span class="hljs-meta">@Test</span><br>        <span class="hljs-meta">@DisplayName("throws EmptyStackException when popped")</span><br>        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">throwsExceptionWhenPopped</span><span class="hljs-params">()</span> </span>{<br>            assertThrows(EmptyStackException.class, stack::pop);<br>        }<br><br>        <span class="hljs-meta">@Test</span><br>        <span class="hljs-meta">@DisplayName("throws EmptyStackException when peeked")</span><br>        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">throwsExceptionWhenPeeked</span><span class="hljs-params">()</span> </span>{<br>            assertThrows(EmptyStackException.class, stack::peek);<br>        }<br><br>        <span class="hljs-meta">@Nested</span><br>        <span class="hljs-meta">@DisplayName("after pushing an element")</span><br>        <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AfterPushing</span> </span>{<br><br>            String anElement = <span class="hljs-string">"an element"</span>;<br><br>            <span class="hljs-meta">@BeforeEach</span><br>            <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pushAnElement</span><span class="hljs-params">()</span> </span>{<br>                stack.push(anElement);<br>            }<br><br>            <span class="hljs-meta">@Test</span><br>            <span class="hljs-meta">@DisplayName("it is no longer empty")</span><br>            <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">isNotEmpty</span><span class="hljs-params">()</span> </span>{<br>                assertFalse(stack.isEmpty());<br>            }<br><br>            <span class="hljs-meta">@Test</span><br>            <span class="hljs-meta">@DisplayName("returns the element when popped and is empty")</span><br>            <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">returnElementWhenPopped</span><span class="hljs-params">()</span> </span>{<br>                assertEquals(anElement, stack.pop());<br>                assertTrue(stack.isEmpty());<br>            }<br><br>            <span class="hljs-meta">@Test</span><br>            <span class="hljs-meta">@DisplayName("returns the element when peeked but remains not empty")</span><br>            <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">returnElementWhenPeeked</span><span class="hljs-params">()</span> </span>{<br>                assertEquals(anElement, stack.peek());<br>                assertFalse(stack.isEmpty());<br>            }<br>        }<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="6、参数化测试"><a class="header-anchor" href="#6、参数化测试">¶</a>6、参数化测试</h2>
<p>参数化测试是JUnit5很重要的一个新特性，它使得用不同的参数多次运行测试成为了可能，也为我们的单元测试带来许多便利。</p>
<p>利用**@ValueSource**等注解，指定入参，我们将可以使用不同的参数进行多次单元测试，而不需要每新增一个参数就新增一个单元测试，省去了很多冗余代码。</p>
<ul>
<li>
<p><strong>@ValueSource</strong>: 为参数化测试指定入参来源，支持八大基础类以及String类型,Class类型</p>
</li>
<li>
<p><strong>@NullSource</strong>: 表示为参数化测试提供一个null的入参</p>
</li>
<li>
<p><strong>@EnumSource</strong>: 表示为参数化测试提供一个枚举入参</p>
</li>
<li>
<p><strong>@CsvFileSource</strong>：表示读取指定CSV文件内容作为参数化测试入参</p>
</li>
<li>
<p><strong>@MethodSource</strong>：表示读取指定方法的返回值作为参数化测试入参(注意方法返回需要是一个流)</p>
</li>
<li>
<p>当然如果参数化测试仅仅只能做到指定普通的入参还达不到让我觉得惊艳的地步。让我真正感到他的强大之处的地方在于他可以支持外部的各类入参。</p>
</li>
<li>
<p>如:CSV,YML,JSON 文件甚至方法的返回值也可以作为入参。只需要去实现<strong>ArgumentsProvider</strong>接口，任何外部文件都可以作为它的入参。</p>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 参数化测试：</span><br><span class="hljs-meta">@ParameterizedTest</span><br><span class="hljs-meta">@ValueSource(strings = {"one", "two", "three"})</span><br><span class="hljs-meta">@DisplayName("参数化测试1")</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">parameterizedTest1</span><span class="hljs-params">(String string)</span> </span>{<br>    System.out.println(string);<br>    Assertions.assertTrue(StringUtils.isNotBlank(string));<br>}<br><br><span class="hljs-meta">@ParameterizedTest</span><br><span class="hljs-meta">@MethodSource("method")</span>    <span class="hljs-comment">//指定方法名</span><br><span class="hljs-meta">@DisplayName("方法来源参数")</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testWithExplicitLocalMethodSource</span><span class="hljs-params">(String name)</span> </span>{<br>    System.out.println(name);<br>    Assertions.assertNotNull(name);<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> Stream&lt;String&gt; <span class="hljs-title">method</span><span class="hljs-params">()</span> </span>{<br>    <span class="hljs-keyword">return</span> Stream.of(<span class="hljs-string">"apple"</span>, <span class="hljs-string">"banana"</span>);<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="7、迁移指南"><a class="header-anchor" href="#7、迁移指南">¶</a>7、迁移指南</h2>
<p><strong>Junit4迁移到Junit5：</strong></p>
<ul>
<li>
<p>注解在 org.junit.jupiter.api 包中，断言在 org.junit.jupiter.api.Assertions 类中，前置条件在 org.junit.jupiter.api.Assumptions 类中。</p>
</li>
<li>
<p>把@Before 和@After 替换成@BeforeEach 和@AfterEach。</p>
</li>
<li>
<p>把@BeforeClass 和@AfterClass 替换成@BeforeAll 和@AfterAll。</p>
</li>
<li>
<p>把@Ignore 替换成@Disabled。</p>
</li>
<li>
<p>把@Category 替换成@Tag。</p>
</li>
<li>
<p>把@RunWith、@Rule 和@ClassRule 替换成@ExtendWith。</p>
</li>
</ul>
<h1 id="九、指标监控"><a class="header-anchor" href="#九、指标监控">¶</a>九、指标监控</h1>
<h2 id="1、SpringBoot-Actuator"><a class="header-anchor" href="#1、SpringBoot-Actuator">¶</a>1、SpringBoot Actuator</h2>
<blockquote>
<p>未来每一个微服务在云上部署以后，我们都需要对其进行监控、追踪、审计、控制等。SpringBoot就抽取了Actuator场景，使得我们每个微服务快速引用即可获得生产级别的应用监控、审计等功能。</p>
</blockquote>
<h3 id="导入依赖-4"><a class="header-anchor" href="#导入依赖-4">¶</a>导入依赖</h3>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>自动导入的东西：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/13/735adc4a2a3e922404ac737911a36015.png" alt=""></p>
<h3 id="版本差异"><a class="header-anchor" href="#版本差异">¶</a>版本差异</h3>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/13/43f1a7eecac8e6447a2d74be0cc12422.png" alt=""></p>
<h3 id="配置文件-3"><a class="header-anchor" href="#配置文件-3">¶</a>配置文件</h3>
<ul>
<li>HTTP：默认只暴露<strong>health</strong> Endpoint，即web方式暴露！</li>
<li><strong>JMX</strong>：默认暴露所有Endpoint，即电脑cmd输入jconsole即可打开一个JDK自带的控制台，可以监控所有信息！</li>
</ul>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoints:</span><br>    <span class="hljs-attr">enabled-by-default:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 开启全部endpoints 或设置为false，在下面动开启某一项</span><br>    <span class="hljs-attr">web:</span><br>      <span class="hljs-attr">exposure:</span><br>        <span class="hljs-attr">include:</span> <span class="hljs-string">'*'</span> <span class="hljs-comment"># web方式全部暴露，默认只有health一个</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="访问测试"><a class="header-anchor" href="#访问测试">¶</a>访问测试</h3>
<p>访问地址：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:8080/actuator/**">http://localhost:8080/actuator/**</a></p>
<p>返回的结果都是JSON格式！推荐使用浏览器插件格式化JSON数据！</p>
<p>暴露所有监控信息为HTTP！</p>
<ul>
<li>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:8080/actuator/beans">http://localhost:8080/actuator/beans</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:8080/actuator/configprops">http://localhost:8080/actuator/configprops</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:8080/actuator/metrics">http://localhost:8080/actuator/metrics</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:8080/actuator/metrics/jvm.gc.pause">http://localhost:8080/actuator/metrics/jvm.gc.pause</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:8080/actuator/metrics/">http://localhost:8080/actuator/metrics/</a> + endpointName</p>
</li>
</ul>
<h2 id="2、Actuator-Endpoint"><a class="header-anchor" href="#2、Actuator-Endpoint">¶</a>2、Actuator Endpoint</h2>
<h3 id="最常使用的端点"><a class="header-anchor" href="#最常使用的端点">¶</a>最常使用的端点</h3>
<table>
<thead>
<tr>
<th>ID</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auditevents</code></td>
<td>暴露当前应用程序的审核事件信息。需要一个<code>AuditEventRepository组件</code>。</td>
</tr>
<tr>
<td><code>beans</code></td>
<td>显示应用程序中所有Spring Bean的完整列表。</td>
</tr>
<tr>
<td><code>caches</code></td>
<td>暴露可用的缓存。</td>
</tr>
<tr>
<td><code>conditions</code></td>
<td>显示自动配置的所有条件信息，包括匹配或不匹配的原因。</td>
</tr>
<tr>
<td><code>configprops</code></td>
<td>显示所有<code>@ConfigurationProperties</code>。</td>
</tr>
<tr>
<td><code>env</code></td>
<td>暴露Spring的属性<code>ConfigurableEnvironment</code></td>
</tr>
<tr>
<td><code>flyway</code></td>
<td>显示已应用的所有Flyway数据库迁移。 需要一个或多个<code>Flyway</code>组件。</td>
</tr>
<tr>
<td><code>health</code></td>
<td>显示应用程序运行状况信息。</td>
</tr>
<tr>
<td><code>httptrace</code></td>
<td>显示HTTP跟踪信息（默认情况下，最近100个HTTP请求-响应）。需要一个<code>HttpTraceRepository</code>组件。</td>
</tr>
<tr>
<td><code>info</code></td>
<td>显示应用程序信息。</td>
</tr>
<tr>
<td><code>integrationgraph</code></td>
<td>显示Spring <code>integrationgraph</code> 。需要依赖<code>spring-integration-core</code>。</td>
</tr>
<tr>
<td><code>loggers</code></td>
<td>显示和修改应用程序中日志的配置。</td>
</tr>
<tr>
<td><code>liquibase</code></td>
<td>显示已应用的所有Liquibase数据库迁移。需要一个或多个<code>Liquibase</code>组件。</td>
</tr>
<tr>
<td><code>metrics</code></td>
<td>显示当前应用程序的“指标”信息。</td>
</tr>
<tr>
<td><code>mappings</code></td>
<td>显示所有<code>@RequestMapping</code>路径列表。</td>
</tr>
<tr>
<td><code>scheduledtasks</code></td>
<td>显示应用程序中的计划任务。</td>
</tr>
<tr>
<td><code>sessions</code></td>
<td>允许从Spring Session支持的会话存储中检索和删除用户会话。需要使用Spring Session的基于Servlet的Web应用程序。</td>
</tr>
<tr>
<td><code>shutdown</code></td>
<td>使应用程序正常关闭。默认禁用。</td>
</tr>
<tr>
<td><code>startup</code></td>
<td>显示由<code>ApplicationStartup</code>收集的启动步骤数据。需要使用<code>SpringApplication</code>进行配置<code>BufferingApplicationStartup</code>。</td>
</tr>
<tr>
<td><code>threaddump</code></td>
<td>执行线程转储。</td>
</tr>
</tbody>
</table>
<p><strong>如果您的应用程序是Web应用程序（Spring MVC，Spring WebFlux或Jersey），则可以使用以下附加端点：</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>heapdump</code></td>
<td>返回<code>hprof</code>堆转储文件。</td>
</tr>
<tr>
<td><code>jolokia</code></td>
<td>通过HTTP暴露JMX bean（需要引入Jolokia，不适用于WebFlux）。需要引入依赖<code>jolokia-core</code>。</td>
</tr>
<tr>
<td><code>logfile</code></td>
<td>返回日志文件的内容（如果已设置<code>logging.file.name</code>或<code>logging.file.path</code>属性）。支持使用HTTP<code>Range</code>标头来检索部分日志文件的内容。</td>
</tr>
<tr>
<td><code>prometheus</code></td>
<td>以Prometheus服务器可以抓取的格式公开指标。需要依赖<code>micrometer-registry-prometheus</code>。</td>
</tr>
</tbody>
</table>
<p><strong>最常用的Endpoint：</strong></p>
<ul>
<li>
<p>Health：健康状况</p>
</li>
<li>
<p><strong>Metrics：运行时指标</strong></p>
</li>
<li>
<p>Loggers：日志记录</p>
</li>
</ul>
<h3 id="Health-Endpoint"><a class="header-anchor" href="#Health-Endpoint">¶</a>Health Endpoint</h3>
<p>健康检查端点，我们一般用于在云平台，平台会定时的检查应用的健康状况，我们就需要Health Endpoint可以为平台返回当前应用的一系列组件健康状况的集合。</p>
<p>重要的几点：全部健康才健康！</p>
<ul>
<li>
<p>health endpoint返回的结果，应该是一系列健康检查后的一个汇总报告</p>
</li>
<li>
<p>很多的健康检查默认已经自动配置好了，比如：数据库、redis等</p>
</li>
<li>
<p>可以很容易的添加自定义的健康检查机制</p>
</li>
</ul>
<p><strong>设置某个endpoint，开启详细信息：</strong></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoints:</span><br>    <span class="hljs-attr">enabled-by-default:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 开启全部endpoints 或设置为false，在下面动开启某一项</span><br>    <span class="hljs-attr">web:</span><br>      <span class="hljs-attr">exposure:</span><br>        <span class="hljs-attr">include:</span> <span class="hljs-string">'*'</span> <span class="hljs-comment"># web方式全部暴露，默认只有health一个</span><br>  <span class="hljs-attr">endpoint:</span><br>    <span class="hljs-attr">health:</span><br>      <span class="hljs-attr">show-details:</span> <span class="hljs-string">always</span> <span class="hljs-comment"># 开启显示健康状况的详细信息</span><br></code></pre></td></tr></tbody></table></figure>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/13/31b4aa0e6b18da3b6f752fcfe1865588.png" alt=""></p>
<h3 id="Metrics-Endpoint"><a class="header-anchor" href="#Metrics-Endpoint">¶</a>Metrics Endpoint</h3>
<p>提供详细的、层级的、空间指标信息，这些信息可以被pull（主动推送）或者push（被动获取）方式得到；</p>
<ul>
<li>
<p>通过Metrics对接多种监控系统</p>
</li>
<li>
<p>简化核心Metrics开发</p>
</li>
<li>
<p>添加自定义Metrics或者扩展已有Metrics</p>
</li>
</ul>
<p>访问查看：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:8080/actuator/metrics/jvm.gc.pause%EF%BC%8C%E5%90%8E%E9%9D%A2%E8%B7%9F%E4%B8%8A%E4%B8%8B%E9%9D%A2%E7%9A%84%E9%A1%B9%E5%8D%B3%E5%8F%AF%EF%BC%81">http://localhost:8080/actuator/metrics/jvm.gc.pause，后面跟上下面的项即可！</a></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/13/b89587bbd68464913c414df3dda00790.png" alt=""></p>
<h3 id="管理Endpoints"><a class="header-anchor" href="#管理Endpoints">¶</a>管理Endpoints</h3>
<p><strong>开启与禁用Endpoints：</strong></p>
<ul>
<li>默认所有的Endpoint除过shutdown都是开启的。</li>
<li>需要开启或者禁用某个Endpoint。配置模式为  management.endpoint.endpointName.enabled = true</li>
<li>jmx和http方式都会受到总开关的控制！</li>
</ul>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoints:</span><br>    <span class="hljs-attr">enabled-by-default:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 开启全部endpoints 或设置为false，在下面动开启某一项</span><br></code></pre></td></tr></tbody></table></figure>
<ul>
<li>或者禁用所有的Endpoint然后手动开启指定的Endpoint</li>
</ul>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoints:</span><br>    <span class="hljs-attr">enabled-by-default:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">endpoint:</span><br>    <span class="hljs-attr">beans:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">health:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></tbody></table></figure>
<h2 id="3、定制-Endpoint"><a class="header-anchor" href="#3、定制-Endpoint">¶</a>3、定制 Endpoint</h2>
<h3 id="定制-Health-信息"><a class="header-anchor" href="#定制-Health-信息">¶</a>定制 Health 信息</h3>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ITNXD</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2021-10-10 15:54</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-comment">// 组件名字就是类名截掉HealthIndicator剩下的！</span><br><span class="hljs-comment">// 继承抽象类或者实现 HealthIndicator 接口！</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyHealthIndicator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractHealthIndicator</span> </span>{<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 自定义健康检查！</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> builder</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doHealthCheck</span><span class="hljs-params">(Health.Builder builder)</span> <span class="hljs-keyword">throws</span> Exception </span>{<br><br>        HashMap&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">true</span>){<br>            <span class="hljs-comment">// builder.up(); 健康</span><br>            <span class="hljs-comment">// builder.status(Status.OUT_OF_SERVICE);</span><br>            builder.status(Status.UP);<br>            map.put(<span class="hljs-string">"count"</span>, <span class="hljs-number">5</span>);<br>            map.put(<span class="hljs-string">"ms"</span>, <span class="hljs-number">100</span>);<br>        }<span class="hljs-keyword">else</span>{<br>            <span class="hljs-comment">// builder.down();</span><br>            builder.status(Status.DOWN);<br>            map.put(<span class="hljs-string">"error"</span>, <span class="hljs-string">"连接超时"</span>);<br>            map.put(<span class="hljs-string">"ms"</span>, <span class="hljs-number">3000</span>);<br>        }<br><br>        builder.withDetail(<span class="hljs-string">"code"</span>, <span class="hljs-number">110</span>).withDetails(map);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="定制info信息"><a class="header-anchor" href="#定制info信息">¶</a>定制info信息</h3>
<h4 id="编写配置文件"><a class="header-anchor" href="#编写配置文件">¶</a>编写配置文件</h4>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 定制info信息</span><br><span class="hljs-attr">info:</span><br>  <span class="hljs-attr">appName:</span> <span class="hljs-string">boot-admin</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-number">2.0</span><span class="hljs-number">.1</span><br>  <span class="hljs-attr">mavenProjectName:</span> <span class="hljs-string">@project.artifactId@</span>  <span class="hljs-comment">#使用@@可以获取maven的pom文件值</span><br>  <span class="hljs-attr">mavenProjectVersion:</span> <span class="hljs-string">@project.version@</span><br></code></pre></td></tr></tbody></table></figure>
<h4 id="编写InfoContributor"><a class="header-anchor" href="#编写InfoContributor">¶</a>编写InfoContributor</h4>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span> <span class="hljs-comment">// 这个不要求类名后缀为 InfoContributor</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppInfoContributor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InfoContributor</span> </span>{<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contribute</span><span class="hljs-params">(Info.Builder builder)</span> </span>{<br>        builder.withDetail(<span class="hljs-string">"msg"</span>,<span class="hljs-string">"你好"</span>)<br>                .withDetail(<span class="hljs-string">"hello"</span>, <span class="hljs-string">"哈哈哈"</span>)<br>                .withDetails(Collections.singletonMap(<span class="hljs-string">"world"</span>, <span class="hljs-number">666</span>));<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>测试</strong>：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:8080/actuator/info">http://localhost:8080/actuator/info</a></p>
<h3 id="定制Metrics信息"><a class="header-anchor" href="#定制Metrics信息">¶</a>定制Metrics信息</h3>
<h4 id="SpringBoot默认支持"><a class="header-anchor" href="#SpringBoot默认支持">¶</a>SpringBoot默认支持</h4>
<ul>
<li>
<p>JVM metrics, report utilization of:</p>
<ul>
<li>Various memory and buffer pools</li>
<li>Statistics related to garbage collection</li>
<li>Threads utilization</li>
<li>Number of classes loaded/unloaded</li>
</ul>
</li>
<li>
<p>CPU metrics</p>
</li>
<li>
<p>File descriptor metrics</p>
</li>
<li>
<p>Kafka consumer and producer metrics</p>
</li>
<li>
<p>Log4j2 metrics: record the number of events logged to Log4j2 at each level</p>
</li>
<li>
<p>Logback metrics: record the number of events logged to Logback at each level</p>
</li>
<li>
<p>Uptime metrics: report a gauge for uptime and a fixed gauge representing the application’s absolute start time</p>
</li>
<li>
<p>Tomcat metrics (<code>server.tomcat.mbeanregistry.enabled</code> must be set to <code>true</code> for all Tomcat metrics to be registered)</p>
</li>
<li>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.spring.io/spring-integration/docs/5.4.1/reference/html/system-management.html#micrometer-integration">Spring Integration</a> metrics</p>
</li>
</ul>
<h4 id="增加定制Metrics"><a class="header-anchor" href="#增加定制Metrics">¶</a>增加定制Metrics</h4>
<p>调用一次saveCity方法，设置的指标值<code>myservice.method.running.counter</code>就会加一！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CityService</span> </span>{<br><br>    Counter counter;<br><br>    <span class="hljs-comment">// 定制metrics</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CityService</span><span class="hljs-params">(MeterRegistry meterRegistry)</span></span>{<br>        counter = meterRegistry.counter(<span class="hljs-string">"myservice.method.running.counter"</span>);<br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">saveCity</span><span class="hljs-params">(City city)</span> </span>{<br>        <span class="hljs-comment">// 定制metrics</span><br>        counter.increment();<br><br>        cityMapper.insert(city);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="定制Endpoint"><a class="header-anchor" href="#定制Endpoint">¶</a>定制Endpoint</h3>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 自定义endpoint!</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ITNXD</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2021-10-10 17:05</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// 自定义的不在默认的配置里，默认开启！可以使用 @ConfigurationProperties绑定配置文件</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Endpoint(id = "myService")</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyServiceEndPoint</span> </span>{<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * http://localhost:8888/actuator/myService 即可调用该方法！</span><br><span class="hljs-comment">     * http://localhost:8888/actuator</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@ReadOperation</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map <span class="hljs-title">getDockerInfo</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-keyword">return</span> Collections.singletonMap(<span class="hljs-string">"info"</span>,<span class="hljs-string">"docker started..."</span>);<br>    }<br><br>    <span class="hljs-meta">@WriteOperation</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">restartDocker</span><span class="hljs-params">()</span></span>{<br>        System.out.println(<span class="hljs-string">"docker restarted...."</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="4、微服务可视化监控"><a class="header-anchor" href="#4、微服务可视化监控">¶</a>4、微服务可视化监控</h2>
<blockquote>
<p>官方地址：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/codecentric/spring-boot-admin">https://github.com/codecentric/spring-boot-admin</a></p>
<p>快速开启：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://codecentric.github.io/spring-boot-admin/2.5.1/#getting-started">https://codecentric.github.io/spring-boot-admin/2.5.1/#getting-started</a></p>
</blockquote>
<h3 id="准备-Admin-Server"><a class="header-anchor" href="#准备-Admin-Server">¶</a>准备 Admin Server</h3>
<p>新建一个module，用来配置admin server！</p>
<p><strong>导入依赖：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">    https://codecentric.github.io/spring-boot-admin/2.5.1/#getting-started</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>de.codecentric<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-admin-starter-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>主配置类开启AdminServer：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableAdminServer</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorld5Application</span> </span>{<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<br>        SpringApplication.run(HelloWorld5Application.class, args);<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>指定一个不同端口：</strong></p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-meta">server.port</span>=<span class="hljs-string">8889</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>启动即可！</strong></p>
<h3 id="项目中引用AdminServer"><a class="header-anchor" href="#项目中引用AdminServer">¶</a>项目中引用AdminServer</h3>
<p><strong>引入监控依赖：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment"> 引入admin监控！</span><br><span class="hljs-comment">--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>de.codecentric<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-admin-starter-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>配置文件配置监控地址：</strong></p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-meta">spring.boot.admin.client.url</span>=<span class="hljs-string">http://localhost:8889</span><br><span class="hljs-comment"># 使用ip注册，默认是使用电脑名为主机地址</span><br><span class="hljs-meta">spring.boot.admin.client.instance.prefer-ip</span>=<span class="hljs-string">true</span><br><span class="hljs-comment"># 指定应用名称</span><br><span class="hljs-meta">spring.application.name</span>=<span class="hljs-string">HelloWorld4</span><br><span class="hljs-meta">management.endpoints.web.exposure.include</span>=<span class="hljs-string">*</span><br></code></pre></td></tr></tbody></table></figure>
<h1 id="十、原理解析"><a class="header-anchor" href="#十、原理解析">¶</a>十、原理解析</h1>
<h2 id="1、profile功能"><a class="header-anchor" href="#1、profile功能">¶</a>1、profile功能</h2>
<blockquote>
<p>为了方便多环境适配，springboot简化了profile功能！</p>
</blockquote>
<h3 id="application-profile功能"><a class="header-anchor" href="#application-profile功能">¶</a>application-profile功能</h3>
<ul>
<li>
<p>默认配置文件  application.yaml；任何时候都会加载</p>
</li>
<li>
<p>指定环境配置文件  application-{env}.yaml</p>
</li>
<li>
<p>激活指定环境</p>
<ul>
<li>配置文件激活</li>
<li>命令行激活：java -jar xxx.jar –<strong>spring.profiles.active=prod  --person.name=haha</strong>
<ul>
<li><strong>修改配置文件的任意值，命令行优先</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<p>默认配置与环境配置同时生效</p>
</li>
<li>
<p>同名配置项，profile配置优先</p>
</li>
</ul>
<p><strong>application.properties：</strong></p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-meta">person.name</span>=<span class="hljs-string">张三111</span><br><span class="hljs-meta">person.age</span>=<span class="hljs-string">2222</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>application-prod.yml：</strong></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">person:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">prod-李四</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>application-test.yml：</strong></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">person:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">test-李四</span><br>  <span class="hljs-attr">age:</span> <span class="hljs-number">45</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>测试：</strong> 返回张三111</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>{<br><br>    <span class="hljs-comment">// 从配置文件中取，取不到取:后的默认值</span><br>    <span class="hljs-meta">@Value("${person.name:李四}")</span><br><br>    <span class="hljs-meta">@GetMapping("/hello")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-keyword">return</span> name;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>可以在application.properties中激活指定环境：</strong></p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># 激活指定环境，当前环境和指定环境都会生效，同配置则指定环境覆盖当前环境！</span><br><span class="hljs-meta">spring.profiles.active</span>=<span class="hljs-string">test</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="Profile条件装配功能"><a class="header-anchor" href="#Profile条件装配功能">¶</a>@Profile条件装配功能</h3>
<p><strong>可以标注在方法上也可以标注在类上，用来在指定环境下生效的条件装配功能！</strong></p>
<p><strong>二者都实现了Person接口，可以使用profile注解标注指定什么环境下有效：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Person</span> </span>{<br><br>}<br><br><span class="hljs-meta">@Profile({"prod", "default"})</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = "person")</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Boss</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Person</span></span>{<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>}<br><br><span class="hljs-meta">@Profile("test")</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = "person")</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Worker</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Person</span></span>{<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>application.properties文件来指定生效配置：</strong></p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-meta">spring.profiles.active</span>=<span class="hljs-string">test</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>测试：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>{<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> Person person;<br><br>    <span class="hljs-meta">@GetMapping("/person")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">person</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-keyword">return</span> person.getClass().toString();<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="profile分组"><a class="header-anchor" href="#profile分组">¶</a>profile分组</h3>
<p>可以将各种配置文件都通过profile分组写进来，显示指明使用哪个组，一个组可以有多个配置文件，相当于分文件分类配置，清晰明了！</p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># 几乎分组myprod</span><br><span class="hljs-meta">spring.profiles.active</span>=<span class="hljs-string">myprod</span><br><br><span class="hljs-meta">spring.profiles.group.myprod[0]</span>=<span class="hljs-string">ppd</span><br><span class="hljs-meta">spring.profiles.group.myprod[1]</span>=<span class="hljs-string">prod</span><br><br><span class="hljs-meta">spring.profiles.group.mytest[0]</span>=<span class="hljs-string">test</span><br></code></pre></td></tr></tbody></table></figure>
<h2 id="2、外部化配置"><a class="header-anchor" href="#2、外部化配置">¶</a>2、外部化配置</h2>
<blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config">https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config</a></p>
</blockquote>
<h3 id="外部配置源"><a class="header-anchor" href="#外部配置源">¶</a>外部配置源</h3>
<ul>
<li>Java属性文件</li>
<li>YAML文件</li>
<li>环境变量</li>
<li>命令行参数</li>
</ul>
<p><strong>value注解获取系统环境变量：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 从本电脑取环境变量值</span><br><span class="hljs-meta">@Value("${CLASSPATH}")</span><br><span class="hljs-keyword">private</span> String msg;<br></code></pre></td></tr></tbody></table></figure>
<p><strong>启动类获取系统环境变量：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorld6Application</span> </span>{<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<br>        ConfigurableApplicationContext run = <br>                SpringApplication.run(HelloWorld6Application.class, args);<br><br>        ConfigurableEnvironment environment = run.getEnvironment();<br><br>        Map&lt;String, Object&gt; systemEnvironment = environment.getSystemEnvironment();<br><br>        MutablePropertySources propertySources = environment.getPropertySources();<br><br>        System.out.println(systemEnvironment);<br>        System.out.println(propertySources);<br><br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure>
<h3 id="配置文件查找位置"><a class="header-anchor" href="#配置文件查找位置">¶</a>配置文件查找位置</h3>
<ul>
<li>
<p>classpath 根路径</p>
</li>
<li>
<p>classpath 根路径下config目录</p>
</li>
<li>
<p>jar包当前目录</p>
</li>
<li>
<p>jar包当前目录的config目录</p>
</li>
<li>
<p>jar包当前目录/config子目录的直接子目录</p>
</li>
</ul>
<p><strong>后面覆盖前面！</strong></p>
<h3 id="配置文件加载顺序"><a class="header-anchor" href="#配置文件加载顺序">¶</a>配置文件加载顺序</h3>
<ol>
<li>当前jar包内部的application.properties和application.yml</li>
<li>当前jar包内部的application-{profile}.properties 和 application-{profile}.yml</li>
<li>引用的外部jar包的application.properties和application.yml</li>
<li>引用的外部jar包的application-{profile}.properties 和 application-{profile}.yml</li>
</ol>
<p><strong>后面覆盖前面！</strong></p>
<p><strong>指定环境优先，外部优先，后面的可以覆盖前面的同名配置项！</strong></p>
<h2 id="3、自定义starter"><a class="header-anchor" href="#3、自定义starter">¶</a>3、自定义starter</h2>
<h3 id="Starter结构图"><a class="header-anchor" href="#Starter结构图">¶</a>Starter结构图</h3>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/13/1801e123a25a56561be9abd1ea7a7050.png" alt=""></p>
<ul>
<li>
<p>autoconfigure包中配置使用 <strong>META-INF/spring.factories</strong> 中 <strong>EnableAutoConfiguration 的值，使得项目启动加载指定的自动配置类</strong></p>
</li>
<li>
<p><strong>编写自动配置类 xxxAutoConfiguration -&gt; xxxxProperties</strong></p>
</li>
<li>
<ul>
<li><strong>@Configuration</strong></li>
<li><strong>@Conditional</strong></li>
</ul>
</li>
<li>
<ul>
<li><strong>@EnableConfigurationProperties</strong></li>
<li><strong>@Bean</strong></li>
</ul>
</li>
<li>
<ul>
<li>…</li>
</ul>
</li>
</ul>
<p><strong>引入starter</strong> <strong>— xxxAutoConfiguration — 容器中放入组件 ---- 绑定xxxProperties ----</strong> <strong>配置项</strong></p>
<h3 id="创建-Starter-Maven-Module"><a class="header-anchor" href="#创建-Starter-Maven-Module">¶</a>创建 Starter Maven Module</h3>
<ul>
<li>用来让人引用</li>
<li>引用autoconfigure包实现功能</li>
<li>全部完成后使用Maven的生命周期中的 clean + install 进行打包并安装到本地Maven仓库即可！</li>
</ul>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itnxd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>itnxd-hello-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br><br><span class="hljs-comment">&lt;!--引入自动配置包--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itnxd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>itnxd-hello-spring-boot-starter-autoconfigure<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<h3 id="创建-Autoconfigure-Boot-Module"><a class="header-anchor" href="#创建-Autoconfigure-Boot-Module">¶</a>创建 Autoconfigure Boot Module</h3>
<p>下方全部配置完成，使用Maven的生命周期中的 clean + install 进行打包并安装到本地Maven仓库即可！</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itnxd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>itnxd-hello-spring-boot-starter-autoconfigure<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>itnxd-hello-spring-boot-starter-autoconfigure<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>itnxd-hello-spring-boot-starter-autoconfigure<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>HelloService：</strong></p>
<p>不要放在容器中，要使用自动配置类来控制！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 不要放在容器中！使用配置类放！</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ITNXD</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2021-10-11 9:57</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloService</span> </span>{<br><br>    <span class="hljs-meta">@Autowired</span><br>    HelloServiceProperties helloServiceProperties;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">sayHello</span><span class="hljs-params">(String name)</span></span>{<br>        <span class="hljs-keyword">return</span> helloServiceProperties.getPrefix() + name +<br>                helloServiceProperties.getSuffix();<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>HelloServiceProperties：</strong></p>
<ul>
<li>绑定配置文件前缀</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ITNXD</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2021-10-11 10:03</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = "itnxd.hello")</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloServiceProperties</span> </span>{<br><br>    <span class="hljs-keyword">private</span> String prefix;<br>    <span class="hljs-keyword">private</span> String suffix;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPrefix</span><span class="hljs-params">()</span> </span>{<br>        <span class="hljs-keyword">return</span> prefix;<br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPrefix</span><span class="hljs-params">(String prefix)</span> </span>{<br>        <span class="hljs-keyword">this</span>.prefix = prefix;<br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getSuffix</span><span class="hljs-params">()</span> </span>{<br>        <span class="hljs-keyword">return</span> suffix;<br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSuffix</span><span class="hljs-params">(String suffix)</span> </span>{<br>        <span class="hljs-keyword">this</span>.suffix = suffix;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>HelloServiceAutoConfiguration：</strong></p>
<p>自动配置类！我们自己的项目没有实现HelloService的话，自动配置类才会向容器中添加默认的HelloService！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableConfigurationProperties(HelloServiceProperties.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloServiceAutoConfiguration</span> </span>{<br><br>    <span class="hljs-comment">// 这个写到下面，没有HelloService，但是属性配置文件绑定还得在！</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean(HelloService.class)</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> HelloService <span class="hljs-title">helloService</span><span class="hljs-params">()</span></span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HelloService();<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>resources/META-INF/spring.factories：</strong></p>
<p>上面配置的自动配置类默认不会生效，需要在spring.factories指定开启的自动配置类才行！</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs factories"># Auto Configure<br>org.springframework.boot.autoconfigure.EnableAutoConfiguration=\<br>com.itnxd.hello.auto.HelloServiceAutoConfiguration<br></code></pre></td></tr></tbody></table></figure>
<h3 id="创建测试-Module"><a class="header-anchor" href="#创建测试-Module">¶</a>创建测试 Module</h3>
<p><strong>导入自定义的依赖：</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itnxd<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>itnxd-hello-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>自定义的配置前缀：</strong></p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-meta">itnxd.hello.prefix</span>=<span class="hljs-string">hh</span><br><span class="hljs-meta">itnxd.hello.suffix</span>=<span class="hljs-string">zz</span><br></code></pre></td></tr></tbody></table></figure>
<p><strong>Controller测试：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>{<br><br>    <span class="hljs-comment">// 自动注入我们的HelloService</span><br>    <span class="hljs-meta">@Autowired</span><br>    HelloService helloService;<br><br>    <span class="hljs-meta">@GetMapping("/hello")</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span></span>{<br>        String h = helloService.sayHello(<span class="hljs-string">"张三"</span>);<br>        <span class="hljs-keyword">return</span> h;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>若我们自己实现了HelloService，自动配置类会发现，则不会放入默认的HelloService：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyConfig</span> </span>{<br><br>    <span class="hljs-comment">// 容器中有了自己的HelloService则不会去调用autoconfigure中的HelloService!</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> HelloService <span class="hljs-title">helloService</span><span class="hljs-params">()</span></span>{<br>        HelloService helloService = <span class="hljs-keyword">new</span> HelloService();<br>        <span class="hljs-comment">// 我们的逻辑...</span><br>        <span class="hljs-keyword">return</span> helloService;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<h2 id="4、SpringBoot原理"><a class="header-anchor" href="#4、SpringBoot原理">¶</a>4、SpringBoot原理</h2>
<h3 id="SpringBoot启动过程"><a class="header-anchor" href="#SpringBoot启动过程">¶</a>SpringBoot启动过程</h3>
<ul>
<li><strong>创建 SpringApplication</strong>
<ul>
<li>保存一些信息。</li>
<li>判定当前应用的类型。ClassUtils。Servlet</li>
<li><strong>bootstrappers：初始启动引导器</strong>（<code>List&lt;Bootstrapper&gt;</code>）：去<strong>spring.factories</strong>文件中找 org.springframework.boot.Bootstrapper</li>
<li>找 <strong>ApplicationContextInitializer</strong>；去<strong>spring.factories</strong>找 ApplicationContextInitializer</li>
<li>找 <strong>ApplicationListener</strong>  ；应用监听器。去<strong>spring.factories</strong>找 ApplicationListener</li>
</ul>
</li>
<li><strong>运行 SpringApplication</strong>
<ul>
<li><strong>StopWatch</strong></li>
<li>记录应用的启动时间</li>
<li>**创建引导上下文（Context环境）**createBootstrapContext()
<ul>
<li><strong>获取到所有之前的 bootstrappers 挨个执行 intitialize() 来完成对引导启动器上下文环境设置</strong></li>
</ul>
</li>
<li>让当前应用进入<strong>headless模式</strong>。java.awt.headless</li>
<li>获取所有 <strong>RunListener（运行监听器）</strong>【为了方便所有Listener进行事件感知】
<ul>
<li><strong>getSpringFactoriesInstances</strong> 去<strong>spring.factories</strong>找 SpringApplicationRunListener.</li>
</ul>
</li>
<li><strong>遍历 SpringApplicationRunListener 调用 starting 方法</strong>
<ul>
<li>相当于通知所有感兴趣系统正在启动过程的人，项目正在 starting。</li>
</ul>
</li>
<li>保存命令行参数；ApplicationArguments</li>
<li><strong>准备环境</strong> prepareEnvironment（）;
<ul>
<li>返回或者<strong>创建基础环境信息对象</strong>。StandardServletEnvironment</li>
<li><strong>配置</strong>环境信息对象。读取所有的配置源的配置属性值。</li>
<li>绑定环境信息</li>
<li><strong>监听器</strong>调用 listener.environmentPrepared()；<strong>通知所有的监听器当前环境准备完成</strong></li>
</ul>
</li>
<li><strong>创建IOC容器</strong>（createApplicationContext（））
<ul>
<li>根据项目类型（Servlet）创建容器，</li>
<li>当前会创建 AnnotationConfigServletWebServerApplicationContext</li>
</ul>
</li>
<li><strong>准备ApplicationContext IOC容器的基本信息</strong>   prepareContext()
<ul>
<li>保存环境信息</li>
<li>IOC容器的后置处理流程。</li>
<li><strong>应用初始化器</strong>；applyInitializers；
<ul>
<li>遍历所有的 ApplicationContextInitializer 。<strong>调用 initialize。来对ioc容器进行初始化扩展功能</strong></li>
<li><strong>遍历所有的 listener 调用 contextPrepared</strong>。EventPublishRunListenr；通知所有的监听器contextPrepared</li>
</ul>
</li>
<li><strong>所有的监听器调用 contextLoaded。通知所有的监听器 contextLoaded；</strong></li>
</ul>
</li>
<li><strong>刷新IOC容器</strong>。refreshContext。创建容器中的所有组件（Spring注解）</li>
<li>容器刷新完成后工作 afterRefresh</li>
<li>所有监听器调用 listeners.started(context); <strong>通知所有的监听器 started</strong></li>
<li><strong>调用所有runners</strong>；callRunners()
<ul>
<li>获取容器中的 <strong>ApplicationRunner</strong></li>
<li>获取容器中的  <strong>CommandLineRunner</strong></li>
<li>合并所有runner并且<strong>按照@Order进行排序</strong></li>
<li><strong>遍历所有的runner。调用 run 方法</strong></li>
</ul>
</li>
<li><strong>如果以上有异常，调用Listener 的 failed</strong></li>
<li>调用所有监听器的 running 方法  listeners.running(context); <strong>通知所有的监听器 running</strong></li>
<li><strong>running如果有问题。继续通知 failed</strong> 。调用所有 Listener 的 failed；<strong>通知所有的监听器 failed</strong></li>
</ul>
</li>
</ul>
<h3 id="自定义五大组件"><a class="header-anchor" href="#自定义五大组件">¶</a>自定义五大组件</h3>
<ul>
<li>
<p>ApplicationContextInitializer</p>
</li>
<li>
<p>ApplicationListener</p>
</li>
<li>
<p>SpringApplicationRunListener</p>
</li>
<li>
<p>ApplicationRunner</p>
</li>
<li>
<p>CommandLineRunner</p>
</li>
</ul>
<p><strong>ApplicationContextInitializer：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApplicationContextInitializer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ApplicationContextInitializer</span> </span>{<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">(ConfigurableApplicationContext applicationContext)</span> </span>{<br><br>        System.out.println(<span class="hljs-string">"MyApplicationContextInitializer的initialize方法"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>SpringApplicationRunListener：</strong></p>
<p>应用启动到终止的各个状态！</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MySpringApplicationRunListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">SpringApplicationRunListener</span> </span>{<br><br>    <span class="hljs-keyword">private</span> SpringApplication springApplication;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MySpringApplicationRunListener</span><span class="hljs-params">(SpringApplication application, String[] args)</span></span>{<br>        <span class="hljs-keyword">this</span>.springApplication = application;<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">starting</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext)</span> </span>{<br>        System.out.println(<span class="hljs-string">"MySpringApplicationRunListener---------starting"</span>);<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">environmentPrepared</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext, ConfigurableEnvironment environment)</span> </span>{<br>        System.out.println(<span class="hljs-string">"MySpringApplicationRunListener---------environmentPrepared"</span>);<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextPrepared</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> </span>{<br>        System.out.println(<span class="hljs-string">"MySpringApplicationRunListener---------contextPrepared"</span>);<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextLoaded</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> </span>{<br>        System.out.println(<span class="hljs-string">"MySpringApplicationRunListener---------contextLoaded"</span>);<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">started</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> </span>{<br>        System.out.println(<span class="hljs-string">"MySpringApplicationRunListener---------started"</span>);<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">running</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> </span>{<br>        System.out.println(<span class="hljs-string">"MySpringApplicationRunListener---------running"</span>);<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">failed</span><span class="hljs-params">(ConfigurableApplicationContext context, Throwable exception)</span> </span>{<br>        System.out.println(<span class="hljs-string">"MySpringApplicationRunListener---------failed"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>ApplicationListener：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApplicationListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ApplicationListener</span> </span>{<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onApplicationEvent</span><span class="hljs-params">(ApplicationEvent event)</span> </span>{<br>        System.out.println(<span class="hljs-string">"MyApplicationListener的onApplicationEvent"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>ApplicationRunner：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Order(1)</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApplicationRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ApplicationRunner</span> </span>{<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(ApplicationArguments args)</span> <span class="hljs-keyword">throws</span> Exception </span>{<br>        System.out.println(<span class="hljs-string">"MyApplicationRunner===============run"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>CommandLineRunner：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 应用启动做一些事情！</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ITNXD</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2021-10-11 13:30</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Order(2)</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyCommandLineRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CommandLineRunner</span> </span>{<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception </span>{<br>        System.out.println(<span class="hljs-string">"MyCommandLineRunner===============run"</span>);<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>
<p><strong>前三大组件需要在spring.factories指定：</strong></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs factories"># Initializers<br>org.springframework.context.ApplicationContextInitializer=\<br>com.itnxd.boot.listener.MyApplicationContextInitializer<br><br># Application Listeners<br>org.springframework.context.ApplicationListener=\<br>com.itnxd.boot.listener.MyApplicationListener<br><br># Application RunListener<br>org.springframework.boot.SpringApplicationRunListener=\<br>com.itnxd.boot.listener.MySpringApplicationRunListener<br></code></pre></td></tr></tbody></table></figure>
<p><strong>效果：</strong></p>
<p><img src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/13/7ad9bff975d5f0e7299540f3118c2da6.png" alt=""></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined" rel="external nofollow noreferrer">ITNXD</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.itnxd.cn/posts/12809.html">https://www.itnxd.cn/posts/12809.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.itnxd.cn" target="_blank">小牛博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringBoot/">SpringBoot</a></div><div class="post_share"><div class="social-share" data-image="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/13/f4ee28a291f9feb683183e72ba34bb7a.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://gitcode.net/qq_43590403/images/-/raw/master/img/WeChantQR.jpg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="https://gitcode.net/qq_43590403/images/-/raw/master/img/WeChantQR.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://gitcode.net/qq_43590403/images/-/raw/master/img/AliPayQR.jpg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="https://gitcode.net/qq_43590403/images/-/raw/master/img/AliPayQR.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/29680.html"><img class="prev-cover" src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/23/922026402b21435e77ec5a1c183683b7.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">分布式微服务架构的一站式解决方案、多种微服务架构落地技术的集合体、俗称微服务全家桶的 SpringCloud</div></div></a></div><div class="next-post pull-right"><a href="/posts/49375.html"><img class="next-cover" src="https://gitcode.net/qq_43590403/pic/-/raw/master/2021/10/04/bad5b13b191abdc4a6020f51449722c3.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">高级消息队列、开源消息代理软件、面向消息的中间件 RabbitMQ 介绍</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81SpringBoot%E6%A6%82%E8%BF%B0"><span class="toc-text">一、SpringBoot概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88"><span class="toc-text">1、能做什么</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring%E8%83%BD%E5%8A%9B"><span class="toc-text">Spring能力</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring%E7%94%9F%E6%80%81"><span class="toc-text">Spring生态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring5%E5%8D%87%E7%BA%A7"><span class="toc-text">Spring5升级</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8"><span class="toc-text">2、为什么用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringBoot%E4%BC%98%E7%82%B9"><span class="toc-text">SpringBoot优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringBoot%E7%BC%BA%E7%82%B9"><span class="toc-text">SpringBoot缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%97%B6%E4%BB%A3%E8%83%8C%E6%99%AF"><span class="toc-text">3、时代背景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">微服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F"><span class="toc-text">分布式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%91%E5%8E%9F%E7%94%9F"><span class="toc-text">云原生</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81SpringBoot%E7%89%B9%E7%82%B9"><span class="toc-text">4、SpringBoot特点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86"><span class="toc-text">依赖管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">自动配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AE%B9%E5%99%A8%E5%8A%9F%E8%83%BD"><span class="toc-text">二、容器功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E7%BB%84%E4%BB%B6%E6%B7%BB%E5%8A%A0"><span class="toc-text">1、组件添加</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Configuration"><span class="toc-text">@Configuration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Import"><span class="toc-text">@Import</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean"><span class="toc-text">@Bean</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Conditional"><span class="toc-text">@Conditional</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%8E%9F%E7%94%9F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%BC%95%E5%85%A5"><span class="toc-text">2、原生配置文件引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E9%85%8D%E7%BD%AE%E7%BB%91%E5%AE%9A"><span class="toc-text">3、配置绑定</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ConfigurationProperties"><span class="toc-text">@ConfigurationProperties</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E7%A7%8D%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BB%91%E5%AE%9A%E6%96%B9%E6%B3%95"><span class="toc-text">两种配置文件绑定方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-text">三、自动配置原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81-SpringBootConfiguration"><span class="toc-text">1、@SpringBootConfiguration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81-ComponentScan"><span class="toc-text">2、@ComponentScan</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81-EnableAutoConfiguration"><span class="toc-text">3、@EnableAutoConfiguration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AutoConfigurationPackage"><span class="toc-text">@AutoConfigurationPackage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Import-2"><span class="toc-text">@Import</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E9%9C%80%E5%BC%80%E5%90%AF%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%BB%84%E4%BB%B6"><span class="toc-text">按需开启自动配置组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE"><span class="toc-text">修改默认配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7"><span class="toc-text">四、开发技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Lombok"><span class="toc-text">1、Lombok</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E5%BC%95%E5%85%A5"><span class="toc-text">依赖引入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8C%96JavaBean"><span class="toc-text">简化JavaBean</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8C%96%E6%97%A5%E5%BF%97Slf4j"><span class="toc-text">简化日志Slf4j</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Dev-tools"><span class="toc-text">2、Dev-tools</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81Spring-Initailizr"><span class="toc-text">3、Spring Initailizr</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">五、配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%88%86%E7%B1%BB"><span class="toc-text">1、配置文件分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81yaml"><span class="toc-text">2、yaml</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-text">基本语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E9%85%8D%E7%BD%AE%E6%8F%90%E7%A4%BA"><span class="toc-text">3、配置提示</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81Web%E5%BC%80%E5%8F%91"><span class="toc-text">六、Web开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81SpringMVC%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%A6%82%E8%A7%88"><span class="toc-text">1、SpringMVC自动配置概览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E7%AE%80%E5%8D%95%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-text">2、简单功能分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE"><span class="toc-text">静态资源访问</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webjar"><span class="toc-text">webjar</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AC%A2%E8%BF%8E%E9%A1%B5%E6%94%AF%E6%8C%81"><span class="toc-text">欢迎页支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-Favicon"><span class="toc-text">自定义 Favicon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-text">静态资源配置原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86"><span class="toc-text">3、请求参数处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84"><span class="toc-text">请求映射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#REST%E5%8E%9F%E7%90%86"><span class="toc-text">REST原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84%E5%8E%9F%E7%90%86"><span class="toc-text">请求映射原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E5%8F%82%E6%95%B0%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%B3%A8%E8%A7%A3"><span class="toc-text">普通参数与基本注解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3"><span class="toc-text">注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Servlet-API"><span class="toc-text">Servlet API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E5%8F%82%E6%95%B0"><span class="toc-text">复杂参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%B9%E8%B1%A1%E5%8F%82%E6%95%B0"><span class="toc-text">自定义对象参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POJO%E5%B0%81%E8%A3%85%E8%BF%87%E7%A8%8B"><span class="toc-text">POJO封装过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86%E5%8E%9F%E7%90%86"><span class="toc-text">参数处理原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%95%B0%E6%8D%AE%E5%93%8D%E5%BA%94%E4%B8%8E%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="toc-text">4、数据响应与内容协商</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94JSON"><span class="toc-text">响应JSON</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#jackson-jar-ResponseBody"><span class="toc-text">jackson.jar+@ResponseBody</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC%E8%A7%A3%E6%9E%90%E5%99%A8%E5%8E%9F%E7%90%86"><span class="toc-text">返回值解析器原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringMVC%E6%94%AF%E6%8C%81%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-text">SpringMVC支持的返回值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTPMessageConverter%E5%8E%9F%E7%90%86"><span class="toc-text">HTTPMessageConverter原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MessageConverter%E8%A7%84%E8%8C%83"><span class="toc-text">MessageConverter规范</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E7%9A%84MessageConverter"><span class="toc-text">默认的MessageConverter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="toc-text">内容协商</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E5%85%A5xml%E4%BE%9D%E8%B5%96"><span class="toc-text">引入xml依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#postman%E5%88%86%E5%88%AB%E6%B5%8B%E8%AF%95%E8%BF%94%E5%9B%9Ejson%E5%92%8Cxml"><span class="toc-text">postman分别测试返回json和xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%82%E6%95%B0%E6%96%B9%E5%BC%8F%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%8A%9F%E8%83%BD"><span class="toc-text">开启浏览器参数方式内容协商功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%8E%9F%E7%90%86"><span class="toc-text">内容协商原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-MessageConverter"><span class="toc-text">自定义 MessageConverter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%82%E6%95%B0%E7%9A%84%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="toc-text">基于浏览器参数的内容协商</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86"><span class="toc-text">5、视图解析原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8EThymeleaf"><span class="toc-text">6、模板引擎Thymeleaf</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#thymeleaf%E7%AE%80%E4%BB%8B"><span class="toc-text">thymeleaf简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95-2"><span class="toc-text">基本语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%80%BC"><span class="toc-text">设置属性值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3"><span class="toc-text">迭代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E8%BF%90%E7%AE%97"><span class="toc-text">条件运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-text">属性优先级</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81Thymeleaf%E4%BD%BF%E7%94%A8"><span class="toc-text">7、Thymeleaf使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5Starter"><span class="toc-text">引入Starter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%A5%BD%E4%BA%86thymeleaf"><span class="toc-text">自动配置好了thymeleaf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E5%A5%BD%E7%9A%84%E7%AD%96%E7%95%A5"><span class="toc-text">自动配好的策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%92%8C"><span class="toc-text">$和@</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E5%86%85%E5%86%99%E6%B3%95"><span class="toc-text">行内写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E5%8F%96%E5%85%AC%E5%85%B1%E9%A1%B5%E9%9D%A2"><span class="toc-text">抽取公共页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%B8%B2%E6%9F%93"><span class="toc-text">数据渲染</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">8、拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HandlerInterceptor-%E6%8E%A5%E5%8F%A3"><span class="toc-text">HandlerInterceptor 接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">配置拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8%E5%8E%9F%E7%90%86"><span class="toc-text">拦截器原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-text">9、文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E8%A1%A8%E5%8D%95"><span class="toc-text">页面表单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%BB%A3%E7%A0%81"><span class="toc-text">文件上传代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%85%8D%E7%BD%AE"><span class="toc-text">文件上传配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-text">自动配置原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E5%BC%82%E5%B8%B8-%E9%94%99%E8%AF%AF-%E5%A4%84%E7%90%86"><span class="toc-text">10、异常&#x2F;错误 处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99"><span class="toc-text">默认规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-text">异常处理自动配置原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%AD%A5%E9%AA%A4%E6%B5%81%E7%A8%8B"><span class="toc-text">异常处理步骤流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E7%94%9F%E9%94%99%E8%AF%AF%E6%94%BE%E5%88%B0request%E5%9F%9F%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-text">发生错误放到request域的数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E9%80%BB%E8%BE%91"><span class="toc-text">定制错误处理逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E9%A1%B5"><span class="toc-text">自定义错误页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ControllerAdvice-ExceptionHandler"><span class="toc-text">@ControllerAdvice+@ExceptionHandler</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ResponseStatus-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8"><span class="toc-text">@ResponseStatus+自定义异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring%E5%BA%95%E5%B1%82%E7%9A%84%E5%BC%82%E5%B8%B8"><span class="toc-text">Spring底层的异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-text">自定义异常解析器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11%E3%80%81Web%E5%8E%9F%E7%94%9F%E7%BB%84%E4%BB%B6%E6%B3%A8%E5%85%A5"><span class="toc-text">11、Web原生组件注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Servlet-API"><span class="toc-text">使用Servlet API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8RegistrationBean"><span class="toc-text">使用RegistrationBean</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E7%BB%8F%E8%BF%87spring%E6%8B%A6%E6%88%AA%E5%99%A8%EF%BC%9F"><span class="toc-text">不经过spring拦截器？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12%E3%80%81%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8"><span class="toc-text">12、嵌入式Servlet容器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8"><span class="toc-text">切换嵌入式Servlet容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6Servlet%E5%AE%B9%E5%99%A8"><span class="toc-text">定制Servlet容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13%E3%80%81%E5%AE%9A%E5%88%B6%E5%8C%96%E5%8E%9F%E7%90%86"><span class="toc-text">13、定制化原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6%E5%8C%96%E7%9A%84%E5%B8%B8%E8%A7%81%E6%96%B9%E5%BC%8F"><span class="toc-text">定制化的常见方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EnableWebMvc-%E5%8E%9F%E7%90%86"><span class="toc-text">@EnableWebMvc 原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E5%A5%97%E8%B7%AF"><span class="toc-text">原理分析套路</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE"><span class="toc-text">七、数据访问</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%95%B4%E5%90%88JDBC"><span class="toc-text">1、整合JDBC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5JDBC%E5%9C%BA%E6%99%AF"><span class="toc-text">导入JDBC场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E9%A9%B1%E5%8A%A8"><span class="toc-text">导入数据库驱动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">分析自动配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-text">修改配置项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%95%B4%E5%90%88Druid"><span class="toc-text">2、整合Druid</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E5%BC%8F"><span class="toc-text">自定义方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#StatViewServlet"><span class="toc-text">StatViewServlet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#StatFilter"><span class="toc-text">StatFilter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Starter%E6%96%B9%E5%BC%8F"><span class="toc-text">Starter方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE-2"><span class="toc-text">分析自动配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">配置文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%95%B4%E5%90%88MyBatis"><span class="toc-text">3、整合MyBatis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">导入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%BC%8F"><span class="toc-text">配置模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E6%B7%B7%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="toc-text">注解配置混合模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%95%B4%E5%90%88Mybatis-Plus"><span class="toc-text">4、整合Mybatis-Plus</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96-2"><span class="toc-text">导入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE-2"><span class="toc-text">自动配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-2"><span class="toc-text">测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%B5%8B%E8%AF%95"><span class="toc-text">分页测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E6%95%B4%E5%90%88Redis"><span class="toc-text">5、整合Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96-3"><span class="toc-text">导入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE-3"><span class="toc-text">自动配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5Jedis"><span class="toc-text">导入Jedis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-2"><span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-3"><span class="toc-text">测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E6%95%B0%E5%99%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">计数器案例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-text">八、单元测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81JUnit5-%E7%9A%84%E5%8F%98%E5%8C%96"><span class="toc-text">1、JUnit5 的变化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81JUnit5%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-text">2、JUnit5常用注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%96%AD%E8%A8%80%EF%BC%88assertions%EF%BC%89"><span class="toc-text">3、断言（assertions）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%96%AD%E8%A8%80"><span class="toc-text">简单断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E6%96%AD%E8%A8%80"><span class="toc-text">数组断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E6%96%AD%E8%A8%80"><span class="toc-text">组合断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E6%96%AD%E8%A8%80"><span class="toc-text">异常断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B6%85%E6%97%B6%E6%96%AD%E8%A8%80"><span class="toc-text">超时断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%A4%B1%E8%B4%A5"><span class="toc-text">快速失败</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%EF%BC%88assumptions%EF%BC%89"><span class="toc-text">4、前置条件（assumptions）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%B5%8C%E5%A5%97%E6%B5%8B%E8%AF%95"><span class="toc-text">5、嵌套测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="toc-text">6、参数化测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E8%BF%81%E7%A7%BB%E6%8C%87%E5%8D%97"><span class="toc-text">7、迁移指南</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7"><span class="toc-text">九、指标监控</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81SpringBoot-Actuator"><span class="toc-text">1、SpringBoot Actuator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96-4"><span class="toc-text">导入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E5%B7%AE%E5%BC%82"><span class="toc-text">版本差异</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-3"><span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%B5%8B%E8%AF%95"><span class="toc-text">访问测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Actuator-Endpoint"><span class="toc-text">2、Actuator Endpoint</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%B8%B8%E4%BD%BF%E7%94%A8%E7%9A%84%E7%AB%AF%E7%82%B9"><span class="toc-text">最常使用的端点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Health-Endpoint"><span class="toc-text">Health Endpoint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Metrics-Endpoint"><span class="toc-text">Metrics Endpoint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86Endpoints"><span class="toc-text">管理Endpoints</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E5%AE%9A%E5%88%B6-Endpoint"><span class="toc-text">3、定制 Endpoint</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6-Health-%E4%BF%A1%E6%81%AF"><span class="toc-text">定制 Health 信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6info%E4%BF%A1%E6%81%AF"><span class="toc-text">定制info信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">编写配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99InfoContributor"><span class="toc-text">编写InfoContributor</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6Metrics%E4%BF%A1%E6%81%AF"><span class="toc-text">定制Metrics信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SpringBoot%E9%BB%98%E8%AE%A4%E6%94%AF%E6%8C%81"><span class="toc-text">SpringBoot默认支持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E5%AE%9A%E5%88%B6Metrics"><span class="toc-text">增加定制Metrics</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6Endpoint"><span class="toc-text">定制Endpoint</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9B%91%E6%8E%A7"><span class="toc-text">4、微服务可视化监控</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87-Admin-Server"><span class="toc-text">准备 Admin Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%BC%95%E7%94%A8AdminServer"><span class="toc-text">项目中引用AdminServer</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="toc-text">十、原理解析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81profile%E5%8A%9F%E8%83%BD"><span class="toc-text">1、profile功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#application-profile%E5%8A%9F%E8%83%BD"><span class="toc-text">application-profile功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Profile%E6%9D%A1%E4%BB%B6%E8%A3%85%E9%85%8D%E5%8A%9F%E8%83%BD"><span class="toc-text">@Profile条件装配功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#profile%E5%88%86%E7%BB%84"><span class="toc-text">profile分组</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%A4%96%E9%83%A8%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-text">2、外部化配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE%E6%BA%90"><span class="toc-text">外部配置源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE%E4%BD%8D%E7%BD%AE"><span class="toc-text">配置文件查找位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F"><span class="toc-text">配置文件加载顺序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89starter"><span class="toc-text">3、自定义starter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Starter%E7%BB%93%E6%9E%84%E5%9B%BE"><span class="toc-text">Starter结构图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-Starter-Maven-Module"><span class="toc-text">创建 Starter Maven Module</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-Autoconfigure-Boot-Module"><span class="toc-text">创建 Autoconfigure Boot Module</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95-Module"><span class="toc-text">创建测试 Module</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81SpringBoot%E5%8E%9F%E7%90%86"><span class="toc-text">4、SpringBoot原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringBoot%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="toc-text">SpringBoot启动过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%94%E5%A4%A7%E7%BB%84%E4%BB%B6"><span class="toc-text">自定义五大组件</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By ITNXD</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">CDN BY <a target="_blank" rel="external nofollow" href="https://www.jsdelivr.com/"><b>jsDelivr</b></a> | HOST BY  <a target="_blank" rel="external nofollow" href="https://vercel.com/"><b>Vercel</b></a> && <a target="_blank" rel="external nofollow" href="https://github.com/"><b>Github</b></a><br><img style="vertical-align:middle" src="https://cdn.jsdelivr.net/gh/lzyblog/image@4b122354dee27f3056fd3a7fc6a43dbf68cebf33/2020/11/16/025e5329f3592dfa03a13c5365323ba1.png" alt=""> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.beian.miit.gov.cn/"><b>晋ICP备19005025号-2</b></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script defer src="/js/utils.js"></script><script defer src="/js/main.js"></script><script defer src="/js/tw_cn.js"></script><script defer src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script defer src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script defer src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      true && mermaid.init()
    })
  }
}</script><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'itnxd-8g1z2i760e99f516',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'itnxd-8g1z2i760e99f516',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'itnxd-8g1z2i760e99f516',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script defer src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><div class="aplayer no-destroy" data-id="1551071404" data-server="tencent" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/6dc9e8f9.js","daovoice")
</script><script>var isChatBtn = true
daovoice('init', {
  app_id: '6dc9e8f9',},{
  launcher: { 
     disableLauncherIcon: isChatBtn // 悬浮 ICON 是否显示
  },
});
daovoice('update');

if (isChatBtn) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      daovoice('show')
    });
  }
  chatBtnFn()
} else {
  if (false) {
    function chatBtnHide () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: true // 悬浮 ICON 是否显示
        },
      });
    }
    function chatBtnShow () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: false // 悬浮 ICON 是否显示
        },
      });
    }
  }
}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script defer src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script defer src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script defer async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>